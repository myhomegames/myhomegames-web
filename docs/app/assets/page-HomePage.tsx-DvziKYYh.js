import{r as c,j as e}from"./react-vendor-jNdKP8wU.js";import{u as W,D as G,e as J,f as q}from"./page-CollectionsPage.tsx-DjVo-48O.js";import{u as A}from"./i18n-vendor-mPXi0JFR.js";import{g as _,A as P}from"./page-AddGamePage.tsx-CGFUTWrs.js";import{L as Q}from"./page-LibraryPage.tsx-Cz-By_fa.js";import{R as X}from"./page-RecommendedPage.tsx-Bhjj9dqT.js";import{D as Z}from"./page-DevelopersPage.tsx-jSDkVu4g.js";import{P as U}from"./page-PublishersPage.tsx-22u-XGGP.js";import{T as p}from"./page-TagListRoutePage.tsx-DcHx5_pm.js";/* empty css                          */const $=c.createContext(null);function ee(){const t=c.useContext($);return t||{hasBackground:!1,isBackgroundVisible:!1,setBackgroundVisible:()=>{}}}const H="backgroundStates",Y=()=>{try{const t=localStorage.getItem(H);return t?JSON.parse(t):{}}catch{return{}}},se=(t,s)=>{const o=Y();o[t]=s,localStorage.setItem(H,JSON.stringify(o))},K=(t,s)=>Y()[t]??s;function pe({backgroundUrl:t,hasBackground:s,elementId:o,children:a}){const[d,g]=c.useState(()=>K(o,s));c.useEffect(()=>{if(s){const r=K(o,s);g(r)}else g(!1)},[s,t,o]);const m=c.useCallback(r=>{g(r),se(o,r)},[o]),h=c.useMemo(()=>({hasBackground:s,isBackgroundVisible:d,setBackgroundVisible:m}),[s,d,m]);return e.jsxs($.Provider,{value:h,children:[e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:s&&d?"transparent":"#1a1a1a",backgroundImage:s&&d?`url(${t})`:void 0,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",backgroundAttachment:"fixed",zIndex:0,cursor:s&&d?"pointer":"default"},onClick:()=>{s&&d&&m(!1)},children:s&&d&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(26, 26, 26, 0.85)",zIndex:1}}),e.jsx("img",{src:t,alt:"",style:{display:"none"}})]})}),e.jsx("div",{style:{position:"relative",zIndex:2},children:a})]})}function te({value:t,onChange:s,min:o=100,max:a=200}){return e.jsx("div",{className:"cover-size-slider-container",children:e.jsx("input",{id:"cover-size-slider",name:"coverSize",type:"range",min:o,max:a,value:t,onChange:d=>s(Number(d.target.value)),className:"cover-size-slider","aria-label":"Cover size"})})}function ne({value:t,onChange:s,disabled:o=!1}){const{t:a,i18n:d}=A(),[g,m]=c.useState(!1),[h,r]=c.useState(!1),v=c.useRef(null),x=c.useMemo(()=>[{key:"grid",label:a("viewMode.grid"),icon:"⊞"},{key:"detail",label:a("viewMode.detail"),icon:"☰"},{key:"table",label:a("viewMode.table"),icon:"☷"}],[a,d.language]),j=x.find(i=>i.key===t)||x[0];return c.useEffect(()=>{function i(b){v.current&&!v.current.contains(b.target)&&m(!1)}function L(b){b.key==="Escape"&&m(!1)}if(g)return document.addEventListener("mousedown",i),document.addEventListener("keydown",L),()=>{document.removeEventListener("mousedown",i),document.removeEventListener("keydown",L)}},[g]),e.jsxs("div",{ref:v,className:"view-mode-selector",children:[e.jsxs("button",{onClick:()=>!o&&m(!g),type:"button",className:`view-mode-button ${o?"disabled":""}`,disabled:o,onMouseEnter:()=>{o||r(!0)},onMouseLeave:()=>{o||r(!1)},children:[e.jsx("span",{className:`view-mode-icon ${h&&!o?"hover":""}`,children:j.icon}),!o&&e.jsx("svg",{width:"12",height:"12",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:2,className:`view-mode-arrow ${g?"open":""}`,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})]}),g&&!o&&e.jsx("div",{className:"view-mode-dropdown",children:x.map(i=>e.jsxs("button",{onClick:()=>{s(i.key),m(!1)},type:"button",className:`view-mode-option ${t===i.key?"active":""}`,children:[e.jsx("span",{className:"view-mode-option-icon",children:i.icon}),e.jsx("span",{children:i.label})]},i.key))})]})}function re({isVisible:t,onChange:s,disabled:o=!1}){const{t:a}=A();return e.jsx("button",{className:"background-toggle-button",onClick:()=>!o&&s(!t),disabled:o,"aria-label":a(t?"common.hideBackground":"common.showBackground"),title:a(t?"common.hideBackground":"common.showBackground"),children:e.jsx("span",{className:"background-toggle-icon",children:e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:t?e.jsx("path",{d:"M4 4h16v16H4V4zm2 2v12h12V6H6zm2 2h8v8H8V8z",fill:"currentColor"}):e.jsx("path",{d:"M4 4h16v16H4V4zm2 2v12h12V6H6z",fill:"currentColor",opacity:"0.5"})})})})}function oe({libraries:t,activeLibrary:s,onSelectLibrary:o,loading:a,error:d,coverSize:g=150,onCoverSizeChange:m,viewMode:h="grid",onViewModeChange:r,hideBackgroundToggle:v=!1,onReloadMetadata:x}){const{t:j}=A(),{isLoading:i}=W(),{hasBackground:L,isBackgroundVisible:b,setBackgroundVisible:w}=ee(),M=a!==void 0?a:i,[R,N]=c.useState(!1),C=c.useRef(null),E=c.useRef(null);c.useEffect(()=>{if(!s){N(!1);return}const l=()=>{if(window.innerWidth<800){N(!0);return}if(C.current&&E.current){const u=C.current.offsetWidth,f=E.current.offsetWidth,y=u-f-180,k=t.length*110;N(y<k)}};l();const S=setTimeout(l,100);return window.addEventListener("resize",l),()=>{clearTimeout(S),window.removeEventListener("resize",l)}},[t,h,g,s]);const V=l=>{const S=t.find(n=>n.key===l.target.value);S&&o(S)};return e.jsx("div",{className:"mhg-libraries-bar",children:e.jsxs("div",{className:"mhg-libraries-bar-container",ref:C,children:[_()&&e.jsx("div",{className:"mhg-libraries-menu-container",children:e.jsx(G,{className:"mhg-libraries-menu-dropdown",onReload:x})}),s&&e.jsx(e.Fragment,{children:R?e.jsxs("div",{className:"mhg-libraries-combobox-container",children:[M&&t.length===0?null:e.jsx("select",{id:"libraries-select",name:"library",className:"mhg-libraries-combobox",value:s?.key||"",onChange:V,children:t.map(l=>e.jsx("option",{value:l.key,children:l.title||j(`libraries.${l.key}`)},l.key))}),d&&e.jsx("div",{className:"mhg-libraries-error",children:d})]}):e.jsxs("div",{className:"mhg-libraries-container",children:[M&&t.length===0?null:t.map(l=>e.jsx("button",{className:`mhg-library-button ${s?.key===l.key?"mhg-library-active":""}`,onClick:()=>o(l),children:l.title||j(`libraries.${l.key}`)},l.key)),d&&e.jsx("div",{className:"mhg-libraries-error",children:d})]})}),e.jsxs("div",{className:"mhg-libraries-actions",ref:E,children:[L&&!v&&e.jsx("div",{className:"mhg-libraries-actions-background-toggle-container",children:e.jsx(re,{isVisible:b,onChange:w})}),m&&e.jsx("div",{className:`mhg-libraries-actions-slider-container ${h==="grid"?"":"hidden"}`,children:e.jsx(te,{value:g,onChange:m})}),r&&e.jsx("div",{className:"mhg-libraries-actions-view-mode-container",children:e.jsx(ne,{value:h,onChange:r,disabled:s?s.key!=="library"&&s.key!=="categories"&&s.key!=="series"&&s.key!=="franchise":!1})})]})]})})}const ie=["recommended","library","collections","categories","series","franchise"],ae=["platforms","themes","developers","publishers","gameEngines","gameModes","playerPerspectives"],D=[...ie,...ae],ce={recommended:"games",library:"games",collections:"collections",categories:"games",series:"games",franchise:"games",platforms:"games",themes:"games",developers:"collections",publishers:"collections",gameEngines:"games",gameModes:"games",playerPerspectives:"games"},le=new Set(D);function T(t){const s=[...D];if(!Array.isArray(t)||t.length===0)return s;const o=t.filter(a=>typeof a=="string"&&a.trim()&&le.has(a));return o.length===0?s:s.filter(a=>o.includes(a))}function O(t){return t.map(s=>({key:s,type:ce[s]||"games"}))}function xe({onGameClick:t,onGamesLoaded:s,onPlay:o,onReloadMetadata:a,allCollections:d=[]}){const{isLoading:g}=W(),[m,h]=c.useState(()=>O(T([]))),[r,v]=c.useState(null),[x,j]=c.useState(null),[i,L]=c.useState(()=>{const n=localStorage.getItem("coverSize");return n?parseInt(n,10):150}),[b,w]=c.useState("grid"),M=(n,u)=>{localStorage.setItem(`viewMode_${n}`,u)},R=n=>localStorage.getItem(`viewMode_${n}`)||"grid",N=n=>{w(n),r&&r.key==="library"&&M(r.key,n)},C=n=>{L(n),localStorage.setItem("coverSize",n.toString())};c.useEffect(()=>{E()},[]),c.useEffect(()=>{if(m.length===0)return;const n=localStorage.getItem("lastSelectedLibrary"),f=(r?m.some(y=>y.key===r.key):!1)?r:n&&m.find(y=>y.key===n)||m[0];if((!r||r.key!==f?.key)&&v(f),f?.key&&localStorage.setItem("lastSelectedLibrary",f.key),f?.key==="library"){const y=R(f.key);w(y)}else w("grid")},[m,r]);async function E(){j(null);try{let n=null;const u=_();if(P&&u)try{const k=new URL("/settings",P),I=new AbortController,F=setTimeout(()=>I.abort(),9e4),B=await fetch(k.toString(),{headers:J({Accept:"application/json"}),signal:I.signal});if(clearTimeout(F),B.ok){const z=await B.json();Array.isArray(z.visibleLibraries)&&(n=z.visibleLibraries,localStorage.setItem("visibleLibraries",JSON.stringify(z.visibleLibraries)))}}catch(k){console.warn("Failed to load visible libraries from settings:",k)}if(!n){const k=localStorage.getItem("visibleLibraries");if(k)try{const I=JSON.parse(k);Array.isArray(I)&&(n=I)}catch{n=null}}const f=T(n||[]),y=O(f);h(y)}catch(n){const u=String(n.message||n);j(u)}}function V(n){if(localStorage.setItem("lastSelectedLibrary",n.key),v(n),n.key==="library"){const u=R(n.key);w(u)}else w("grid")}function l(n){t(n)}function S(n){s(n)}return e.jsxs(e.Fragment,{children:[e.jsx(oe,{libraries:m,activeLibrary:r,onSelectLibrary:V,loading:g,error:x,coverSize:i,onCoverSizeChange:C,viewMode:b,onViewModeChange:N,onReloadMetadata:a}),e.jsx("div",{className:"bg-[#1a1a1a] home-page-main-container",children:r?e.jsxs(e.Fragment,{children:[r.key==="library"&&e.jsx(Q,{onGameClick:l,onGamesLoaded:S,onPlay:o,coverSize:i,viewMode:b,allCollections:d}),r.key==="recommended"&&e.jsx(X,{onGameClick:l,onGamesLoaded:S,onPlay:o,coverSize:i,allCollections:d}),r.key==="collections"&&e.jsx(q,{onPlay:o,coverSize:i}),r.key==="categories"&&e.jsx(p,{coverSize:i,tagKey:"categories"}),r.key==="series"&&e.jsx(p,{coverSize:i,tagKey:"series"}),r.key==="franchise"&&e.jsx(p,{coverSize:i,tagKey:"franchise"}),r.key==="platforms"&&e.jsx(p,{coverSize:i,tagKey:"platforms"}),r.key==="themes"&&e.jsx(p,{coverSize:i,tagKey:"themes"}),r.key==="developers"&&e.jsx(Z,{coverSize:i}),r.key==="publishers"&&e.jsx(U,{coverSize:i}),r.key==="gameEngines"&&e.jsx(p,{coverSize:i,tagKey:"gameEngines"}),r.key==="gameModes"&&e.jsx(p,{coverSize:i,tagKey:"gameModes"}),r.key==="playerPerspectives"&&e.jsx(p,{coverSize:i,tagKey:"playerPerspectives"})]}):e.jsx("div",{className:"flex items-center justify-center h-full"})})]})}export{pe as B,xe as H,oe as L,D as a,T as n,ee as u};
