import{r,c as Ce,j as e}from"./react-vendor-jNdKP8wU.js";import{u as Lt,S as Et,A as Rt,a as Fe,f as Oe,b as kt}from"./page-IGDBGameDetailPage.tsx--k99xBec.js";import{i as et,n as Nt,a as Tt,j as Mt,h as He,e as Je,b as tt,c as $t,q as st,m as lt,l as It,r as rt,s as nt,D as at,T as Ke,t as At,d as it,u as Pt,A as Dt}from"./page-CollectionsPage.tsx-DjVo-48O.js";import{g as zt,A as Pe,d as _e,b as De}from"./page-AddGamePage.tsx-CGFUTWrs.js";import{E as Ve,S as ot,g as Ae,G as Gt}from"./page-LibraryItemDetailPage.tsx-C5nrov_b.js";import{u as ce}from"./i18n-vendor-mPXi0JFR.js";function Bt(s={}){const{localStoragePrefix:t="",defaultFilterField:l="all",waitForAuth:c=!1,onInit:i,listenToMetadataReload:a=!1,categoryId:d=null,onCategoryIdChange:m,scrollRestorationMode:b}=s,{games:x,isLoading:f,updateGame:y,removeGame:T}=et(),g=x,[R,j]=r.useState(!1),[k,w]=r.useState(()=>t&&localStorage.getItem(`${t}FilterField`)||l),[v,P]=r.useState(()=>{if(t){const p=localStorage.getItem(`${t}SelectedYear`);return p?parseInt(p,10):null}return null}),[u,L]=r.useState(()=>{if(t){const p=localStorage.getItem(`${t}SelectedDecade`);return p?parseInt(p,10):null}return null}),[E,D]=r.useState(()=>{if(t){const p=localStorage.getItem(`${t}SelectedAgeRating`);return p!==null?p:null}return null}),[M,Z]=r.useState(()=>t&&localStorage.getItem(`${t}SelectedCollection`)||null),[h,I]=r.useState(()=>t&&localStorage.getItem(`${t}SelectedGenre`)||null),[z,U]=r.useState(()=>t&&localStorage.getItem(`${t}SelectedThemes`)||null),[H,C]=r.useState(()=>t&&localStorage.getItem(`${t}SelectedKeywords`)||null),[ee,se]=r.useState(()=>t&&localStorage.getItem(`${t}SelectedPlatforms`)||null),[V,pe]=r.useState(()=>t&&localStorage.getItem(`${t}SelectedGameModes`)||null),[ae,Se]=r.useState(()=>t&&localStorage.getItem(`${t}SelectedPublishers`)||null),[ie,ve]=r.useState(()=>t&&localStorage.getItem(`${t}SelectedDevelopers`)||null),[oe,J]=r.useState(()=>t&&localStorage.getItem(`${t}SelectedPlayerPerspectives`)||null),[O,S]=r.useState(()=>t&&localStorage.getItem(`${t}SelectedGameEngines`)||null),[te,n]=r.useState(()=>t&&localStorage.getItem(`${t}SelectedSeries`)||null),[K,be]=r.useState(()=>t&&localStorage.getItem(`${t}SelectedFranchise`)||null),{categories:W}=Lt(),le=r.useMemo(()=>W.map(p=>({id:String(p.id),title:p.title})),[W]),{collections:X,collectionGameIds:ue}=Nt(),{developers:xe}=Tt(),{publishers:me}=Mt(),de=r.useMemo(()=>X.map(p=>({id:String(p.id),title:p.title||""})),[X]),[ye,we]=r.useState([]),[Re,ke]=r.useState([]);r.useEffect(()=>{let p=!1;if(!zt())return;const N=(A,G)=>(A||[]).map(ge=>({id:String(ge.id),title:String(ge.title??ge.name??ge.id)}));return Promise.all([fetch(He(Pe,"/series"),{headers:Je({Accept:"application/json"})}).then(A=>A.ok?A.json():{series:[]}),fetch(He(Pe,"/franchises"),{headers:Je({Accept:"application/json"})}).then(A=>A.ok?A.json():{franchises:[]})]).then(([A,G])=>{p||(we(N(A.series||[])),ke(N(G.franchises||[])))}).catch(()=>{p||(we([]),ke([]))}),()=>{p=!0}},[]);const Ne=r.useMemo(()=>xe.map(p=>({id:String(p.id),title:p.title||""})),[xe]),_=r.useMemo(()=>me.map(p=>({id:String(p.id),title:p.title||""})),[me]),[B,Q]=r.useState([]),[F,he]=r.useState(()=>t&&localStorage.getItem(`${t}SortField`)||"title"),[q,Y]=r.useState(()=>t?localStorage.getItem(`${t}SortAscending`)!=="false":!0),o=r.useRef(null),$=r.useRef(null),ze=r.useRef(new Map),[Te,Ue]=r.useState(()=>{const p=localStorage.getItem("tableColumnVisibility");if(p)try{return JSON.parse(p)}catch{return{title:!0,releaseDate:!0,year:!1,stars:!1,criticRating:!1,ageRating:!1}}return{title:!0,releaseDate:!0,criticRating:!1,ageRating:!1}}),je=(p,fe)=>{if(fe==null)return!1;const N=Array.isArray(p)?p:p!=null?[p]:[];return N.length===0?!1:N.map(G=>typeof G=="object"&&G!=null&&"id"in G?G.id:G).some(G=>String(G)===String(fe))};r.useEffect(()=>{localStorage.setItem("tableColumnVisibility",JSON.stringify(Te))},[Te]),r.useEffect(()=>{t&&localStorage.setItem(`${t}FilterField`,k)},[k,t]),r.useEffect(()=>{t&&v!==null?localStorage.setItem(`${t}SelectedYear`,v.toString()):t&&localStorage.removeItem(`${t}SelectedYear`)},[v,t]),r.useEffect(()=>{t&&h!==null?localStorage.setItem(`${t}SelectedGenre`,h):t&&localStorage.removeItem(`${t}SelectedGenre`)},[h,t]),r.useEffect(()=>{t&&z!==null?localStorage.setItem(`${t}SelectedThemes`,z):t&&localStorage.removeItem(`${t}SelectedThemes`)},[z,t]),r.useEffect(()=>{t&&H!==null?localStorage.setItem(`${t}SelectedKeywords`,H):t&&localStorage.removeItem(`${t}SelectedKeywords`)},[H,t]),r.useEffect(()=>{t&&ee!==null?localStorage.setItem(`${t}SelectedPlatforms`,ee):t&&localStorage.removeItem(`${t}SelectedPlatforms`)},[ee,t]),r.useEffect(()=>{t&&V!==null?localStorage.setItem(`${t}SelectedGameModes`,V):t&&localStorage.removeItem(`${t}SelectedGameModes`)},[V,t]),r.useEffect(()=>{t&&ae!==null?localStorage.setItem(`${t}SelectedPublishers`,ae):t&&localStorage.removeItem(`${t}SelectedPublishers`)},[ae,t]),r.useEffect(()=>{t&&ie!==null?localStorage.setItem(`${t}SelectedDevelopers`,ie):t&&localStorage.removeItem(`${t}SelectedDevelopers`)},[ie,t]),r.useEffect(()=>{t&&oe!==null?localStorage.setItem(`${t}SelectedPlayerPerspectives`,oe):t&&localStorage.removeItem(`${t}SelectedPlayerPerspectives`)},[oe,t]),r.useEffect(()=>{t&&O!==null?localStorage.setItem(`${t}SelectedGameEngines`,O):t&&localStorage.removeItem(`${t}SelectedGameEngines`)},[O,t]),r.useEffect(()=>{t&&u!==null?localStorage.setItem(`${t}SelectedDecade`,u.toString()):t&&localStorage.removeItem(`${t}SelectedDecade`)},[u,t]),r.useEffect(()=>{t&&M!==null?localStorage.setItem(`${t}SelectedCollection`,M):t&&localStorage.removeItem(`${t}SelectedCollection`)},[M,t]),r.useEffect(()=>{t&&te!==null?localStorage.setItem(`${t}SelectedSeries`,te):t&&localStorage.removeItem(`${t}SelectedSeries`)},[te,t]),r.useEffect(()=>{t&&K!==null?localStorage.setItem(`${t}SelectedFranchise`,K):t&&localStorage.removeItem(`${t}SelectedFranchise`)},[K,t]),r.useEffect(()=>{t&&E!==null?localStorage.setItem(`${t}SelectedAgeRating`,E):t&&localStorage.removeItem(`${t}SelectedAgeRating`)},[E,t]),r.useEffect(()=>{t&&localStorage.setItem(`${t}SortField`,F)},[F,t]),r.useEffect(()=>{t&&localStorage.setItem(`${t}SortAscending`,q.toString())},[q,t]),tt(b===void 0?o:b==="table"?$:o,b),r.useEffect(()=>{c||i&&i()},[]),r.useEffect(()=>{if(!a)return;const p=()=>{};return window.addEventListener("metadataReloaded",p),()=>{window.removeEventListener("metadataReloaded",p)}},[a]);const We=r.useMemo(()=>{let p=[...g];return k!=="all"&&(p=p.filter(N=>{switch(k){case"genre":return h!==null?Array.isArray(N.genre)?N.genre.map(G=>typeof G=="object"&&G!=null&&"id"in G?G.id:G).some(G=>String(G)===String(h)):typeof N.genre=="string"?N.genre===h:!1:!0;case"themes":return z===null?!0:je(N.themes||null,z);case"keywords":return H===null?!0:je(N.keywords||null,H);case"platforms":return ee===null?!0:je(N.platforms||null,ee);case"gameModes":return V===null?!0:je(N.gameModes||null,V);case"publishers":return ae===null?!0:je(N.publishers??null,ae);case"developers":return ie===null?!0:je(N.developers??null,ie);case"playerPerspectives":return oe===null?!0:je(N.playerPerspectives||null,oe);case"gameEngines":return O===null?!0:je(N.gameEngines||null,O);case"year":return v!==null?N.year===v:N.year!==null&&N.year!==void 0;case"decade":return u!==null&&N.year!==null&&N.year!==void 0?Math.floor(N.year/10)*10===u:!1;case"collection":if(M!==null){const A=ue.get(String(M));if(!A)return!1;const G=String(N.id);return A.some(ge=>String(ge)===G)}return!1;case"series":{if(te===null)return!0;const A=N.series??N.collection;return(A==null?[]:Array.isArray(A)?A:[A]).map(re=>typeof re=="object"&&re?.id!=null?String(re.id):String(re)).some(re=>String(re)===te)}case"franchise":{if(K===null)return!0;const A=N.franchise;return(A==null?[]:Array.isArray(A)?A:[A]).map(re=>typeof re=="object"&&re?.id!=null?String(re.id):String(re)).some(re=>String(re)===K)}case"ageRating":if(E!==null){const[A,G]=E.split("-").map(Number);return N.ageRatings&&N.ageRatings.length>0?N.ageRatings.some(ge=>ge.category===A&&ge.rating===G):!1}return!1;default:return!0}})),k==="all"&&F==="title"&&q===!0||p.sort((N,A)=>{let G=0;switch(F){case"title":G=$t(N.title||"",A.title||"");break;case"year":const ge=N.year??0,re=A.year??0;G=ge-re;break;case"stars":const ht=N.stars??0,vt=A.stars??0;G=ht-vt;break;case"releaseDate":const qe=N.year??0,Ze=A.year??0;if(qe!==Ze)G=qe-Ze;else{const Me=N.month??0,$e=A.month??0;if(Me!==$e)G=Me-$e;else{const wt=N.day??0,jt=A.day??0;G=wt-jt}}break;case"criticRating":const bt=N.criticratings??0,xt=A.criticratings??0;G=bt-xt;break;case"userRating":const yt=N.userratings??0,St=A.userratings??0;G=yt-St;break;case"ageRating":const Ge=N.ageRatings&&N.ageRatings.length>0?N.ageRatings:[],Be=A.ageRatings&&A.ageRatings.length>0?A.ageRatings:[];if(Ge.length===0&&Be.length===0)G=0;else if(Ge.length===0)G=1;else if(Be.length===0)G=-1;else{const Me=Ge[0],$e=Be[0];Me.category!==$e.category?G=Me.category-$e.category:G=Me.rating-$e.rating}break;default:G=0}return q?G:-G}),p},[g,k,h,z,H,ee,V,ae,ie,oe,O,v,u,M,te,K,E,ue,F,q]);r.useLayoutEffect(()=>{f?f&&j(!1):requestAnimationFrame(()=>{requestAnimationFrame(()=>{j(!0)})})},[f,We.length]),r.useEffect(()=>{if(d&&le.length>0){const p=le.find(fe=>String(fe.id)===d);p&&(I(p.title),w("genre")),m&&m(d)}},[d,le,m]),r.useEffect(()=>{if(g.length===0||le.length===0)return;const p=new Set;g.forEach(N=>{N.genre&&(Array.isArray(N.genre)?N.genre.forEach(A=>{typeof A=="string"?p.add(A):typeof A=="object"&&A!=null&&"id"in A&&p.add(String(A.id))}):typeof N.genre=="string"&&p.add(N.genre))});const fe=le.filter(N=>p.has(String(N.id))||p.has(N.title));Q(fe),h!==null&&k==="genre"&&(fe.some(A=>String(A.id)===String(h))||(I(null),w("all")))},[g,le,h,k]);const dt=p=>{F===p?Y(!q):(he(p),Y(!0))},ft=p=>{Ue(fe=>({...fe,[p]:!fe[p]}))},gt=p=>{y(p),window.dispatchEvent(new CustomEvent("gameUpdated",{detail:{game:p}}))},pt=p=>{T(p.id),window.dispatchEvent(new CustomEvent("gameDeleted",{detail:{gameId:String(p.id)}}))},mt=r.useCallback(p=>{},[]);return{games:g,setGames:mt,isReady:R,libraryGamesLoading:f,filterField:k,setFilterField:w,selectedYear:v,setSelectedYear:P,selectedDecade:u,setSelectedDecade:L,selectedCollection:M,setSelectedCollection:Z,selectedAgeRating:E,setSelectedAgeRating:D,selectedGenre:h,setSelectedGenre:I,selectedThemes:z,setSelectedThemes:U,selectedKeywords:H,setSelectedKeywords:C,selectedPlatforms:ee,setSelectedPlatforms:se,selectedGameModes:V,setSelectedGameModes:pe,selectedPublishers:ae,setSelectedPublishers:Se,selectedDevelopers:ie,setSelectedDevelopers:ve,selectedPlayerPerspectives:oe,setSelectedPlayerPerspectives:J,selectedGameEngines:O,setSelectedGameEngines:S,selectedSeries:te,setSelectedSeries:n,selectedFranchise:K,setSelectedFranchise:be,allGenres:le,availableGenres:B,availableCollections:de,availableSeries:ye,availableFranchises:Re,availableDevelopers:Ne,availablePublishers:_,sortField:F,setSortField:he,sortAscending:q,setSortAscending:Y,columnVisibility:Te,setColumnVisibility:Ue,filteredAndSortedGames:We,scrollContainerRef:o,tableScrollRef:$,itemRefs:ze,handleTableSort:dt,toggleColumn:ft,handleGameUpdate:gt,handleGameDelete:pt}}function Kt(s){try{const t=sessionStorage.getItem(s);return t?parseFloat(t):null}catch{return null}}function Qe(s,t){try{sessionStorage.setItem(s,t.toString())}catch{}}const Ot=144,Ht=3;function _t({games:s,containerRef:t,itemRefs:l,onGameClick:c,onPlay:i,onEditClick:a,onGameDelete:d,onGameUpdate:m,buildCoverUrl:b,allCollections:x=[]}){const f=Ce(),[y,T]=r.useState({width:0,height:0}),g=r.useRef(null),R=r.useRef(!1),j=`${f.pathname}:detail`;r.useEffect(()=>{t&&"current"in t&&t.current&&(t.current.__virtualizedListRef=g)},[t]),r.useEffect(()=>{const w=()=>{if(t.current){const P=t.current.getBoundingClientRect();T({width:P.width-40,height:P.height||window.innerHeight-200})}};w(),window.addEventListener("resize",w);const v=new ResizeObserver(w);return t.current&&v.observe(t.current),()=>{window.removeEventListener("resize",w),v.disconnect()}},[t]),r.useEffect(()=>{if(y.height===0||s.length===0)return;const w=Kt(j);if(w===null||w<0)return;R.current=!0;const v=(u=0)=>{const L=g.current;if(!L){u<50?setTimeout(()=>v(u+1),50):R.current=!1;return}let E=null;if(L.element)E=L.element;else if(t.current){const D=t.current.querySelector('[style*="overflow"]');D&&D.scrollHeight>D.clientHeight&&(E=D)}if(!E){u<50?setTimeout(()=>v(u+1),50):R.current=!1;return}try{E.scrollTop=w,setTimeout(()=>{const D=E.scrollTop;Math.abs(D-w)>10&&u<5&&(E.scrollTop=w),setTimeout(()=>{R.current=!1},200)},100)}catch{u<10?setTimeout(()=>v(u+1),100):R.current=!1}},P=setTimeout(()=>{v()},300);return()=>{clearTimeout(P),R.current=!1}},[f.pathname,j,y.height,s.length]),r.useEffect(()=>{let w=null,v=null;const P=(u=0)=>{const L=g.current;if(!L){u<20&&setTimeout(()=>P(u+1),100);return}let E=null;if(L.element)E=L.element;else if(t.current){const M=t.current.querySelector('[style*="overflow"]');M&&M.scrollHeight>M.clientHeight&&(E=M)}if(!E){u<20&&setTimeout(()=>P(u+1),100);return}const D=()=>{R.current||(w&&clearTimeout(w),w=setTimeout(()=>{const M=E.scrollTop;Qe(j,M)},150))};E.addEventListener("scroll",D,{passive:!0}),v=()=>{if(w&&clearTimeout(w),E.removeEventListener("scroll",D),!R.current&&E){const M=E.scrollTop;Qe(j,M)}}};return P(),()=>{v&&v()}},[g.current,j,s.length]);const k=({index:w,style:v})=>{const P=s[w];return e.jsx("div",{style:v,children:e.jsx(ct,{game:P,onGameClick:c,onPlay:i,onEditClick:a,onGameDelete:d,onGameUpdate:m,buildCoverUrl:b,itemRefs:l,index:w,allCollections:x})})};return y.width===0||y.height===0?e.jsx("div",{style:{width:"100%",height:"100%"}}):e.jsx(st,{listRef:g,className:"virtualized-games-list-detail",defaultHeight:y.height,rowCount:s.length,rowHeight:Ot,overscanCount:Ht,rowComponent:k,rowProps:{},style:{height:y.height,width:y.width},onResize:w=>{T({width:w.width,height:w.height})}})}const Vt=100,Xe=100;function ct({game:s,onGameClick:t,onPlay:l,onEditClick:c,onGameDelete:i,onGameUpdate:a,buildCoverUrl:d,itemRefs:m,index:b,allCollections:x=[]}){const{t:f,i18n:y}=ce(),T=b%2===0,g=Xe*1.5,R=r.useRef(s.cover),j=R.current!==s.cover;j&&(R.current=s.cover);const k=r.useMemo(()=>d(Pe,s.cover,j),[s.cover,j,d]),w=u=>{u.stopPropagation(),c(s)},[v,P]=r.useState(!1);return r.useEffect(()=>{const u=E=>{E.detail?.gameId===s.id&&P(!0)},L=E=>{E.detail?.gameId===s.id&&P(!1)};return window.addEventListener("dropdownMenuOpened",u),window.addEventListener("dropdownMenuClosed",L),()=>{window.removeEventListener("dropdownMenuOpened",u),window.removeEventListener("dropdownMenuClosed",L)}},[s.id]),e.jsxs("div",{ref:u=>{u&&m?.current&&m.current.set(s.id,u)},className:`group cursor-pointer mb-6 games-list-detail-item ${T?"even":"odd"}${v?" detail-dropdown-open":""}`,onClick:()=>t(s),children:[e.jsx(It,{title:s.title,coverUrl:k,width:Xe,height:g,onPlay:l?()=>l(s):void 0,showTitle:!1,detail:!1,play:!!(s.executables&&s.executables.length>0),showBorder:!1},`${s.id}-${s.cover}`),e.jsxs("div",{className:"games-list-detail-content",children:[e.jsx("div",{className:"text-white mb-2 games-list-detail-title",children:s.title}),s.year!==null&&s.year!==void 0||s.stars!==null&&s.stars!==void 0?e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",flexWrap:"wrap"},children:[s.year!==null&&s.year!==void 0&&e.jsx("div",{className:"text-gray-500",style:{fontSize:"0.85rem"},children:_e(s,f,y)||s.year.toString()}),s.stars!==null&&s.stars!==void 0&&e.jsx(ot,{rating:s.stars/10*5,starSize:14,gap:3})]}):null,s.summary&&e.jsx(Et,{summary:s.summary,truncateOnly:!0,maxLines:2,fontSize:"0.85rem"})]}),e.jsxs("div",{className:"games-list-detail-actions",children:[e.jsx("button",{onClick:w,className:"games-list-detail-edit-button","aria-label":"Edit",children:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),e.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]})}),e.jsx(rt,{game:s,allCollections:x}),s.executables&&s.executables.length>1&&l&&e.jsx(nt,{gameId:s.id,gameExecutables:s.executables,onPlayExecutable:u=>{l&&l(s,u)}}),e.jsx(at,{gameId:s.id,gameTitle:s.title,gameExecutables:s.executables,onAddToCollection:()=>{},onGameDelete:i?u=>{s.id===u&&i(s)}:void 0,onGameUpdate:a?u=>{u.id===s.id&&a(u)}:void 0,className:"games-list-detail-dropdown-menu"})]})]})}function Ut({games:s,onGameClick:t,onPlay:l,onGameUpdate:c,onGameDelete:i,buildCoverUrl:a,itemRefs:d,allCollections:m=[],scrollContainerRef:b}){const{t:x}=ce(),f=lt();if(s.length===0)return e.jsx("div",{className:"centered-content h-full min-h-[400px]",children:e.jsx("div",{className:"text-gray-400 text-center",children:x("table.noGames")})});const y=R=>{c&&c(R),f.closeEditModal()},T=s.length>Vt,g=r.useRef(null);return e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:g,className:"games-list-detail-container",style:{height:T?"100%":void 0},children:T?e.jsx(_t,{games:s,containerRef:b||g,itemRefs:d,onGameClick:t,onPlay:l,onEditClick:f.openEditModal,onGameDelete:i,onGameUpdate:c,buildCoverUrl:a,allCollections:m}):s.map((R,j)=>e.jsx(ct,{game:R,onGameClick:t,onPlay:l,onEditClick:f.openEditModal,onGameDelete:i,onGameUpdate:c,buildCoverUrl:a,itemRefs:d,index:j,allCollections:m},R.id))}),f.selectedGame&&e.jsx(Ve,{isOpen:f.isEditModalOpen,onClose:f.closeEditModal,game:f.selectedGame,onGameUpdate:y})]})}function ut({game:s,index:t,itemRefs:l,onGameClick:c,onPlay:i,onGameUpdate:a,onGameDelete:d,allCollections:m=[],columnVisibility:b,handleRatingChange:x,formatRating:f,formatGameDate:y,t:T,i18n:g,editGame:R,useDiv:j=!1}){const w=t%2===0?"even-row":"odd-row",v=j?"div":"tr",P=j?"div":"td",u=j?{display:"table-row"}:void 0,L=j?{display:"table-cell"}:void 0,[E,D]=r.useState(!1);r.useEffect(()=>{const h=z=>{z.detail?.gameId===s.id&&D(!0)},I=z=>{z.detail?.gameId===s.id&&D(!1)};return window.addEventListener("dropdownMenuOpened",h),window.addEventListener("dropdownMenuClosed",I),()=>{window.removeEventListener("dropdownMenuOpened",h),window.removeEventListener("dropdownMenuClosed",I)}},[s.id]);const M=b.title?"title":b.releaseDate?"releaseDate":b.stars?"stars":b.year?"year":b.criticRating?"criticRating":b.ageRating?"ageRating":null,Z=()=>{if(!s.executables||s.executables.length===0)return null;const h=I=>{I.stopPropagation(),i&&i(s)};return e.jsx("button",{className:"first-cell-play-button","aria-label":"Play game",onClick:h,children:e.jsx("svg",{width:"36",height:"36",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M8 5v14l11-7z",fill:"currentColor"})})})};return e.jsxs(v,{ref:h=>{h&&l?.current&&l.current.set(s.id,h)},style:u,role:j?"row":void 0,className:E?"row-dropdown-open":void 0,children:[e.jsx(P,{className:"column-menu-cell",style:L,role:j?"cell":void 0}),b.title&&e.jsxs(P,{className:`title-cell ${w} ${M==="title"?"first-visible-cell":""}`,style:L,role:j?"cell":void 0,children:[M==="title"&&i&&e.jsx(Z,{}),e.jsx(Ke,{text:s.title,delay:1e3,children:e.jsx("span",{className:M==="title"?"first-cell-text":"title-cell-text",onClick:()=>c(s),children:s.title})})]}),b.releaseDate&&e.jsxs(P,{className:`date-cell ${w} ${b.stars||b.year||b.criticRating?"has-border-right":""} ${M==="releaseDate"?"first-visible-cell":""}`,style:L,role:j?"cell":void 0,children:[M==="releaseDate"&&i&&e.jsx(Z,{}),e.jsx("span",{className:M==="releaseDate"?"first-cell-text":"",children:y(s,T,g)||"-"})]}),b.stars&&e.jsxs(P,{className:`stars-cell ${w} ${M==="stars"?"first-visible-cell":""}`,style:L,role:j?"cell":void 0,children:[M==="stars"&&i&&e.jsx(Z,{}),e.jsx("div",{className:M==="stars"?"first-cell-text":"",style:{display:"flex",alignItems:"center"},children:e.jsx(ot,{rating:s.stars?s.stars/10*5:0,starSize:14,gap:3,color:"rgba(255, 255, 255, 0.4)",noStroke:!0,readOnly:!De,onRatingChange:De?h=>x(s.id,h):void 0})})]}),b.year&&e.jsxs(P,{className:`year-cell ${w} has-border-right ${M==="year"?"first-visible-cell":""}`,style:L,role:j?"cell":void 0,children:[M==="year"&&i&&e.jsx(Z,{}),e.jsx("span",{className:M==="year"?"first-cell-text":"",children:s.year||"-"})]}),b.criticRating&&e.jsxs(P,{className:`critic-rating-cell ${w} has-border-right ${M==="criticRating"?"first-visible-cell":""}`,style:L,role:j?"cell":void 0,children:[M==="criticRating"&&i&&e.jsx(Z,{}),e.jsx("div",{className:M==="criticRating"?"first-cell-text":"",style:{display:"flex",alignItems:"center",gap:"12px",flexWrap:"wrap"},children:(()=>{const h=f(s.criticratings),I=f(s.userratings);return h===null&&I===null?e.jsx("span",{children:"-"}):e.jsxs(e.Fragment,{children:[h!==null&&e.jsx(Ke,{text:T("gameDetail.criticRating"),children:e.jsxs("div",{className:"text-white",style:{opacity:.8,fontFamily:"var(--font-body-2-font-family)",fontSize:"var(--font-body-2-font-size)",lineHeight:"var(--font-body-2-line-height)",display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"#FFD700",stroke:"#FFA500",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",style:{flexShrink:0},children:e.jsx("path",{d:"M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z"})}),h]})}),I!==null&&e.jsx(Ke,{text:T("gameDetail.userRating"),children:e.jsxs("div",{className:"text-white",style:{opacity:.8,fontFamily:"var(--font-body-2-font-family)",fontSize:"var(--font-body-2-font-size)",lineHeight:"var(--font-body-2-line-height)",display:"flex",alignItems:"center",gap:"8px"},children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"#4CAF50",stroke:"#2E7D32",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",style:{flexShrink:0},children:[e.jsx("path",{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"9",cy:"7",r:"4"}),e.jsx("path",{d:"M23 21v-2a4 4 0 0 0-3-3.87"}),e.jsx("path",{d:"M16 3.13a4 4 0 0 1 0 7.75"})]}),I]})})]})})()})]}),b.ageRating&&e.jsxs(P,{className:`age-rating-cell ${w} has-border-right ${M==="ageRating"?"first-visible-cell":""}`,style:L,role:j?"cell":void 0,children:[M==="ageRating"&&i&&e.jsx(Z,{}),e.jsx("div",{className:M==="ageRating"?"first-cell-text":"",children:s.ageRatings&&s.ageRatings.length>0?e.jsx(Rt,{ageRatings:s.ageRatings}):e.jsx("span",{children:"-"})})]}),e.jsx(P,{className:`games-table-edit-cell ${w}`,style:L,role:j?"cell":void 0,children:e.jsxs("div",{className:"games-table-actions",children:[e.jsx("button",{onClick:h=>{h.stopPropagation(),R.openEditModal(s)},className:"games-table-edit-button","aria-label":"Edit",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),e.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]})}),e.jsx(rt,{game:s,allCollections:m}),s.executables&&s.executables.length>1&&i&&e.jsx(nt,{gameId:s.id,gameExecutables:s.executables,onPlayExecutable:h=>{i&&i(s,h)}}),e.jsx(at,{gameId:s.id,gameTitle:s.title,gameExecutables:s.executables,onAddToCollection:()=>{},onGameDelete:d?h=>{const I=s.id===h?s:null;I&&d(I)}:void 0,onGameUpdate:a?h=>{h.id===s.id&&a(h)}:void 0,className:"games-table-dropdown-menu"})]})})]},s.id)}function Wt(s){try{const t=sessionStorage.getItem(s);return t?parseFloat(t):null}catch{return null}}function qt(s,t){try{sessionStorage.setItem(s,t.toString())}catch{}}const Zt=56,Jt=5;function Qt({games:s,containerRef:t,itemRefs:l,onGameClick:c,onPlay:i,onGameUpdate:a,onGameDelete:d,allCollections:m=[],columnVisibility:b,handleRatingChange:x,formatRating:f,formatGameDate:y,t:T,i18n:g,editGame:R}){const j=Ce(),[k,w]=r.useState({width:0,height:0}),v=r.useRef(null),P=r.useRef(!1),u=r.useRef(null),L=`${j.pathname}:table`,[E,D]=r.useState(!1),M=At({defaultRowHeight:Zt});r.useEffect(()=>{t&&"current"in t&&t.current&&(t.current.__virtualizedListRef=v)},[t]),r.useEffect(()=>{const h=()=>{if(t.current){const z=t.current.getBoundingClientRect();w({width:z.width-40,height:z.height||window.innerHeight-200})}};h(),window.addEventListener("resize",h);const I=new ResizeObserver(h);return t.current&&I.observe(t.current),()=>{window.removeEventListener("resize",h),I.disconnect()}},[t]),r.useEffect(()=>{if(k.height===0||s.length===0)return;const h=Wt(L);if(h===null||h<0){D(!0);return}P.current=!0;const I=(z=0)=>{const U=v.current;if(!U){z<50?setTimeout(()=>I(z+1),50):(P.current=!1,D(!0));return}let H=null;if(U.element)H=U.element;else if(t.current){const C=t.current.querySelector('[style*="overflow"]');C&&C.scrollHeight>C.clientHeight&&(H=C)}if(!H){z<20?setTimeout(()=>I(z+1),50):(P.current=!1,D(!0));return}H.scrollTop=h,setTimeout(()=>{P.current=!1,D(!0)},50)};I()},[k.height,s.length,L,t]),r.useEffect(()=>{if(P.current||k.height===0)return;const h=v.current;if(!h)return;let I=null;if(h.element?I=h.element:t.current&&(I=t.current.querySelector('[style*="overflow"]')),!I)return;const z=()=>{if(P.current)return;const H=I?.scrollTop||0;u.current!==null&&Math.abs(u.current-H)<10||(u.current=H,qt(L,H))};let U;return I.addEventListener("scroll",()=>{clearTimeout(U),U=window.setTimeout(z,100)},{passive:!0}),()=>{clearTimeout(U),I?.removeEventListener("scroll",z)}},[k.height,L,t]);const Z=({index:h,style:I,dynamicRowHeight:z})=>{const U=s[h],H=r.useRef(null);return r.useEffect(()=>!H.current||!z?void 0:z.observeRowElements([H.current]),[h,z]),U?e.jsx("div",{ref:H,style:I,className:"virtualized-table-row-wrapper",children:e.jsx(ut,{game:U,index:h,itemRefs:l,onGameClick:c,onPlay:i,onGameUpdate:a,onGameDelete:d,allCollections:m,columnVisibility:b,handleRatingChange:x,formatRating:f,formatGameDate:y,t:T,i18n:g,editGame:R,useDiv:!0})}):null};return k.height===0||s.length===0?e.jsx("div",{style:{width:"100%",height:"100%"}}):e.jsx("div",{style:{opacity:E?1:0,transition:E?"opacity 0.1s":"none"},children:e.jsx("div",{className:"virtualized-games-table-wrapper",children:e.jsx(st,{listRef:v,className:"virtualized-games-table-list",defaultHeight:k.height,rowCount:s.length,rowHeight:M,overscanCount:Jt,rowComponent:Z,rowProps:{dynamicRowHeight:M},style:{height:k.height,width:k.width},onResize:h=>{w({width:h.width,height:h.height})}})})})}const Xt=100;function Yt({games:s,onGameClick:t,onPlay:l,onGameUpdate:c,onGameDelete:i,itemRefs:a,scrollContainerRef:d,allCollections:m=[],columnVisibility:b}){const x=r.useRef(null),f=d||x;tt(f,"table");const[y,T]=r.useState(s),g=lt();r.useEffect(()=>{T(s)},[s]);const R=async(L,E)=>{if(De)try{const D=He(Pe,`/games/${L}`);if((await fetch(D,{method:"PUT",headers:{"Content-Type":"application/json","X-Auth-Token":De},body:JSON.stringify({stars:E})})).ok){const Z=y.map(h=>h.id===L?{...h,stars:E}:h);T(Z)}else console.error("Failed to update rating")}catch(D){console.error("Error updating rating:",D)}},j=L=>{const E=y.map(D=>D.id===L.id?L:D);T(E),c&&c(L),g.closeEditModal()},{t:k,i18n:w}=ce();if(s.length===0)return e.jsx("div",{className:"centered-content h-full min-h-[400px]",children:e.jsx("div",{className:"text-gray-400 text-center",children:k("table.noGames")})});const v=L=>{if(L==null||isNaN(L))return null;const E=Number(L);return E<0||E>10?null:E%1===0?E.toString():E.toFixed(1)},P=y.length>Xt,u=r.useRef(null);if(P){const L=d??u;return e.jsxs("div",{className:"games-table-container",children:[e.jsx("div",{className:"games-table-scroll virtualized-table-scroll",ref:L,children:e.jsx(Qt,{games:y,containerRef:L,itemRefs:a,onGameClick:t,onPlay:l,onGameUpdate:c,onGameDelete:i,allCollections:m,columnVisibility:b,handleRatingChange:R,formatRating:v,formatGameDate:_e,t:k,i18n:w,editGame:g})}),g.selectedGame&&e.jsx(Ve,{isOpen:g.isEditModalOpen,onClose:g.closeEditModal,game:g.selectedGame,onGameUpdate:j})]})}return e.jsxs("div",{className:"games-table-container",children:[e.jsx("div",{className:"games-table-scroll",ref:f,children:e.jsx("table",{className:"games-table",children:e.jsx("tbody",{children:y.map((L,E)=>e.jsx(ut,{game:L,index:E,itemRefs:a,onGameClick:t,onPlay:l,onGameUpdate:c,onGameDelete:i,allCollections:m,columnVisibility:b,handleRatingChange:R,formatRating:v,formatGameDate:_e,t:k,i18n:w,editGame:g},L.id))})})}),g.selectedGame&&e.jsx(Ve,{isOpen:g.isEditModalOpen,onClose:g.closeEditModal,game:g.selectedGame,onGameUpdate:j})]})}function Ct({columnVisibility:s,onToggleColumn:t,sortField:l,sortAscending:c=!0,onSort:i}){const{t:a,i18n:d}=ce(),[m,b]=r.useState(!1),x=r.useRef(null);r.useEffect(()=>{function g(R){x.current&&!x.current.contains(R.target)&&b(!1)}return document.addEventListener("mousedown",g),()=>{document.removeEventListener("mousedown",g)}},[]);const f=g=>l!==g?"":c?"↑":"↓",y=r.useMemo(()=>[{key:"title",label:a("table.title")},{key:"releaseDate",label:a("table.releaseDate")},{key:"year",label:a("table.year")},{key:"stars",label:a("table.stars")},{key:"criticRating",label:a("table.criticRating")},{key:"ageRating",label:a("table.ageRating")}],[a,d.language]),T=s.title?"title":s.releaseDate?"releaseDate":s.stars?"stars":s.year?"year":s.criticRating?"criticRating":s.ageRating?"ageRating":null;return e.jsx("div",{className:"games-table-header-section",children:e.jsx("table",{className:"games-table-header-table",children:e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"games-table-header-table th column-menu",children:e.jsxs("div",{className:"games-table-column-menu-wrapper",ref:x,children:[e.jsxs("button",{onClick:()=>b(!m),className:"games-table-column-menu-button",children:[e.jsx("svg",{width:"16",height:"16",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"})}),e.jsx("svg",{width:"12",height:"12",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:1.5,className:`games-table-column-menu-arrow ${m?"open":""}`,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 8.25l-7.5 7.5-7.5-7.5"})})]}),m&&e.jsx("div",{className:"games-table-column-menu-popup",children:y.map(g=>e.jsxs("button",{className:`games-table-column-menu-item ${s[g.key]?"selected":""}`,onClick:()=>t(g.key),children:[e.jsx("span",{children:g.label}),s[g.key]&&e.jsx("svg",{className:"games-table-column-menu-check",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z",fill:"#E5A00D"})})]},g.key))})]})}),s.title&&e.jsxs("th",{onClick:()=>i("title"),className:`title-cell has-border-right ${T==="title"?"first-visible-cell":""} ${l==="title"?"sorted":""}`,children:[e.jsx("span",{children:a("table.title")}),e.jsx("span",{className:"sort-indicator",children:f("title")})]}),s.releaseDate&&e.jsxs("th",{onClick:()=>i("releaseDate"),className:`date-cell has-border-right ${T==="releaseDate"?"first-visible-cell":""} ${l==="releaseDate"?"sorted":""}`,children:[e.jsx("span",{children:a("table.releaseDate")}),e.jsx("span",{className:"sort-indicator",children:f("releaseDate")})]}),s.stars&&e.jsxs("th",{onClick:()=>i("stars"),className:`stars-cell has-border-right ${T==="stars"?"first-visible-cell":""} ${l==="stars"?"sorted":""}`,children:[e.jsx("span",{children:a("table.stars")}),e.jsx("span",{className:"sort-indicator",children:f("stars")})]}),s.year&&e.jsxs("th",{onClick:()=>i("year"),className:`year-cell has-border-right ${T==="year"?"first-visible-cell":""} ${l==="year"?"sorted":""}`,children:[e.jsx("span",{children:a("table.year")}),e.jsx("span",{className:"sort-indicator",children:f("year")})]}),s.criticRating&&e.jsxs("th",{onClick:()=>i("criticRating"),className:`critic-rating-cell has-border-right ${T==="criticRating"?"first-visible-cell":""} ${l==="criticRating"?"sorted":""}`,children:[e.jsx("span",{children:a("table.criticRating")}),e.jsx("span",{className:"sort-indicator",children:f("criticRating")})]}),s.ageRating&&e.jsxs("th",{onClick:()=>i("ageRating"),className:`age-rating-cell has-border-right ${T==="ageRating"?"first-visible-cell":""} ${l==="ageRating"?"sorted":""}`,children:[e.jsx("span",{children:a("table.ageRating")}),e.jsx("span",{className:"sort-indicator",children:f("ageRating")})]}),e.jsx("th",{className:"games-table-edit-header"})]})})})})}function Le({isOpen:s,onClose:t,onCloseCompletely:l,selectedValue:c,onSelect:i,games:a=[],config:d,additionalData:m}){const{t:b}=ce(),[x,f]=r.useState(""),y=r.useRef(null),T=r.useMemo(()=>d.getAvailableValues(a,m),[a,d,m]),g=r.useMemo(()=>{if(!x)return T;const k=x.toLowerCase();return T.filter(w=>w.label.toLowerCase().includes(k)||w.value?.toString().toLowerCase().includes(k))},[T,x]);r.useEffect(()=>{if(!s)return;function k(w){y.current&&!y.current.contains(w.target)&&l()}return document.addEventListener("mousedown",k),()=>{document.removeEventListener("mousedown",k)}},[s,l]),r.useEffect(()=>{if(!s)return;function k(w){w.key==="Escape"&&l()}return document.addEventListener("keydown",k),()=>{document.removeEventListener("keydown",k)}},[s,l]),r.useEffect(()=>{s&&f("")},[s]);const R=()=>{t()},j=k=>{i(k)};return s?e.jsxs("div",{className:"filter-popup",ref:y,children:[e.jsxs("div",{className:"filter-popup-header",children:[e.jsx("button",{className:"filter-popup-back",onClick:R,children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M15 18l-6-6 6-6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),e.jsx("span",{className:"filter-popup-header-title",children:b(d.labelKey)})]}),e.jsx("div",{className:"filter-popup-search",children:e.jsx("input",{id:`filter-search-${d.type}`,name:"filterSearch",type:"text",className:"filter-popup-search-input",placeholder:b(d.searchPlaceholderKey),value:x,onChange:k=>f(k.target.value),onClick:k=>k.stopPropagation(),"aria-label":b(d.searchPlaceholderKey)})}),e.jsx("div",{className:`filter-popup-content ${d.isScrollable?"filter-popup-scrollable":""}`,children:g.map(k=>e.jsx("button",{className:`filter-popup-item ${c===k.value?"active":""}`,onClick:()=>j(k.value),children:k.label},k.value?.toString()||"null"))})]}):null}const Ft={type:"year",labelKey:"gamesListToolbar.filter.year",searchPlaceholderKey:"gamesListToolbar.filter.searchYear",getAvailableValues:s=>{const t=new Set;return s.forEach(l=>{l.year!==null&&l.year!==void 0&&t.add(l.year)}),Array.from(t).sort((l,c)=>c-l).map(l=>({value:l,label:l.toString()}))},formatValue:s=>typeof s=="number"?s.toString():"",isScrollable:!1};function es(s){return e.jsx(Le,{...s,config:Ft})}function ts({availableGenres:s=[],...t}){const{t:l}=ce(),c=r.useMemo(()=>({type:"genre",labelKey:"gamesListToolbar.filter.genre",searchPlaceholderKey:"gamesListToolbar.filter.searchGenre",getAvailableValues:(a,d)=>(d?.availableGenres||s).map(b=>({value:b.id,label:l(`genre.${b.title}`,b.title)})),formatValue:a=>{const d=s.find(m=>String(m.id)===String(a));return d?l(`genre.${d.title}`,d.title):a!=null?String(a):""},isScrollable:!0}),[s,l]),i=r.useMemo(()=>({availableGenres:s}),[s]);return e.jsx(Le,{...t,config:c,additionalData:i})}const ss=["themes","platforms","gameModes","playerPerspectives","gameEngines"];function Ee({type:s,labelKey:t,searchPlaceholderKey:l,valueExtractor:c,formatValue:i,getLabelForValue:a,...d}){const{tagLabels:m}=Fe(),b=ss.includes(s)?m[s]:null,x=r.useMemo(()=>({type:s,labelKey:t,searchPlaceholderKey:l,getAvailableValues:f=>{const y=new Map;return f.forEach(T=>{(c(T)||[]).forEach(R=>{if(typeof R=="number"&&!Number.isNaN(R)){const j=String(R),k=b?.get(j)??(i?i(j):j);y.set(j,k)}else if(typeof R=="object"&&R!=null&&"id"in R){const j=String(R.id);"title"in R&&typeof R.title=="string"?y.set(j,R.title):"name"in R&&typeof R.name=="string"?y.set(j,R.name):y.set(j,i?i(j):j)}else if(typeof R=="string"&&R.trim()){const j=R.trim();y.set(j,i?i(j):j)}})}),Array.from(y.entries()).sort((T,g)=>T[1].localeCompare(g[1],void 0,{sensitivity:"base"})).map(([T,g])=>({value:T,label:g}))},formatValue:f=>a?a(f):typeof f=="string"?i?i(f):f:String(f),isScrollable:!0}),[b,i,a,t,l,s,c]);return e.jsx(Le,{...d,config:x})}function ls(s){const{t}=ce(),l=r.useMemo(()=>c=>t(`themes.${c}`,c),[t]);return e.jsx(Ee,{...s,type:"themes",labelKey:"gamesListToolbar.filter.themes",searchPlaceholderKey:"gamesListToolbar.filter.searchThemes",valueExtractor:c=>c.themes,formatValue:l,getLabelForValue:c=>Ae(s.games,"themes",c)})}function rs(s){return e.jsx(Ee,{...s,type:"keywords",labelKey:"gamesListToolbar.filter.keywords",searchPlaceholderKey:"gamesListToolbar.filter.searchKeywords",valueExtractor:t=>t.keywords})}function ns(s){return e.jsx(Ee,{...s,type:"platforms",labelKey:"gamesListToolbar.filter.platforms",searchPlaceholderKey:"gamesListToolbar.filter.searchPlatforms",valueExtractor:t=>t.platforms,getLabelForValue:t=>Ae(s.games,"platforms",t)})}function as(s){const{t}=ce(),l=r.useMemo(()=>c=>t(`gameModes.${c}`,c),[t]);return e.jsx(Ee,{...s,type:"gameModes",labelKey:"gamesListToolbar.filter.gameModes",searchPlaceholderKey:"gamesListToolbar.filter.searchGameModes",valueExtractor:c=>c.gameModes,formatValue:l,getLabelForValue:c=>Ae(s.games,"gameModes",c)})}function is(s){const{availablePublishers:t=[],...l}=s,c=r.useMemo(()=>{if(t.length!==0)return i=>{const a=t.find(d=>String(d.id)===String(i));return a?a.title:i}},[t]);return e.jsx(Ee,{...l,type:"publishers",labelKey:"gamesListToolbar.filter.publishers",searchPlaceholderKey:"gamesListToolbar.filter.searchPublishers",valueExtractor:i=>i.publishers??[],formatValue:c})}function os(s){const{availableDevelopers:t=[],...l}=s,c=r.useMemo(()=>{if(t.length!==0)return i=>{const a=t.find(d=>String(d.id)===String(i));return a?a.title:i}},[t]);return e.jsx(Ee,{...l,type:"developers",labelKey:"gamesListToolbar.filter.developers",searchPlaceholderKey:"gamesListToolbar.filter.searchDevelopers",valueExtractor:i=>i.developers??[],formatValue:c})}function cs(s){const{t}=ce(),l=r.useMemo(()=>c=>t(`playerPerspectives.${c}`,c),[t]);return e.jsx(Ee,{...s,type:"playerPerspectives",labelKey:"gamesListToolbar.filter.playerPerspectives",searchPlaceholderKey:"gamesListToolbar.filter.searchPlayerPerspectives",valueExtractor:c=>c.playerPerspectives,formatValue:l,getLabelForValue:c=>Ae(s.games,"playerPerspectives",c)})}function us(s){return e.jsx(Ee,{...s,type:"gameEngines",labelKey:"gamesListToolbar.filter.gameEngines",searchPlaceholderKey:"gamesListToolbar.filter.searchGameEngines",valueExtractor:t=>t.gameEngines,getLabelForValue:t=>Ae(s.games,"gameEngines",t)})}const ds={type:"decade",labelKey:"gamesListToolbar.filter.decade",searchPlaceholderKey:"gamesListToolbar.filter.searchDecade",getAvailableValues:s=>{const t=new Set;return s.forEach(l=>{if(l.year!==null&&l.year!==void 0){const c=Math.floor(l.year/10)*10;t.add(c)}}),Array.from(t).sort((l,c)=>c-l).map(l=>({value:l,label:`${l}s`}))},formatValue:s=>typeof s=="number"?`${s}s`:"",isScrollable:!1};function fs(s){return e.jsx(Le,{...s,config:ds})}function gs({availableCollections:s=[],...t}){const l=r.useMemo(()=>({type:"collection",labelKey:"gamesListToolbar.filter.collection",searchPlaceholderKey:"gamesListToolbar.filter.searchCollection",getAvailableValues:(i,a)=>(a?.availableCollections||s).map(m=>({value:m.id,label:m.title})),formatValue:i=>{if(i==null)return"";const a=s.find(d=>String(d.id)===String(i));return a?a.title:""},isScrollable:!0}),[s]),c=r.useMemo(()=>({availableCollections:s}),[s]);return e.jsx(Le,{...t,config:l,additionalData:c})}function ps({availableSeries:s=[],...t}){const l=r.useMemo(()=>({type:"series",labelKey:"gamesListToolbar.filter.series",searchPlaceholderKey:"gamesListToolbar.filter.searchSeries",getAvailableValues:(i,a)=>(a?.availableSeries??s).map(m=>({value:m.id,label:m.title})),formatValue:i=>{if(i==null)return"";const a=s.find(d=>String(d.id)===String(i));return a?a.title:""},isScrollable:!0}),[s]),c=r.useMemo(()=>({availableSeries:s}),[s]);return e.jsx(Le,{...t,config:l,additionalData:c})}function ms({availableFranchises:s=[],...t}){const l=r.useMemo(()=>({type:"franchise",labelKey:"gamesListToolbar.filter.franchise",searchPlaceholderKey:"gamesListToolbar.filter.searchFranchise",getAvailableValues:(i,a)=>(a?.availableFranchises??s).map(m=>({value:m.id,label:m.title})),formatValue:i=>{if(i==null)return"";const a=s.find(d=>String(d.id)===String(i));return a?a.title:""},isScrollable:!0}),[s]),c=r.useMemo(()=>({availableFranchises:s}),[s]);return e.jsx(Le,{...t,config:l,additionalData:c})}function hs({games:s=[],...t}){const{t:l,i18n:c}=ce(),i={type:"ageRating",labelKey:"gamesListToolbar.filter.ageRating",searchPlaceholderKey:"gamesListToolbar.filter.searchAgeRating",getAvailableValues:a=>{const d=new Map;return a.forEach(m=>{m.ageRatings&&m.ageRatings.length>0&&kt(m.ageRatings,c.language).forEach(x=>{const f=`${x.category}-${x.rating}`;d.has(f)||d.set(f,{category:x.category,rating:x.rating})})}),Array.from(d.values()).map(m=>{const b=Oe(m.category,m.rating,l);return{value:`${m.category}-${m.rating}`,label:b}}).sort((m,b)=>{const[x,f]=m.value.split("-").map(Number),[y,T]=b.value.split("-").map(Number);return x!==y?x-y:f-T})},formatValue:a=>{if(typeof a=="string"&&a.includes("-")){const[d,m]=a.split("-").map(Number);return Oe(d,m,l)}return""},isScrollable:!0};return e.jsx(Le,{...t,config:i,games:s})}function ne({type:s,isOpen:t,onClose:l,onCloseCompletely:c,selectedValue:i,onSelect:a,games:d=[],availableGenres:m=[],availableCollections:b=[],availableSeries:x=[],availableFranchises:f=[],availableDevelopers:y=[],availablePublishers:T=[]}){const g={isOpen:t,onClose:l,onCloseCompletely:c,selectedValue:i,onSelect:a,games:d};switch(s){case"year":return e.jsx(es,{...g});case"genre":return e.jsx(ts,{...g,availableGenres:m});case"themes":return e.jsx(ls,{...g});case"keywords":return e.jsx(rs,{...g});case"platforms":return e.jsx(ns,{...g});case"gameModes":return e.jsx(as,{...g});case"publishers":return e.jsx(is,{...g,availablePublishers:T});case"developers":return e.jsx(os,{...g,availableDevelopers:y});case"playerPerspectives":return e.jsx(cs,{...g});case"gameEngines":return e.jsx(us,{...g});case"decade":return e.jsx(fs,{...g});case"collection":return e.jsx(gs,{...g,availableCollections:b});case"series":return e.jsx(ps,{...g,availableSeries:x});case"franchise":return e.jsx(ms,{...g,availableFranchises:f});case"ageRating":return e.jsx(hs,{...g});default:return null}}function vs({isOpen:s,onClose:t,currentFilter:l,selectedYear:c,selectedGenre:i,selectedThemes:a,selectedKeywords:d,selectedPlatforms:m,selectedGameModes:b,selectedPublishers:x,selectedDevelopers:f,selectedPlayerPerspectives:y,selectedGameEngines:T,selectedDecade:g,selectedCollection:R,selectedSeries:j,selectedFranchise:k,selectedAgeRating:w,onFilterChange:v,onYearFilterChange:P,onGenreFilterChange:u,onThemesFilterChange:L,onKeywordsFilterChange:E,onPlatformsFilterChange:D,onGameModesFilterChange:M,onPublishersFilterChange:Z,onDevelopersFilterChange:h,onPlayerPerspectivesFilterChange:I,onGameEnginesFilterChange:z,onDecadeFilterChange:U,onCollectionFilterChange:H,onSeriesFilterChange:C,onFranchiseFilterChange:ee,onAgeRatingFilterChange:se,games:V=[],availableGenres:pe=[],availableCollections:ae=[],availableSeries:Se=[],availableFranchises:ie=[],availableDevelopers:ve=[],availablePublishers:oe=[]}){const{t:J}=ce(),[O,S]=r.useState(null),te=r.useRef(null),n=r.useRef(null),K=r.useRef(!1),be=r.useRef(!0);r.useEffect(()=>{s&&(be.current?(S(null),be.current=!1,l==="year"?n.current="year":l==="genre"?n.current="genre":l==="themes"?n.current="themes":l==="keywords"?n.current="keywords":l==="platforms"?n.current="platforms":l==="gameModes"?n.current="gameModes":l==="publishers"?n.current="publishers":l==="developers"?n.current="developers":l==="playerPerspectives"?n.current="playerPerspectives":l==="gameEngines"?n.current="gameEngines":l==="decade"?n.current="decade":l==="collection"?n.current="collection":l==="series"?n.current="series":l==="franchise"?n.current="franchise":l==="ageRating"?n.current="ageRating":n.current=null,K.current=!1):K.current?(S(null),l==="year"?n.current="year":l==="genre"?n.current="genre":l==="themes"?n.current="themes":l==="keywords"?n.current="keywords":l==="platforms"?n.current="platforms":l==="gameModes"?n.current="gameModes":l==="publishers"?n.current="publishers":l==="developers"?n.current="developers":l==="playerPerspectives"?n.current="playerPerspectives":l==="gameEngines"?n.current="gameEngines":l==="decade"?n.current="decade":l==="collection"?n.current="collection":l==="series"?n.current="series":l==="franchise"?n.current="franchise":l==="ageRating"&&(n.current="ageRating")):l==="year"?(S("year"),n.current="year"):l==="genre"?(S("genre"),n.current="genre"):l==="themes"?(S("themes"),n.current="themes"):l==="keywords"?(S("keywords"),n.current="keywords"):l==="platforms"?(S("platforms"),n.current="platforms"):l==="gameModes"?(S("gameModes"),n.current="gameModes"):l==="publishers"?(S("publishers"),n.current="publishers"):l==="developers"?(S("developers"),n.current="developers"):l==="playerPerspectives"?(S("playerPerspectives"),n.current="playerPerspectives"):l==="gameEngines"?(S("gameEngines"),n.current="gameEngines"):l==="decade"?(S("decade"),n.current="decade"):l==="collection"?(S("collection"),n.current="collection"):l==="series"?(S("series"),n.current="series"):l==="franchise"?(S("franchise"),n.current="franchise"):l==="ageRating"?(S("ageRating"),n.current="ageRating"):n.current?S(n.current):S(null))},[s,l]),r.useEffect(()=>{if(!s&&!O)return;function o($){const ze=$.target;let Te=!1;s&&te.current&&(Te=!te.current.contains(ze)),Te&&!O&&t()}return document.addEventListener("mousedown",o),()=>{document.removeEventListener("mousedown",o)}},[s,O,t]),r.useEffect(()=>{if(!s&&!O)return;function o($){$.key==="Escape"&&(O?(S(null),K.current=!0):t())}return document.addEventListener("keydown",o),()=>{document.removeEventListener("keydown",o)}},[s,O,t]);const W=o=>{o==="year"?(S("year"),n.current="year",K.current=!1):o==="genre"?(S("genre"),n.current="genre",K.current=!1):o==="themes"?(S("themes"),n.current="themes",K.current=!1):o==="keywords"?(S("keywords"),n.current="keywords",K.current=!1):o==="platforms"?(S("platforms"),n.current="platforms",K.current=!1):o==="gameModes"?(S("gameModes"),n.current="gameModes",K.current=!1):o==="publishers"?(S("publishers"),n.current="publishers",K.current=!1):o==="developers"?(S("developers"),n.current="developers",K.current=!1):o==="playerPerspectives"?(S("playerPerspectives"),n.current="playerPerspectives",K.current=!1):o==="gameEngines"?(S("gameEngines"),n.current="gameEngines",K.current=!1):o==="decade"?(S("decade"),n.current="decade",K.current=!1):o==="collection"?(S("collection"),n.current="collection",K.current=!1):o==="series"?(S("series"),n.current="series",K.current=!1):o==="franchise"?(S("franchise"),n.current="franchise",K.current=!1):o==="ageRating"?(S("ageRating"),n.current="ageRating",K.current=!1):(v?.(o),P&&P(null),u&&u(null),L&&L(null),E&&E(null),D&&D(null),M&&M(null),Z&&Z(null),h&&h(null),I&&I(null),z&&z(null),U&&U(null),H&&H(null),C&&C(null),ee&&ee(null),se&&se(null),S(null),n.current=null,t())},le=o=>{const $=typeof o=="number"?o:null;$===null?(v?.("all"),P?.(null),S(null),n.current=null,t()):(v?.("year"),P?.($),n.current="year",t())},X=o=>{o!=="year"&&P?.(null),o!=="genre"&&u?.(null),o!=="themes"&&L?.(null),o!=="keywords"&&E?.(null),o!=="platforms"&&D?.(null),o!=="gameModes"&&M?.(null),o!=="publishers"&&Z?.(null),o!=="developers"&&h?.(null),o!=="playerPerspectives"&&I?.(null),o!=="gameEngines"&&z?.(null),o!=="decade"&&U?.(null),o!=="collection"&&H?.(null),o!=="series"&&C?.(null),o!=="franchise"&&ee?.(null),o!=="ageRating"&&se?.(null)},ue=o=>{const $=typeof o=="string"?o:null;$===null?(v?.("all"),u?.(null),S(null),n.current=null,t()):(v?.("genre"),u?.($),X("genre"),n.current="genre",t())},xe=o=>{const $=typeof o=="string"?o:null;$===null?(v?.("all"),L?.(null),S(null),n.current=null,t()):(v?.("themes"),L?.($),X("themes"),n.current="themes",t())},me=o=>{const $=typeof o=="string"?o:null;$===null?(v?.("all"),E?.(null),S(null),n.current=null,t()):(v?.("keywords"),E?.($),X("keywords"),n.current="keywords",t())},de=o=>{const $=typeof o=="string"?o:null;$===null?(v?.("all"),D?.(null),S(null),n.current=null,t()):(v?.("platforms"),D?.($),X("platforms"),n.current="platforms",t())},ye=o=>{const $=typeof o=="string"?o:null;$===null?(v?.("all"),M?.(null),S(null),n.current=null,t()):(v?.("gameModes"),M?.($),X("gameModes"),n.current="gameModes",t())},we=o=>{const $=typeof o=="string"?o:null;$===null?(v?.("all"),Z?.(null),S(null),n.current=null,t()):(v?.("publishers"),Z?.($),X("publishers"),n.current="publishers",t())},Re=o=>{const $=typeof o=="string"?o:null;$===null?(v?.("all"),h?.(null),S(null),n.current=null,t()):(v?.("developers"),h?.($),X("developers"),n.current="developers",t())},ke=o=>{const $=typeof o=="string"?o:null;$===null?(v?.("all"),I?.(null),S(null),n.current=null,t()):(v?.("playerPerspectives"),I?.($),X("playerPerspectives"),n.current="playerPerspectives",t())},Ne=o=>{const $=typeof o=="string"?o:null;$===null?(v?.("all"),z?.(null),S(null),n.current=null,t()):(v?.("gameEngines"),z?.($),X("gameEngines"),n.current="gameEngines",t())},_=o=>{const $=typeof o=="number"?o:null;$===null?(v?.("all"),U?.(null),S(null),n.current=null,t()):(v?.("decade"),U?.($),X("decade"),n.current="decade",t())},B=o=>{if(o===null)v?.("all"),H?.(null),S(null),n.current=null,t();else{const $=typeof o=="string"?o:String(o);v?.("collection"),H?.($),X("collection"),n.current="collection",t()}},Q=o=>{if(o===null)v?.("all"),C?.(null),S(null),n.current=null,t();else{const $=typeof o=="string"?o:String(o);v?.("series"),C?.($),X("series"),n.current="series",t()}},F=o=>{if(o===null)v?.("all"),ee?.(null),S(null),n.current=null,t();else{const $=typeof o=="string"?o:String(o);v?.("franchise"),ee?.($),X("franchise"),n.current="franchise",t()}},he=o=>{const $=typeof o=="string"?o:null;$===null?(v?.("all"),se?.(null),S(null),n.current=null,t()):(v?.("ageRating"),se?.($),X("ageRating"),n.current="ageRating",t())},q=()=>{S(null),n.current=null,K.current=!0},Y=()=>{S(null),t()};return s&&O==="year"?e.jsx(ne,{type:"year",isOpen:!0,onClose:q,onCloseCompletely:Y,selectedValue:c,onSelect:le,games:V}):s&&O==="genre"?e.jsx(ne,{type:"genre",isOpen:!0,onClose:q,onCloseCompletely:Y,selectedValue:i,onSelect:ue,games:V,availableGenres:pe}):s&&O==="themes"?e.jsx(ne,{type:"themes",isOpen:!0,onClose:q,onCloseCompletely:Y,selectedValue:a,onSelect:xe,games:V}):s&&O==="keywords"?e.jsx(ne,{type:"keywords",isOpen:!0,onClose:q,onCloseCompletely:Y,selectedValue:d,onSelect:me,games:V}):s&&O==="platforms"?e.jsx(ne,{type:"platforms",isOpen:!0,onClose:q,onCloseCompletely:Y,selectedValue:m,onSelect:de,games:V}):s&&O==="gameModes"?e.jsx(ne,{type:"gameModes",isOpen:!0,onClose:q,onCloseCompletely:Y,selectedValue:b,onSelect:ye,games:V}):s&&O==="publishers"?e.jsx(ne,{type:"publishers",isOpen:!0,onClose:q,onCloseCompletely:Y,selectedValue:x,onSelect:we,games:V,availablePublishers:oe}):s&&O==="developers"?e.jsx(ne,{type:"developers",isOpen:!0,onClose:q,onCloseCompletely:Y,selectedValue:f,onSelect:Re,games:V,availableDevelopers:ve}):s&&O==="playerPerspectives"?e.jsx(ne,{type:"playerPerspectives",isOpen:!0,onClose:q,onCloseCompletely:Y,selectedValue:y,onSelect:ke,games:V}):s&&O==="gameEngines"?e.jsx(ne,{type:"gameEngines",isOpen:!0,onClose:q,onCloseCompletely:Y,selectedValue:T,onSelect:Ne,games:V}):s&&O==="decade"?e.jsx(ne,{type:"decade",isOpen:!0,onClose:q,onCloseCompletely:Y,selectedValue:g,onSelect:_,games:V}):s&&O==="collection"?e.jsx(ne,{type:"collection",isOpen:!0,onClose:q,onCloseCompletely:Y,selectedValue:R,onSelect:B,games:V,availableCollections:ae}):s&&O==="series"?e.jsx(ne,{type:"series",isOpen:!0,onClose:q,onCloseCompletely:Y,selectedValue:j,onSelect:Q,games:V,availableSeries:Se}):s&&O==="franchise"?e.jsx(ne,{type:"franchise",isOpen:!0,onClose:q,onCloseCompletely:Y,selectedValue:k,onSelect:F,games:V,availableFranchises:ie}):s&&O==="ageRating"?e.jsx(ne,{type:"ageRating",isOpen:!0,onClose:q,onCloseCompletely:Y,selectedValue:w,onSelect:he,games:V}):!s||O?null:e.jsxs("div",{className:"filter-popup",ref:te,children:[e.jsxs("button",{className:`filter-popup-item ${l==="all"?"selected":""}`,onClick:()=>W("all"),children:[e.jsx("span",{children:J("gamesListToolbar.filter.all")}),l==="all"&&e.jsx("svg",{className:"filter-popup-check",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z",fill:"#E5A00D"})})]}),e.jsx("div",{className:"filter-popup-divider"}),e.jsxs("button",{className:`filter-popup-item ${l==="genre"?"selected":""}`,onClick:()=>W("genre"),children:[e.jsx("span",{children:J("gamesListToolbar.filter.genre")}),l==="genre"&&e.jsx("svg",{className:"filter-popup-check",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z",fill:"#E5A00D"})})]}),e.jsxs("button",{className:`filter-popup-item ${l==="themes"?"selected":""}`,onClick:()=>W("themes"),children:[e.jsx("span",{children:J("gamesListToolbar.filter.themes")}),l==="themes"&&e.jsx("svg",{className:"filter-popup-check",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z",fill:"#E5A00D"})})]}),e.jsxs("button",{className:`filter-popup-item ${l==="keywords"?"selected":""}`,onClick:()=>W("keywords"),children:[e.jsx("span",{children:J("gamesListToolbar.filter.keywords")}),l==="keywords"&&e.jsx("svg",{className:"filter-popup-check",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z",fill:"#E5A00D"})})]}),e.jsxs("button",{className:`filter-popup-item ${l==="platforms"?"selected":""}`,onClick:()=>W("platforms"),children:[e.jsx("span",{children:J("gamesListToolbar.filter.platforms")}),l==="platforms"&&e.jsx("svg",{className:"filter-popup-check",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z",fill:"#E5A00D"})})]}),e.jsxs("button",{className:`filter-popup-item ${l==="gameModes"?"selected":""}`,onClick:()=>W("gameModes"),children:[e.jsx("span",{children:J("gamesListToolbar.filter.gameModes")}),l==="gameModes"&&e.jsx("svg",{className:"filter-popup-check",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z",fill:"#E5A00D"})})]}),e.jsxs("button",{className:`filter-popup-item ${l==="publishers"?"selected":""}`,onClick:()=>W("publishers"),children:[e.jsx("span",{children:J("gamesListToolbar.filter.publishers")}),l==="publishers"&&e.jsx("svg",{className:"filter-popup-check",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z",fill:"#E5A00D"})})]}),e.jsxs("button",{className:`filter-popup-item ${l==="developers"?"selected":""}`,onClick:()=>W("developers"),children:[e.jsx("span",{children:J("gamesListToolbar.filter.developers")}),l==="developers"&&e.jsx("svg",{className:"filter-popup-check",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z",fill:"#E5A00D"})})]}),e.jsxs("button",{className:`filter-popup-item ${l==="playerPerspectives"?"selected":""}`,onClick:()=>W("playerPerspectives"),children:[e.jsx("span",{children:J("gamesListToolbar.filter.playerPerspectives")}),l==="playerPerspectives"&&e.jsx("svg",{className:"filter-popup-check",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z",fill:"#E5A00D"})})]}),e.jsxs("button",{className:`filter-popup-item ${l==="gameEngines"?"selected":""}`,onClick:()=>W("gameEngines"),children:[e.jsx("span",{children:J("gamesListToolbar.filter.gameEngines")}),l==="gameEngines"&&e.jsx("svg",{className:"filter-popup-check",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z",fill:"#E5A00D"})})]}),e.jsxs("button",{className:`filter-popup-item ${l==="year"?"selected":""}`,onClick:()=>W("year"),children:[e.jsx("span",{children:J("gamesListToolbar.filter.year")}),l==="year"&&e.jsx("svg",{className:"filter-popup-check",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z",fill:"#E5A00D"})})]}),e.jsxs("button",{className:`filter-popup-item ${l==="decade"?"selected":""}`,onClick:()=>W("decade"),children:[e.jsx("span",{children:J("gamesListToolbar.filter.decade")}),l==="decade"&&e.jsx("svg",{className:"filter-popup-check",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z",fill:"#E5A00D"})})]}),e.jsxs("button",{className:`filter-popup-item ${l==="ageRating"?"selected":""}`,onClick:()=>W("ageRating"),children:[e.jsx("span",{children:J("gamesListToolbar.filter.ageRating")}),l==="ageRating"&&e.jsx("svg",{className:"filter-popup-check",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z",fill:"#E5A00D"})})]}),e.jsxs("button",{className:`filter-popup-item ${l==="collection"?"selected":""}`,onClick:()=>W("collection"),children:[e.jsx("span",{children:J("gamesListToolbar.filter.collection")}),l==="collection"&&e.jsx("svg",{className:"filter-popup-check",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z",fill:"#E5A00D"})})]}),e.jsxs("button",{className:`filter-popup-item ${l==="series"?"selected":""}`,onClick:()=>W("series"),children:[e.jsx("span",{children:J("gamesListToolbar.filter.series")}),l==="series"&&e.jsx("svg",{className:"filter-popup-check",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z",fill:"#E5A00D"})})]}),e.jsxs("button",{className:`filter-popup-item ${l==="franchise"?"selected":""}`,onClick:()=>W("franchise"),children:[e.jsx("span",{children:J("gamesListToolbar.filter.franchise")}),l==="franchise"&&e.jsx("svg",{className:"filter-popup-check",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z",fill:"#E5A00D"})})]})]})}function bs({isOpen:s,onClose:t,currentSort:l,sortAscending:c,onSortChange:i,onSortDirectionChange:a}){const{t:d}=ce(),m=r.useRef(null);r.useEffect(()=>{if(!s)return;function f(y){m.current&&!m.current.contains(y.target)&&t()}return document.addEventListener("mousedown",f),()=>{document.removeEventListener("mousedown",f)}},[s,t]),r.useEffect(()=>{if(!s)return;function f(y){y.key==="Escape"&&t()}return document.addEventListener("keydown",f),()=>{document.removeEventListener("keydown",f)}},[s,t]);const b=[{value:"title",label:d("gamesListToolbar.sort.title")},{value:"year",label:d("gamesListToolbar.sort.year")},{value:"releaseDate",label:d("gamesListToolbar.sort.releaseDate")},{value:"criticRating",label:d("gamesListToolbar.sort.criticRating")},{value:"userRating",label:d("gamesListToolbar.sort.userRating")},{value:"stars",label:d("gamesListToolbar.sort.stars")},{value:"ageRating",label:d("gamesListToolbar.sort.ageRating")}],x=f=>{f===l&&a?a(!c):(i?.(f),a&&a(!0)),t()};return s?e.jsx("div",{className:"sort-popup",ref:m,children:b.map(f=>e.jsxs("button",{className:`sort-popup-item ${l===f.value?"selected":""}`,onClick:()=>x(f.value),children:[e.jsx("span",{children:f.label}),l===f.value&&e.jsx("svg",{className:`sort-popup-sort-direction ${c?"ascending":"descending"}`,width:"10",height:"10",viewBox:"0 0 12 12",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:c?"M6 2L10 8H2L6 2Z":"M6 10L2 4H10L6 10Z",fill:"currentColor"})})]},f.value))}):null}function Ie(s,t){const l=new Map;return s.forEach(c=>{(c[t]??[]).forEach(a=>{typeof a=="number"&&!Number.isNaN(a)?l.set(String(a),String(a)):typeof a=="object"&&a!=null&&"id"in a&&"title"in a?l.set(String(a.id),a.title):typeof a=="string"&&a.trim()&&l.set(a.trim(),a.trim())})}),l}function Ye(s,t){const l=new Map;return s.forEach(c=>{const i=c[t];!i||!Array.isArray(i)||i.forEach(a=>{typeof a=="number"&&!Number.isNaN(a)?l.set(String(a),String(a)):typeof a=="object"&&a!=null&&"id"in a&&l.set(String(a.id),a.name??String(a.id))})}),l}function xs({gamesCount:s,games:t=[],onFilterChange:l,onYearFilterChange:c,onGenreFilterChange:i,onThemesFilterChange:a,onKeywordsFilterChange:d,onPlatformsFilterChange:m,onGameModesFilterChange:b,onPublishersFilterChange:x,onDevelopersFilterChange:f,onPlayerPerspectivesFilterChange:y,onGameEnginesFilterChange:T,onDecadeFilterChange:g,onCollectionFilterChange:R,onSeriesFilterChange:j,onFranchiseFilterChange:k,onAgeRatingFilterChange:w,onSortChange:v,onSortDirectionChange:P,currentFilter:u="all",selectedYear:L=null,selectedGenre:E=null,selectedThemes:D=null,selectedKeywords:M=null,selectedPlatforms:Z=null,selectedGameModes:h=null,selectedPublishers:I=null,selectedDevelopers:z=null,selectedPlayerPerspectives:U=null,selectedGameEngines:H=null,selectedDecade:C=null,selectedCollection:ee=null,selectedSeries:se=null,selectedFranchise:V=null,selectedAgeRating:pe=null,currentSort:ae="title",sortAscending:Se=!0,viewMode:ie="grid",availableGenres:ve=[],availableCollections:oe=[],availableSeries:J=[],availableFranchises:O=[],availableDevelopers:S=[],availablePublishers:te=[]}){const{t:n}=ce(),{tagLabels:K}=Fe(),[be,W]=r.useState(!1),[le,X]=r.useState(!1),ue=r.useRef(null),xe=r.useRef(null),me=r.useMemo(()=>new Map,[]),de=r.useMemo(()=>{const _=()=>me,Q=["themes","platforms","gameModes","playerPerspectives","gameEngines"].some(he=>u===he),F=(he,q)=>{const Y=new Map;return he.forEach((o,$)=>{Y.set($,q.get($)??o)}),Y};return Q?{themes:u==="themes"?F(Ie(t,"themes"),K.themes):_(),platforms:u==="platforms"?F(Ie(t,"platforms"),K.platforms):_(),gameModes:u==="gameModes"?F(Ie(t,"gameModes"),K.gameModes):_(),playerPerspectives:u==="playerPerspectives"?F(Ie(t,"playerPerspectives"),K.playerPerspectives):_(),gameEngines:u==="gameEngines"?F(Ie(t,"gameEngines"),K.gameEngines):_()}:{themes:_(),platforms:_(),gameModes:_(),playerPerspectives:_(),gameEngines:_()}},[t,u,me,K]),ye=r.useMemo(()=>{const _=()=>me;return u==="publishers"||u==="developers"?{publishers:u==="publishers"?Ye(t,"publishers"):_(),developers:u==="developers"?Ye(t,"developers"):_()}:{publishers:_(),developers:_()}},[t,u,me]),Re=(()=>{if(u==="year"&&L!==null)return L.toString();if(u==="decade"&&C!==null)return`${C}s`;if(u==="collection"&&ee!==null){const B=oe?.find(Q=>String(Q.id)===String(ee));return B?B.title:String(ee)}if(u==="series"&&se!==null){const B=J?.find(Q=>String(Q.id)===String(se));return B?B.title:String(se)}if(u==="franchise"&&V!==null){const B=O?.find(Q=>String(Q.id)===String(V));return B?B.title:String(V)}if(u==="genre"&&E!==null){const B=ve.find(Q=>String(Q.id)===String(E));return B?n(`genre.${B.title}`,B.title):String(E)}if(u==="themes"&&D!==null){const B=de.themes.get(String(D))??String(D);return n(`themes.${B}`,B)}if(u==="keywords"&&M!==null)return M;if(u==="platforms"&&Z!==null)return de.platforms.get(String(Z))??String(Z);if(u==="gameModes"&&h!==null){const B=de.gameModes.get(String(h))??String(h);return n(`gameModes.${B}`,B)}if(u==="publishers"&&I!==null){const B=te?.find(F=>String(F.id)===String(I));if(B?.title)return B.title;const Q=ye.publishers.get(String(I));return Q&&Q!==String(I)?Q:String(I)}if(u==="developers"&&z!==null){const B=S?.find(F=>String(F.id)===String(z));if(B?.title)return B.title;const Q=ye.developers.get(String(z));return Q&&Q!==String(z)?Q:String(z)}if(u==="playerPerspectives"&&U!==null){const B=de.playerPerspectives.get(String(U))??String(U);return n(`playerPerspectives.${B}`,B)}if(u==="gameEngines"&&H!==null)return de.gameEngines.get(String(H))??String(H);if(u==="ageRating"&&pe!==null){const[B,Q]=pe.split("-").map(Number);return Oe(B,Q,n)||pe}return[{value:"all",label:n("gamesListToolbar.filter.all")},{value:"genre",label:n("gamesListToolbar.filter.genre")},{value:"themes",label:n("gamesListToolbar.filter.themes")},{value:"keywords",label:n("gamesListToolbar.filter.keywords")},{value:"platforms",label:n("gamesListToolbar.filter.platforms")},{value:"gameModes",label:n("gamesListToolbar.filter.gameModes")},{value:"publishers",label:n("gamesListToolbar.filter.publishers")},{value:"developers",label:n("gamesListToolbar.filter.developers")},{value:"playerPerspectives",label:n("gamesListToolbar.filter.playerPerspectives")},{value:"gameEngines",label:n("gamesListToolbar.filter.gameEngines")},{value:"year",label:n("gamesListToolbar.filter.year")},{value:"decade",label:n("gamesListToolbar.filter.decade")},{value:"collection",label:n("gamesListToolbar.filter.collection")},{value:"series",label:n("gamesListToolbar.filter.series")},{value:"franchise",label:n("gamesListToolbar.filter.franchise")},{value:"ageRating",label:n("gamesListToolbar.filter.ageRating")}].find(B=>B.value===u)?.label||""})(),Ne=[{value:"title",label:n("gamesListToolbar.sort.title")},{value:"year",label:n("gamesListToolbar.sort.year")},{value:"releaseDate",label:n("gamesListToolbar.sort.releaseDate")},{value:"criticRating",label:n("gamesListToolbar.sort.criticRating")},{value:"userRating",label:n("gamesListToolbar.sort.userRating")},{value:"stars",label:n("gamesListToolbar.sort.stars")},{value:"ageRating",label:n("gamesListToolbar.sort.ageRating")}].find(_=>_.value===ae)?.label||"";return e.jsx("div",{className:"games-list-toolbar",children:e.jsxs("div",{className:"games-list-toolbar-left",children:[e.jsxs("div",{className:"games-list-toolbar-item",ref:ue,children:[e.jsxs("button",{className:"games-list-toolbar-button",onClick:()=>{W(!be),X(!1)},children:[u&&u!=="all"&&e.jsx("span",{className:"games-list-toolbar-clear-button",onClick:_=>{_.stopPropagation(),l?.("all"),c&&c(null),i&&i(null),a&&a(null),d&&d(null),m&&m(null),b&&b(null),x&&x(null),f&&f(null),y&&y(null),T&&T(null),g&&g(null),R&&R(null),w&&w(null),W(!1)},role:"button",tabIndex:0,onKeyDown:_=>{(_.key==="Enter"||_.key===" ")&&(_.preventDefault(),_.stopPropagation(),l?.("all"),c&&c(null),i&&i(null),a&&a(null),d&&d(null),m&&m(null),b&&b(null),x&&x(null),f&&f(null),y&&y(null),T&&T(null),g&&g(null),R&&R(null),w&&w(null),W(!1))},children:e.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M18 6L6 18M6 6l12 12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),e.jsx("span",{className:"games-list-toolbar-value",children:Re}),e.jsx("svg",{className:`games-list-toolbar-arrow ${be?"open":""}`,width:"12",height:"12",viewBox:"0 0 12 12",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M6 9L1 4h10L6 9z",fill:"currentColor"})})]}),e.jsx(vs,{isOpen:be,onClose:()=>W(!1),currentFilter:u,selectedYear:L,selectedGenre:E,selectedThemes:D,selectedKeywords:M,selectedPlatforms:Z,selectedGameModes:h,selectedPublishers:I,selectedDevelopers:z,selectedPlayerPerspectives:U,selectedGameEngines:H,selectedDecade:C,selectedCollection:ee,selectedSeries:se,selectedFranchise:V,selectedAgeRating:pe,onFilterChange:l,onYearFilterChange:c,onGenreFilterChange:i,onThemesFilterChange:a,onKeywordsFilterChange:d,onPlatformsFilterChange:m,onGameModesFilterChange:b,onPublishersFilterChange:x,onDevelopersFilterChange:f,onPlayerPerspectivesFilterChange:y,onGameEnginesFilterChange:T,onDecadeFilterChange:g,onCollectionFilterChange:R,onSeriesFilterChange:j,onFranchiseFilterChange:k,onAgeRatingFilterChange:w,games:t,availableGenres:ve,availableCollections:oe,availableSeries:J,availableFranchises:O,availableDevelopers:S,availablePublishers:te})]}),ie!=="table"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"games-list-toolbar-item",ref:xe,children:[e.jsxs("button",{className:"games-list-toolbar-button",onClick:()=>{X(!le),W(!1)},children:[e.jsxs("span",{className:"games-list-toolbar-value",children:[n("gamesListToolbar.sort.prefix")," ",Ne]}),e.jsx("svg",{className:`games-list-toolbar-arrow ${le?"open":""}`,width:"12",height:"12",viewBox:"0 0 12 12",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M6 9L1 4h10L6 9z",fill:"currentColor"})})]}),e.jsx(bs,{isOpen:le,onClose:()=>X(!1),currentSort:ae,sortAscending:Se,onSortChange:v,onSortDirectionChange:P})]}),e.jsx("span",{className:"games-list-toolbar-count",children:s})]}),ie==="table"&&e.jsx("span",{className:"games-list-toolbar-count",children:s})]})})}function ys({hook:s,viewMode:t,coverSize:l,isLoading:c,isReady:i,allCollections:a=[],onGameClick:d,onGamesLoaded:m,onPlay:b,buildCoverUrlFn:x}){const{t:f}=ce(),{games:y,filterField:T,setFilterField:g,selectedYear:R,setSelectedYear:j,selectedDecade:k,setSelectedDecade:w,selectedCollection:v,setSelectedCollection:P,selectedSeries:u,setSelectedSeries:L,selectedFranchise:E,setSelectedFranchise:D,selectedAgeRating:M,setSelectedAgeRating:Z,selectedGenre:h,setSelectedGenre:I,selectedThemes:z,setSelectedThemes:U,selectedKeywords:H,setSelectedKeywords:C,selectedPlatforms:ee,setSelectedPlatforms:se,selectedGameModes:V,setSelectedGameModes:pe,selectedPublishers:ae,setSelectedPublishers:Se,selectedDevelopers:ie,setSelectedDevelopers:ve,selectedPlayerPerspectives:oe,setSelectedPlayerPerspectives:J,selectedGameEngines:O,setSelectedGameEngines:S,sortField:te,setSortField:n,sortAscending:K,setSortAscending:be,columnVisibility:W,toggleColumn:le,handleTableSort:X,filteredAndSortedGames:ue,scrollContainerRef:xe,tableScrollRef:me,itemRefs:de,handleGameUpdate:ye,handleGameDelete:we,availableGenres:Re,availableCollections:ke,availableSeries:Ne,availableFranchises:_,availableDevelopers:B,availablePublishers:Q}=s,F=r.useCallback(q=>{q==="all"&&(j(null),w(null),P(null),L(null),D(null),I(null),U(null),C(null),se(null),pe(null),Se(null),ve(null),J(null),S(null),Z(null)),g(q)},[g,j,w,P,L,D,I,U,C,se,pe,Se,ve,J,S,Z]);r.useEffect(()=>{y.length>0&&m(y)},[y.length]);const he=x||it;return e.jsxs("div",{className:`home-page-content-wrapper ${!c&&y.length>0?"has-toolbar":""}`,style:{opacity:i?1:0,transition:"opacity 0.2s ease-in-out"},children:[!c&&y.length>0&&e.jsx(xs,{gamesCount:ue.length,games:y,onFilterChange:F,onYearFilterChange:j,onGenreFilterChange:I,onThemesFilterChange:U,onKeywordsFilterChange:C,onPlatformsFilterChange:se,onGameModesFilterChange:pe,onPublishersFilterChange:Se,onDevelopersFilterChange:ve,onPlayerPerspectivesFilterChange:J,onGameEnginesFilterChange:S,onDecadeFilterChange:w,onSortChange:n,onSortDirectionChange:be,currentFilter:T,selectedYear:R,selectedGenre:h,selectedDecade:k,selectedCollection:v,onCollectionFilterChange:P,selectedSeries:u,selectedFranchise:E,onSeriesFilterChange:L,onFranchiseFilterChange:D,selectedAgeRating:M,onAgeRatingFilterChange:Z,selectedThemes:z,selectedKeywords:H,selectedPlatforms:ee,selectedGameModes:V,selectedPublishers:ae,selectedDevelopers:ie,selectedPlayerPerspectives:oe,selectedGameEngines:O,currentSort:te,sortAscending:K,viewMode:t,availableGenres:Re,availableCollections:ke,availableSeries:Ne,availableFranchises:_,availableDevelopers:B,availablePublishers:Q}),t==="table"&&!c&&y.length>0&&e.jsx(Ct,{columnVisibility:W,onToggleColumn:le,sortField:te,sortAscending:K,onSort:X}),e.jsxs("div",{ref:xe,className:`home-page-scroll-container ${t==="table"?"table-view":""} ${!i||ue.length===0?"centered-content min-h-[400px]":""}`,children:[!i&&e.jsx("div",{className:"text-gray-400 text-center",style:{padding:"2rem"},children:f("common.loading","Loading...")}),i&&!c&&e.jsx(e.Fragment,{children:ue.length===0?e.jsx("div",{className:"text-gray-400 text-center",children:f("table.noGames")}):e.jsxs(e.Fragment,{children:[t==="grid"&&e.jsx(Gt,{games:ue,onGameClick:d,onPlay:b,onGameUpdate:ye,onGameDelete:we,buildCoverUrl:he,coverSize:l,itemRefs:de,viewMode:t,allCollections:a,scrollContainerRef:xe}),t==="detail"&&e.jsx(Ut,{games:ue,onGameClick:d,onPlay:b,onGameUpdate:ye,onGameDelete:we,buildCoverUrl:he,itemRefs:de,allCollections:a,scrollContainerRef:xe}),t==="table"&&e.jsx(Yt,{games:ue,onGameClick:d,onPlay:b,onGameUpdate:ye,onGameDelete:we,itemRefs:de,scrollContainerRef:me,allCollections:a,columnVisibility:W})]})})]})]})}function Ns({onGameClick:s,onGamesLoaded:t,onPlay:l,coverSize:c,viewMode:i,allCollections:a=[]}){const{isLoading:d,setLoading:m}=Pt(),{isLoading:b}=et(),x=Bt({localStoragePrefix:"library",defaultFilterField:"all",waitForAuth:!0,listenToMetadataReload:!0,scrollRestorationMode:i==="table"?void 0:i});r.useEffect(()=>{m(b||!x.isReady)},[b,x.isReady,m]);const f=r.useCallback(T=>{t(T)},[t]),y=x.sortField==="title"&&x.isReady;return e.jsx("main",{className:"flex-1 home-page-content",children:e.jsxs("div",{className:`home-page-layout${y?" has-alphabet-nav":""}`,children:[e.jsx(ys,{hook:x,viewMode:i,coverSize:c,isLoading:d,isReady:x.isReady,allCollections:a,onGameClick:s,onGamesLoaded:f,onPlay:l,buildCoverUrlFn:it}),y&&e.jsx(Dt,{games:x.filteredAndSortedGames,scrollContainerRef:i==="table"?x.tableScrollRef:x.scrollContainerRef,itemRefs:x.itemRefs,ascending:x.sortAscending,virtualizedGridRef:i==="grid"&&x.scrollContainerRef.current?x.scrollContainerRef.current.__virtualizedGridRef:void 0,virtualizedListRef:(i==="detail"&&x.scrollContainerRef.current?x.scrollContainerRef.current.__virtualizedListRef:void 0)||(i==="table"&&x.tableScrollRef.current?x.tableScrollRef.current.__virtualizedListRef:void 0),viewMode:i,coverSize:c})]})})}export{ys as G,Ns as L,Bt as u};
