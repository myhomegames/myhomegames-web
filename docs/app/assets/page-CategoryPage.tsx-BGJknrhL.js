import{r as a,j as e,b as Je,d as Ze}from"./react-vendor-mZEhzm5d.js";import{u as Ne,b as X,C as we,D as Me,a as Ce,A as ze,c as We,T as Ae,d as Ie}from"./page-CategoriesPage.tsx-Pj1wP9IV.js";import{A as U,g as ee,a as le,f as Ue}from"./page-AddGamePage.tsx-BrD1K-KO.js";import{u as H}from"./i18n-vendor-BQWJFj1H.js";function qe({selectedTags:s,onTagsChange:n,disabled:t=!1,placeholder:u}){const{t:l}=H(),{setLoading:r}=Ne(),[f,c]=a.useState([]),[d,g]=a.useState(""),[i,x]=a.useState(!1);a.useEffect(()=>{m()},[]);async function m(){try{const p=X(U,"/categories"),o=await fetch(p,{headers:{Accept:"application/json","X-Auth-Token":ee()}});if(!o.ok)throw new Error(`HTTP ${o.status}`);const h=(await o.json()).categories||[];c(h)}catch(p){console.error("Error fetching categories:",p)}}async function j(p){try{r(!0),x(!0);const o=X(U,"/categories"),E=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-Auth-Token":ee()},body:JSON.stringify({title:p})});if(!E.ok){const L=await E.json();throw new Error(L.error||`HTTP ${E.status}`)}const k=(await E.json()).category;return c(L=>{const A=[...L,k];return A.sort((T,P)=>T.localeCompare(P)),A}),k}catch(o){return console.error("Error creating category:",o),null}finally{r(!1),x(!1)}}const S=p=>{n(s.filter(o=>o!==p))},D=p=>{s.includes(p)||(n([...s,p]),g(""))},N=async p=>{if(p.key==="Enter"&&d.trim()&&!i){p.preventDefault();const o=d.trim().toLowerCase(),E=f.find(k=>{const L=l(`genre.${k}`,k).toLowerCase();return k.toLowerCase()===o||L===o||L.includes(o)});if(E&&!s.includes(E)){D(E);return}const h=await j(d.trim());h&&!s.includes(h)&&D(h)}},M=f.filter(p=>{if(s.includes(p))return!1;const o=d.toLowerCase(),E=l(`genre.${p}`,p).toLowerCase();return p.toLowerCase().includes(o)||E.includes(o)});return e.jsxs("div",{className:"tag-editor-container",children:[e.jsxs("div",{className:"tag-editor-tags",children:[s.map(p=>{const o=f.find(h=>h===p),E=o?l(`genre.${o}`,o):p;return e.jsxs("span",{className:"tag-editor-tag",children:[E,e.jsx("button",{type:"button",className:"tag-editor-tag-remove",onClick:()=>S(p),disabled:t,children:"×"})]},p)}),e.jsx("input",{id:"tag-editor-input",name:"tag",type:"text",value:d,onChange:p=>g(p.target.value),onKeyDown:N,disabled:t,placeholder:u||l("gameDetail.addGenre","Add genre..."),className:"tag-editor-input"})]}),d&&M.length>0&&e.jsx("div",{className:"tag-editor-suggestions",children:M.slice(0,5).map(p=>e.jsx("button",{type:"button",className:"tag-editor-suggestion",onClick:()=>D(p),disabled:t,children:l(`genre.${p}`,p)},p))})]})}function Be({isOpen:s,onClose:n,game:t,onGameUpdate:u}){const{t:l}=H(),{setLoading:r}=Ne(),[f,c]=a.useState(t.title),[d,g]=a.useState(t.summary||""),[i,x]=a.useState(t.year?.toString()||""),[m,j]=a.useState(t.month?.toString()||""),[S,D]=a.useState(t.day?.toString()||""),[N,M]=a.useState(Array.isArray(t.genre)?t.genre:t.genre?[t.genre]:[]),[p,o]=a.useState(!1),[E,h]=a.useState(null),[k,L]=a.useState("INFO"),[A,T]=a.useState(!1),[P,Y]=a.useState(!1),O=a.useRef(null),V=a.useRef(null),[Z,W]=a.useState(null),[C,I]=a.useState(null),[z,te]=a.useState(null),[_,re]=a.useState(null),[q,ne]=a.useState(!1),[J,se]=a.useState(!1),[de,ie]=a.useState(Date.now()),xe=a.useMemo(()=>{if(!t?.cover)return"";const R=t.cover.split("?")[0].split("&")[0];if(R.startsWith("http"))return"";const v=X(U,R),y=v.includes("?")?"&":"?";return`${v}${y}t=${de}`},[t?.cover,de]),Se=a.useMemo(()=>{if(!t?.background)return"";const R=t.background.split("?")[0].split("&")[0];if(R.startsWith("http"))return"";const v=X(U,R),y=v.includes("?")?"&":"?";return`${v}${y}t=${de}`},[t?.background,de]);a.useEffect(()=>{s&&(c(t.title),g(t.summary||""),x(t.year?.toString()||""),j(t.month?.toString()||""),D(t.day?.toString()||""),M(Array.isArray(t.genre)?t.genre:t.genre?[t.genre]:[]),h(null),L("INFO"),W(null),I(null),te(null),re(null),ne(!1),se(!1),ie(Date.now()))},[s,t]),a.useEffect(()=>{t&&(!t.cover&&!q&&!z&&(ne(!0),W(null),ie(Date.now())),!t.background&&!J&&!_&&(se(!0),I(null),ie(Date.now())))},[t?.cover,t?.background]),a.useEffect(()=>{if(!s)return;function R(v){v.key==="Escape"&&(v.stopPropagation(),n())}return document.addEventListener("keydown",R,!0),document.body.style.overflow="hidden",()=>{document.removeEventListener("keydown",R,!0),document.body.style.overflow=""}},[s,n]);const Re=()=>{if(f!==t.title||d!==(t.summary||"")||i!==(t.year?.toString()||"")||m!==(t.month?.toString()||"")||S!==(t.day?.toString()||""))return!0;const R=Array.isArray(t.genre)?t.genre:t.genre?[t.genre]:[];return!!(JSON.stringify(N.sort())!==JSON.stringify(R.sort())||z||_||q||J)},Ee=async()=>{o(!0),h(null),r(!0);try{let R=null,v=null;if(q)try{const w=X(U,`/games/${t.id}/delete-cover`),B=await fetch(w,{method:"DELETE",headers:{"X-Auth-Token":ee()||""}});if(!B.ok){const G=await B.json().catch(()=>({error:"Failed to remove cover"}));throw new Error(G.error||"Failed to remove cover")}const b=await B.json();b.game&&(R=b.game.cover||null)}catch(w){h(String(w.message||w)),o(!1),r(!1);return}if(J)try{const w=X(U,`/games/${t.id}/delete-background`),B=await fetch(w,{method:"DELETE",headers:{"X-Auth-Token":ee()||""}});if(!B.ok){const G=await B.json().catch(()=>({error:"Failed to remove background"}));throw new Error(G.error||"Failed to remove background")}const b=await B.json();b.game&&(v=b.game.background||null)}catch(w){h(String(w.message||w)),o(!1),r(!1);return}if(z){T(!0);try{const w=new FormData;w.append("file",z);const B=X(U,`/games/${t.id}/upload-cover`),b=await fetch(B,{method:"POST",headers:{"X-Auth-Token":ee()||""},body:w});if(!b.ok){const K=await b.json().catch(()=>({error:"Failed to upload cover"}));throw new Error(K.error||"Failed to upload cover")}const G=await b.json();G.game&&(R=G.game.cover||null,G.game.background&&(v=G.game.background))}catch(w){T(!1),r(!1),o(!1),h(String(w.message||w));return}finally{T(!1)}}if(_){Y(!0);try{const w=new FormData;w.append("file",_);const B=X(U,`/games/${t.id}/upload-background`),b=await fetch(B,{method:"POST",headers:{"X-Auth-Token":ee()||""},body:w});if(!b.ok){const K=await b.json().catch(()=>({error:"Failed to upload background"}));throw new Error(K.error||"Failed to upload background")}const G=await b.json();G.game&&(v=G.game.background||null,G.game.cover&&!R&&(R=G.game.cover))}catch(w){Y(!1),r(!1),o(!1),h(String(w.message||w));return}finally{Y(!1)}}const y={};f!==t.title&&(y.title=f),d!==(t.summary||"")&&(y.summary=d),i!==(t.year?.toString()||"")&&(y.year=i?parseInt(i,10):null),m!==(t.month?.toString()||"")&&(y.month=m?parseInt(m,10):null),S!==(t.day?.toString()||"")&&(y.day=S?parseInt(S,10):null);const $=Array.isArray(t.genre)?t.genre:t.genre?[t.genre]:[];if(JSON.stringify(N.sort())!==JSON.stringify($.sort())&&(y.genre=N.length===1?N[0]:N),Object.keys(y).length>0){const w=X(U,`/games/${t.id}`),B=await fetch(w,{method:"PUT",headers:{"Content-Type":"application/json","X-Auth-Token":le},body:JSON.stringify(y)});if(!B.ok){const F=await B.json();throw new Error(F.error||"Failed to update game")}const b=await B.json();let G=R!==null?R:b.game.cover,K=v!==null?v:b.game.background;if(R&&G){const F=G.includes("?")?"&":"?";G=`${G}${F}t=${Date.now()}`}if(v&&K){const F=K.includes("?")?"&":"?";K=`${K}${F}t=${Date.now()}`}const Q={id:b.game.id,title:b.game.title,summary:b.game.summary,cover:G,background:K,day:b.game.day,month:b.game.month,year:b.game.year,stars:b.game.stars,genre:b.game.genre,criticratings:b.game.criticratings||null,userratings:b.game.userratings||null,command:b.game.command||null,themes:b.game.themes??t.themes??null,platforms:b.game.platforms??t.platforms??null,gameModes:b.game.gameModes??t.gameModes??null,playerPerspectives:b.game.playerPerspectives??t.playerPerspectives??null,websites:b.game.websites??t.websites??null,ageRatings:b.game.ageRatings??t.ageRatings??null,developers:b.game.developers??t.developers??null,publishers:b.game.publishers??t.publishers??null,franchise:b.game.franchise??t.franchise??null,collection:b.game.collection??t.collection??null,screenshots:b.game.screenshots??t.screenshots??null,videos:b.game.videos??t.videos??null,gameEngines:b.game.gameEngines??t.gameEngines??null,keywords:b.game.keywords??t.keywords??null,alternativeNames:b.game.alternativeNames??t.alternativeNames??null,similarGames:b.game.similarGames??t.similarGames??null};if(y.genre!==void 0){const F=Array.isArray(t.genre)?t.genre:t.genre?[t.genre]:[],me=Array.isArray(Q.genre)?Q.genre:Q.genre?[Q.genre]:[],ye=F.filter(ae=>!me.includes(ae));for(const ae of ye)try{const be=X(U,`/categories/${encodeURIComponent(ae)}`),ue=await fetch(be,{method:"DELETE",headers:{Accept:"application/json","X-Auth-Token":le}});ue.ok?console.log(`Category ${ae} was deleted as it's no longer in use`):ue.status===409&&console.log(`Category ${ae} is still in use by other games`)}catch(be){console.warn(`Error deleting category ${ae}:`,be)}}u(Q)}else if(z||_||q||J){let w=R??t.cover,B=v??t.background;if(z&&(!w||w==="")||_&&(!B||B==="")||q&&w===void 0||J&&B===void 0){const G=X(U,`/games/${t.id}`),K=await fetch(G,{method:"GET",headers:{Accept:"application/json","X-Auth-Token":le}});if(K.ok){const Q=await K.json();(z||q)&&w===void 0&&(w=Q.game.cover||null),(_||J)&&B===void 0&&(B=Q.game.background||null)}}if((z||q)&&w){const G=w.includes("?")?"&":"?";w=`${w}${G}t=${Date.now()}`}if((_||J)&&B){const G=B.includes("?")?"&":"?";B=`${B}${G}t=${Date.now()}`}const b={...t,cover:w,background:B};u(b)}W(null),I(null),te(null),re(null),ne(!1),se(!1),n()}catch(R){h(String(R.message||R))}finally{o(!1),r(!1)}},Le=R=>{const v=R.target.files?.[0];if(v){if(!v.type.startsWith("image/")){h(l("gameDetail.invalidImageType","File must be an image")),R.target.value="";return}const y=new FileReader;y.onloadend=()=>{W(y.result)},y.readAsDataURL(v),te(v),ne(!1),h(null),R.target.value=""}},Te=R=>{const v=R.target.files?.[0];if(v){if(!v.type.startsWith("image/")){h(l("gameDetail.invalidImageType","File must be an image")),R.target.value="";return}const y=new FileReader;y.onloadend=()=>{I(y.result)},y.readAsDataURL(v),re(v),se(!1),h(null),R.target.value=""}},oe=()=>{ne(!0),W(null),te(null),ie(Date.now())},fe=()=>{se(!0),I(null),re(null),ie(Date.now())};return s?Je.createPortal(e.jsx("div",{className:"edit-game-modal-overlay",onClick:n,children:e.jsxs("div",{className:"edit-game-modal-container",onClick:R=>R.stopPropagation(),children:[e.jsxs("div",{className:"edit-game-modal-header",children:[e.jsxs("h2",{children:[e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",style:{marginRight:"8px",verticalAlign:"middle"},children:[e.jsx("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),e.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]}),l("gameDetail.editGame","Edit Game")]}),e.jsx("button",{className:"edit-game-modal-close",onClick:n,"aria-label":"Close",children:"×"})]}),e.jsxs("div",{className:"edit-game-modal-content",children:[E&&e.jsx("div",{className:"edit-game-modal-error",children:E}),e.jsxs("div",{className:"edit-game-modal-tabs",children:[e.jsx("button",{className:`edit-game-modal-tab ${k==="INFO"?"active":""}`,onClick:()=>L("INFO"),disabled:p,children:l("gameDetail.info","INFO")}),e.jsx("button",{className:`edit-game-modal-tab ${k==="MEDIA"?"active":""}`,onClick:()=>L("MEDIA"),disabled:p,children:l("gameDetail.media","MEDIA")})]}),k==="INFO"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"edit-game-modal-field",children:[e.jsx("label",{htmlFor:"edit-game-title",children:l("gameDetail.title","Title")}),e.jsx("input",{id:"edit-game-title",name:"title",type:"text",value:f,onChange:R=>c(R.target.value),disabled:p})]}),e.jsxs("div",{className:"edit-game-modal-field",children:[e.jsx("label",{htmlFor:"edit-game-summary",children:l("gameDetail.summary","Summary")}),e.jsx("textarea",{id:"edit-game-summary",name:"summary",value:d,onChange:R=>g(R.target.value),disabled:p,rows:5})]}),e.jsxs("div",{className:"edit-game-modal-row",children:[e.jsxs("div",{className:"edit-game-modal-field",children:[e.jsx("label",{htmlFor:"edit-game-year",children:l("gameDetail.year","Year")}),e.jsx("input",{id:"edit-game-year",name:"year",type:"number",value:i,onChange:R=>x(R.target.value),disabled:p,placeholder:"YYYY"})]}),e.jsxs("div",{className:"edit-game-modal-field",children:[e.jsx("label",{htmlFor:"edit-game-month",children:l("gameDetail.month","Month")}),e.jsx("input",{id:"edit-game-month",name:"month",type:"number",value:m,onChange:R=>j(R.target.value),disabled:p,placeholder:"MM",min:"1",max:"12"})]}),e.jsxs("div",{className:"edit-game-modal-field",children:[e.jsx("label",{htmlFor:"edit-game-day",children:l("gameDetail.day","Day")}),e.jsx("input",{id:"edit-game-day",name:"day",type:"number",value:S,onChange:R=>D(R.target.value),disabled:p,placeholder:"DD",min:"1",max:"31"})]})]}),e.jsxs("div",{className:"edit-game-modal-field",children:[e.jsx("div",{className:"edit-game-modal-label",children:l("gameDetail.genre","Genre")}),s&&e.jsx(qe,{selectedTags:N,onTagsChange:M,disabled:p},`tag-editor-${t.id}-${s}`)]})]}),k==="MEDIA"&&e.jsxs("div",{className:"edit-game-modal-media",children:[e.jsxs("div",{className:"edit-game-modal-media-row",children:[e.jsxs("div",{className:"edit-game-modal-media-info",children:[e.jsx("div",{className:"edit-game-modal-label",children:l("gameDetail.cover","Cover")}),e.jsx("div",{className:"edit-game-modal-media-description",children:l("gameDetail.coverFormat","Recommended format: WebP, ratio 2:3 (e.g., 400x600px)")})]}),e.jsx("div",{className:"edit-game-modal-media-image-container",children:(()=>{const R=q?"":Z||xe,v=R&&R.trim()!=="";return e.jsxs(e.Fragment,{children:[e.jsx(we,{title:t.title,coverUrl:R,width:150,height:200,showTitle:!1,detail:!1,play:!1,showBorder:!0,aspectRatio:"3/4",onUpload:()=>!A&&!p&&O.current?.click(),uploading:A,showRemoveButton:!!v&&!q&&!0,removeMediaType:"cover",removeResourceId:t.id,removeResourceType:"games",onGameUpdate:u,onRemoveSuccess:oe,removeDisabled:p||A},`cover-${q?"removed":Z?"preview":xe}`),e.jsx("input",{ref:O,id:"edit-game-cover-input",name:"cover",type:"file",accept:"image/*",style:{display:"none"},onChange:Le})]})})()})]}),e.jsxs("div",{className:"edit-game-modal-media-row",children:[e.jsxs("div",{className:"edit-game-modal-media-info",children:[e.jsx("div",{className:"edit-game-modal-label",children:l("gameDetail.background","Background")}),e.jsx("div",{className:"edit-game-modal-media-description",children:l("gameDetail.backgroundFormat","Recommended format: WebP, ratio 16:9 (e.g., 1920x1080px)")})]}),e.jsx("div",{className:"edit-game-modal-media-image-container",children:(()=>{const R=J?"":C||Se,v=R&&R.trim()!=="";return e.jsxs(e.Fragment,{children:[e.jsx(we,{title:t.title,coverUrl:R,width:300,height:169,showTitle:!1,detail:!1,play:!1,showBorder:!0,aspectRatio:"16/9",onUpload:()=>!P&&!p&&V.current?.click(),uploading:P,showRemoveButton:!!v&&!J&&!0,removeMediaType:"background",removeResourceId:t.id,removeResourceType:"games",onGameUpdate:u,onRemoveSuccess:fe,removeDisabled:p||P},`background-${J?"removed":C?"preview":Se}`),e.jsx("input",{ref:V,id:"edit-game-background-input",name:"background",type:"file",accept:"image/*",style:{display:"none"},onChange:Te})]})})()})]})]})]}),e.jsxs("div",{className:"edit-game-modal-footer",children:[e.jsx("button",{className:"edit-game-modal-cancel",onClick:n,disabled:p,children:l("common.cancel","Cancel")}),e.jsx("button",{className:"edit-game-modal-save",onClick:Ee,disabled:p||!Re(),children:p?l("common.saving","Saving..."):l("common.save","Save")})]})]})}),document.body):null}function He({rating:s,starSize:n=16,gap:t=4,color:u="#ffffff",noStroke:l=!1,readOnly:r=!0,onRatingChange:f}){const[c,d]=a.useState(null),g=(j,S)=>{if(!r&&f){const N=(S?j-.5:j)*2;f(N)}},i=(j,S)=>{if(!r){const D=S?j-.5:j;d(D)}},x=()=>{r||d(null)},m=c!==null?c:s;return e.jsx("div",{style:{display:"flex",alignItems:"center",gap:`${t}px`},onMouseLeave:x,children:[1,2,3,4,5].map(j=>{const S=m>=j,D=m>=j-.5&&m<j,N=`star-${j}-${m}`;return e.jsxs("div",{style:{position:"relative",width:`${n}px`,height:`${n}px`,cursor:r?"default":"pointer"},children:[e.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"rgba(255, 255, 255, 0.3)",strokeWidth:"1.5",style:{position:"absolute",top:0,left:0},children:e.jsx("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"})}),!r&&e.jsx("div",{style:{position:"absolute",top:0,left:0,width:`${n/2}px`,height:`${n}px`,cursor:"pointer",zIndex:10},onClick:()=>g(j,!0),onMouseEnter:()=>i(j,!0)}),!r&&e.jsx("div",{style:{position:"absolute",top:0,right:0,width:`${n/2}px`,height:`${n}px`,cursor:"pointer",zIndex:10},onClick:()=>g(j,!1),onMouseEnter:()=>i(j,!1)}),S&&e.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:u,stroke:l?"none":u,strokeWidth:l?"0":"1.5",style:{position:"absolute",top:0,left:0,pointerEvents:"none"},children:e.jsx("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"})}),D&&e.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:l?"none":u,strokeWidth:l?"0":"1.5",style:{position:"absolute",top:0,left:0,pointerEvents:"none"},children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:N,x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[e.jsx("stop",{offset:"50%",stopColor:u}),e.jsx("stop",{offset:"50%",stopColor:"transparent"})]})}),e.jsx("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z",fill:`url(#${N})`})]})]},j)})})}function Qe({summary:s,truncateOnly:n=!1,maxLines:t=4,fontSize:u}){const{t:l}=H(),[r,f]=a.useState(!1),[c,d]=a.useState(!1),g=a.useRef(null);return a.useEffect(()=>{if(g.current&&!n){const x=parseFloat(getComputedStyle(g.current).lineHeight)*t;g.current.scrollHeight>x&&d(!0)}},[s,n,t]),s?e.jsxs("div",{style:{marginTop:"16px"},children:[e.jsx("div",{ref:g,className:"text-white",style:{opacity:.8,fontFamily:"var(--font-body-1-font-family)",fontSize:u||"var(--font-body-1-font-size)",lineHeight:"var(--font-body-1-line-height)",display:"-webkit-box",WebkitLineClamp:r?"none":t,WebkitBoxOrient:"vertical",overflow:r?"visible":"hidden",textOverflow:r?"clip":"ellipsis"},children:s}),c&&!n&&e.jsxs("button",{onClick:()=>f(!r),style:{backgroundColor:"transparent",border:"none",color:"#E5A00D",cursor:"pointer",padding:0,marginTop:"8px",fontFamily:"var(--font-body-1-font-family)",fontSize:"var(--font-body-1-font-size)",lineHeight:"var(--font-body-1-line-height)",display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx("span",{children:l(r?"common.less":"common.more")}),e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",style:{transform:r?"rotate(180deg)":"rotate(0deg)",transition:"transform 0.2s ease"},children:e.jsx("path",{d:"M7 10l5 5 5-5",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})]})]}):null}const Ye={en:1,it:2,es:2,fr:2,pt:2,de:4,ja:3,zh:1},Fe={1:"ESRB",2:"PEGI",3:"CERO",4:"USK",5:"GRAC",6:"CLASS_IND",7:"ACB"},et={1:{6:"EC",7:"E",8:"E10",9:"T",10:"M",11:"AO",12:"RP"},2:{1:"Three",2:"Seven",3:"Twelve",4:"Sixteen",5:"Eighteen"},3:{1:"A",2:"B",3:"C",4:"D",5:"Z"},4:{1:"Zero",2:"Six",3:"Twelve",4:"Sixteen",5:"Eighteen"},5:{1:"ALL",2:"Twelve",3:"Fifteen",4:"Eighteen"},6:{1:"L",2:"Ten",3:"Twelve",4:"Fourteen",5:"Sixteen",6:"Eighteen"},7:{1:"G",2:"PG",3:"M",4:"MA15",5:"R18"}};function Ke(s,n){const t=n.split("-")[0],u=Ye[t]||1;return s.filter(l=>l&&l.category!==void 0&&l.category!==null&&l.rating!==void 0&&l.rating!==null&&l.category===u)}function ke(s,n,t){if(s==null||n===void 0||n===null)return"";const u=Fe[s];if(!u)return`Category ${s} Rating ${n}`;const r=et[s]?.[n];if(!r)return`${u} ${n}`;const f=`igdbInfo.ageRating.${u}.${r}`,c=t(f);return c!==f?c:`${u} ${r}`}function tt({ageRatings:s}){const{t:n,i18n:t}=H();if(!s||s.length===0)return null;const u=Ke(s,t.language);return u.length===0?null:e.jsx("div",{className:"age-ratings-list",children:u.map((l,r,f)=>{const c=ke(l.category,l.rating,n);return c?e.jsxs("span",{children:[e.jsx("span",{className:"age-rating-item",children:c}),r<f.length-1&&e.jsxs("span",{className:"age-rating-separator",children:[","," "]})]},r):null})})}const Ve=a.createContext(null);function st(){const s=a.useContext(Ve);return s||{hasBackground:!1,isBackgroundVisible:!1,setBackgroundVisible:()=>{}}}const _e="backgroundStates",Xe=()=>{try{const s=localStorage.getItem(_e);return s?JSON.parse(s):{}}catch{return{}}},nt=(s,n)=>{const t=Xe();t[s]=n,localStorage.setItem(_e,JSON.stringify(t))},Ge=(s,n)=>Xe()[s]??n;function Dt({backgroundUrl:s,hasBackground:n,elementId:t,children:u}){const[l,r]=a.useState(()=>Ge(t,n));a.useEffect(()=>{if(n){const d=Ge(t,n);r(d)}else r(!1)},[n,s,t]);const f=a.useCallback(d=>{r(d),nt(t,d)},[t]),c=a.useMemo(()=>({hasBackground:n,isBackgroundVisible:l,setBackgroundVisible:f}),[n,l,f]);return e.jsxs(Ve.Provider,{value:c,children:[e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:n&&l?"transparent":"#1a1a1a",backgroundImage:n&&l?`url(${s})`:void 0,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",backgroundAttachment:"fixed",zIndex:0,cursor:n&&l?"pointer":"default"},onClick:()=>{n&&l&&f(!1)},children:n&&l&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(26, 26, 26, 0.85)",zIndex:1}}),e.jsx("img",{src:s,alt:"",style:{display:"none"}})]})}),e.jsx("div",{style:{position:"relative",zIndex:2},children:u})]})}function rt({value:s,onChange:n,min:t=100,max:u=200}){return e.jsx("div",{className:"cover-size-slider-container",children:e.jsx("input",{id:"cover-size-slider",name:"coverSize",type:"range",min:t,max:u,value:s,onChange:l=>n(Number(l.target.value)),className:"cover-size-slider"})})}function at({value:s,onChange:n,disabled:t=!1}){const{t:u,i18n:l}=H(),[r,f]=a.useState(!1),[c,d]=a.useState(!1),g=a.useRef(null),i=a.useMemo(()=>[{key:"grid",label:u("viewMode.grid"),icon:"⊞"},{key:"detail",label:u("viewMode.detail"),icon:"☰"},{key:"table",label:u("viewMode.table"),icon:"☷"}],[u,l.language]),x=i.find(m=>m.key===s)||i[0];return a.useEffect(()=>{function m(S){g.current&&!g.current.contains(S.target)&&f(!1)}function j(S){S.key==="Escape"&&f(!1)}if(r)return document.addEventListener("mousedown",m),document.addEventListener("keydown",j),()=>{document.removeEventListener("mousedown",m),document.removeEventListener("keydown",j)}},[r]),e.jsxs("div",{ref:g,className:"view-mode-selector",children:[e.jsxs("button",{onClick:()=>!t&&f(!r),type:"button",className:`view-mode-button ${t?"disabled":""}`,disabled:t,onMouseEnter:()=>{t||d(!0)},onMouseLeave:()=>{t||d(!1)},children:[e.jsx("span",{className:`view-mode-icon ${c&&!t?"hover":""}`,children:x.icon}),!t&&e.jsx("svg",{width:"12",height:"12",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:2,className:`view-mode-arrow ${r?"open":""}`,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})]}),r&&!t&&e.jsx("div",{className:"view-mode-dropdown",children:i.map(m=>e.jsxs("button",{onClick:()=>{n(m.key),f(!1)},type:"button",className:`view-mode-option ${s===m.key?"active":""}`,children:[e.jsx("span",{className:"view-mode-option-icon",children:m.icon}),e.jsx("span",{children:m.label})]},m.key))})]})}function lt({isVisible:s,onChange:n,disabled:t=!1}){const{t:u}=H();return e.jsx("button",{className:"background-toggle-button",onClick:()=>!t&&n(!s),disabled:t,"aria-label":u(s?"common.hideBackground":"common.showBackground"),title:u(s?"common.hideBackground":"common.showBackground"),children:e.jsx("span",{className:"background-toggle-icon",children:e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:s?e.jsx("path",{d:"M4 4h16v16H4V4zm2 2v12h12V6H6zm2 2h8v8H8V8z",fill:"currentColor"}):e.jsx("path",{d:"M4 4h16v16H4V4zm2 2v12h12V6H6z",fill:"currentColor",opacity:"0.5"})})})})}function it({libraries:s,activeLibrary:n,onSelectLibrary:t,loading:u,error:l,coverSize:r=150,onCoverSizeChange:f,viewMode:c="grid",onViewModeChange:d,hideBackgroundToggle:g=!1,onReloadMetadata:i}){const{t:x}=H(),{isLoading:m}=Ne(),{hasBackground:j,isBackgroundVisible:S,setBackgroundVisible:D}=st(),N=u!==void 0?u:m,[M,p]=a.useState(!1),o=a.useRef(null),E=a.useRef(null);a.useEffect(()=>{const k=()=>{if(window.innerWidth<800){p(!0);return}if(o.current&&E.current){const T=o.current.offsetWidth,P=E.current.offsetWidth,Y=T-P-180,O=s.length*110;p(Y<O)}};k();const L=setTimeout(k,100);return window.addEventListener("resize",k),()=>{clearTimeout(L),window.removeEventListener("resize",k)}},[s,c,r]);const h=k=>{const L=s.find(A=>A.key===k.target.value);L&&t(L)};return e.jsx("div",{className:"mhg-libraries-bar",children:e.jsxs("div",{className:"mhg-libraries-bar-container",ref:o,children:[ee()&&e.jsx("div",{className:"mhg-libraries-menu-container",children:e.jsx(Me,{className:"mhg-libraries-menu-dropdown",onReload:i})}),n&&e.jsx(e.Fragment,{children:M?e.jsxs("div",{className:"mhg-libraries-combobox-container",children:[N&&s.length===0?null:e.jsx("select",{id:"libraries-select",name:"library",className:"mhg-libraries-combobox",value:n?.key||"",onChange:h,children:s.map(k=>e.jsx("option",{value:k.key,children:k.title||x(`libraries.${k.key}`)},k.key))}),l&&e.jsx("div",{className:"mhg-libraries-error",children:l})]}):e.jsxs("div",{className:"mhg-libraries-container",children:[N&&s.length===0?null:s.map(k=>e.jsx("button",{className:`mhg-library-button ${n?.key===k.key?"mhg-library-active":""}`,onClick:()=>t(k),children:k.title||x(`libraries.${k.key}`)},k.key)),l&&e.jsx("div",{className:"mhg-libraries-error",children:l})]})}),e.jsxs("div",{className:"mhg-libraries-actions",ref:E,children:[j&&!g&&e.jsx("div",{className:"mhg-libraries-actions-background-toggle-container",children:e.jsx(lt,{isVisible:S,onChange:D})}),f&&e.jsx("div",{className:`mhg-libraries-actions-slider-container ${c==="grid"?"":"hidden"}`,children:e.jsx(rt,{value:r,onChange:f})}),d&&e.jsx("div",{className:"mhg-libraries-actions-view-mode-container",children:e.jsx(at,{value:c,onChange:d,disabled:n?n.key!=="library"&&n.key!=="category":!1})})]})]})})}function ot({setGames:s,enabledEvents:n=["gameUpdated","gameDeleted","gameAdded"]}){const t=a.useRef(n);t.current=n,a.useEffect(()=>{const u=[];if(t.current.includes("gameUpdated")){const l=r=>{const c=r.detail?.game;c&&s(d=>d.map(g=>String(g.id)===String(c.id)?c:g))};window.addEventListener("gameUpdated",l),u.push({event:"gameUpdated",handler:l})}if(t.current.includes("gameDeleted")){const l=r=>{const c=r.detail?.gameId;c&&s(d=>d.filter(g=>String(g.id)!==String(c)))};window.addEventListener("gameDeleted",l),u.push({event:"gameDeleted",handler:l})}if(t.current.includes("gameAdded")){const l=r=>{const c=r.detail?.game;c&&s(d=>{const g={...c,id:String(c.id)},i=d.findIndex(x=>String(x.id)===String(g.id));if(i>=0){const x=[...d];return x[i]=g,x}else return[...d,g]})};window.addEventListener("gameAdded",l),u.push({event:"gameAdded",handler:l})}return()=>{u.forEach(({event:l,handler:r})=>{window.removeEventListener(l,r)})}},[s])}function ct({game:s,onGameClick:n,onPlay:t,onEditClick:u,onGameDelete:l,onGameUpdate:r,buildCoverUrl:f,coverSize:c,itemRefs:d,draggable:g=!1,index:i,onDragStart:x,onDragOver:m,onDragEnd:j,isDragging:S,dragOverIndex:D,viewMode:N,allCollections:M=[],collectionId:p,onRemoveFromCollection:o}){const E=c*1.5,h=a.useRef(s.cover),k=h.current!==s.cover;k&&(h.current=s.cover);const L=a.useMemo(()=>s.cover?f(U,s.cover,k):"",[s.cover,k,f]),A=O=>{g&&(O.dataTransfer.effectAllowed="move",O.dataTransfer.setData("text/html",i.toString()),x(i))},T=O=>{g&&(O.preventDefault(),O.dataTransfer.dropEffect="move",m(i))},P=()=>{g&&j()},Y=D===i&&S;return e.jsx("div",{ref:O=>{O&&d?.current&&d.current.set(s.id,O)},className:`group cursor-pointer games-list-item ${g?"games-list-item-draggable":""} ${Y?"games-list-item-drag-over":""}`,style:{width:`${c}px`,minWidth:`${c}px`},draggable:g,onDragStart:A,onDragOver:T,onDragEnd:P,onDragLeave:O=>{if(!g)return;const V=O.currentTarget.getBoundingClientRect(),Z=O.clientX,W=O.clientY;(Z<V.left||Z>V.right||W<V.top||W>V.bottom)&&D===i&&m(-1)},children:e.jsx(we,{title:s.title,coverUrl:L,width:c,height:E,onPlay:t?()=>t(s):void 0,onClick:()=>n(s),onEdit:()=>u(s),gameId:s.id,gameTitle:s.title,game:s,onGameDelete:l?O=>{const V=s.id===O?s:null;V&&l(V)}:void 0,onGameUpdate:r?O=>{O.id===s.id&&r(O)}:void 0,collectionId:p,onRemoveFromCollection:o?()=>o(s.id):void 0,showTitle:!0,subtitle:s.year,detail:!0,play:!!s.command,showBorder:N!=="detail",allCollections:M},`${s.id}-${s.cover}`)},`${s.id}-${s.title}`)}function dt({games:s,onGameClick:n,onPlay:t,onGameUpdate:u,onGameDelete:l,buildCoverUrl:r,coverSize:f=150,itemRefs:c,draggable:d=!1,onDragEnd:g,style:i,viewMode:x,allCollections:m=[],collectionId:j,onRemoveFromCollection:S}){const{t:D}=H(),N=Ce(),[M,p]=a.useState(null),[o,E]=a.useState(null),h=T=>{p(T)},k=T=>{M===null||M===T||E(T)},L=()=>{M!==null&&o!==null&&M!==o&&g&&g(M,o),p(null),E(null)},A=T=>{u&&u(T),N.closeEditModal()};return s.length===0?e.jsx("div",{className:"text-gray-400 text-center",children:D("table.noGames")}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"games-list-container",style:{gridTemplateColumns:`repeat(auto-fill, ${f}px)`,...i},children:s.map((T,P)=>e.jsx(ct,{game:T,onGameClick:n,onPlay:t,onEditClick:N.openEditModal,onGameDelete:l,onGameUpdate:u,buildCoverUrl:r,coverSize:f,itemRefs:c,draggable:d,index:P,onDragStart:h,onDragOver:k,onDragEnd:L,isDragging:M!==null,dragOverIndex:o,viewMode:x,allCollections:m,collectionId:j,onRemoveFromCollection:S},`${T.id}-${T.title}`))}),N.selectedGame&&le&&e.jsx(Be,{isOpen:N.isEditModalOpen,onClose:N.closeEditModal,game:N.selectedGame,onGameUpdate:A})]})}const Pe=100;function ut({game:s,onGameClick:n,onPlay:t,onEditClick:u,onGameDelete:l,onGameUpdate:r,buildCoverUrl:f,itemRefs:c,index:d,allCollections:g=[]}){const{t:i,i18n:x}=H(),m=d%2===0,j=Pe*1.5,S=a.useRef(s.cover),D=S.current!==s.cover;D&&(S.current=s.cover);const N=a.useMemo(()=>f(U,s.cover,D),[s.cover,D,f]),M=p=>{p.stopPropagation(),u(s)};return e.jsxs("div",{ref:p=>{p&&c?.current&&c.current.set(s.id,p)},className:`group cursor-pointer mb-6 games-list-detail-item ${m?"even":"odd"}`,onClick:()=>n(s),children:[e.jsx(we,{title:s.title,coverUrl:N,width:Pe,height:j,onPlay:t?()=>t(s):void 0,showTitle:!1,detail:!1,play:!!s.command,showBorder:!1},`${s.id}-${s.cover}`),e.jsxs("div",{className:"games-list-detail-content",children:[e.jsx("div",{className:"text-white mb-2 games-list-detail-title",children:s.title}),s.year!==null&&s.year!==void 0||s.stars!==null&&s.stars!==void 0?e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",flexWrap:"wrap"},children:[s.year!==null&&s.year!==void 0&&e.jsx("div",{className:"text-gray-500",style:{fontSize:"0.85rem"},children:Ue(s,i,x)||s.year.toString()}),s.stars!==null&&s.stars!==void 0&&e.jsx(He,{rating:s.stars/10*5,starSize:14,gap:3})]}):null,s.summary&&e.jsx(Qe,{summary:s.summary,truncateOnly:!0,maxLines:2,fontSize:"0.85rem"})]}),e.jsxs("div",{className:"games-list-detail-actions",children:[e.jsx("button",{onClick:M,className:"games-list-detail-edit-button","aria-label":"Edit",children:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),e.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]})}),e.jsx(ze,{game:s,allCollections:g}),e.jsx(Me,{gameId:s.id,gameTitle:s.title,onAddToCollection:()=>{},onGameDelete:l?p=>{s.id===p&&l(s)}:void 0,onGameUpdate:r?p=>{p.id===s.id&&r(p)}:void 0,className:"games-list-detail-dropdown-menu"})]})]},`${s.id}-${s.title}`)}function gt({games:s,onGameClick:n,onPlay:t,onGameUpdate:u,onGameDelete:l,buildCoverUrl:r,itemRefs:f,allCollections:c=[]}){const{t:d}=H(),g=Ce();if(s.length===0)return e.jsx("div",{className:"text-gray-400 text-center",children:d("table.noGames")});const i=x=>{u&&u(x),g.closeEditModal()};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"games-list-detail-container",children:s.map((x,m)=>e.jsx(ut,{game:x,onGameClick:n,onPlay:t,onEditClick:g.openEditModal,onGameDelete:l,onGameUpdate:u,buildCoverUrl:r,itemRefs:f,index:m,allCollections:c},`${x.id}-${x.title}`))}),g.selectedGame&&e.jsx(Be,{isOpen:g.isEditModalOpen,onClose:g.closeEditModal,game:g.selectedGame,onGameUpdate:i})]})}function ft({games:s,onGameClick:n,onPlay:t,onGameUpdate:u,onGameDelete:l,itemRefs:r,scrollContainerRef:f,allCollections:c=[],columnVisibility:d}){const g=a.useRef(null),i=f||g;We(i,"table");const[x,m]=a.useState(s),j=Ce();a.useEffect(()=>{m(s)},[s]);const S=async(o,E)=>{if(le)try{const h=X(U,`/games/${o}`);if((await fetch(h,{method:"PUT",headers:{"Content-Type":"application/json","X-Auth-Token":le},body:JSON.stringify({stars:E})})).ok){const L=x.map(A=>A.id===o?{...A,stars:E}:A);m(L)}else console.error("Failed to update rating")}catch(h){console.error("Error updating rating:",h)}},D=o=>{const E=x.map(h=>h.id===o.id?o:h);m(E),u&&u(o),j.closeEditModal()},{t:N,i18n:M}=H();if(s.length===0)return e.jsx("div",{className:"text-gray-400 text-center",children:N("table.noGames")});const p=o=>{if(o==null||isNaN(o))return null;const E=Number(o);return E<0||E>10?null:E%1===0?E.toString():E.toFixed(1)};return e.jsxs("div",{className:"games-table-container",children:[e.jsx("div",{className:"games-table-scroll",ref:i,children:e.jsx("table",{className:"games-table",children:e.jsx("tbody",{children:x.map((o,E)=>{const k=E%2===0?"even-row":"odd-row",L=d.title?"title":d.releaseDate?"releaseDate":d.stars?"stars":d.year?"year":d.criticRating?"criticRating":d.ageRating?"ageRating":null,A=()=>{if(!o.command)return null;const T=P=>{P.stopPropagation(),t&&t(o)};return e.jsx("button",{className:"first-cell-play-button","aria-label":"Play game",onClick:T,children:e.jsx("svg",{width:"36",height:"36",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M8 5v14l11-7z",fill:"currentColor"})})})};return e.jsxs("tr",{ref:T=>{T&&r?.current&&r.current.set(o.id,T)},children:[e.jsx("td",{className:"column-menu-cell"}),d.title&&e.jsxs("td",{className:`title-cell ${k} ${L==="title"?"first-visible-cell":""}`,children:[L==="title"&&t&&e.jsx(A,{}),e.jsx(Ae,{text:o.title,delay:1e3,children:e.jsx("span",{className:L==="title"?"first-cell-text":"title-cell-text",onClick:()=>n(o),children:o.title})})]}),d.releaseDate&&e.jsxs("td",{className:`date-cell ${k} ${d.stars||d.year||d.criticRating?"has-border-right":""} ${L==="releaseDate"?"first-visible-cell":""}`,children:[L==="releaseDate"&&t&&e.jsx(A,{}),e.jsx("span",{className:L==="releaseDate"?"first-cell-text":"",children:Ue(o,N,M)||"-"})]}),d.stars&&e.jsxs("td",{className:`stars-cell ${k} ${L==="stars"?"first-visible-cell":""}`,children:[L==="stars"&&t&&e.jsx(A,{}),e.jsx("div",{className:L==="stars"?"first-cell-text":"",style:{display:"flex",alignItems:"center"},children:e.jsx(He,{rating:o.stars?o.stars/10*5:0,starSize:14,gap:3,color:"rgba(255, 255, 255, 0.4)",noStroke:!0,readOnly:!le,onRatingChange:le?T=>S(o.id,T):void 0})})]}),d.year&&e.jsxs("td",{className:`year-cell ${k} has-border-right ${L==="year"?"first-visible-cell":""}`,children:[L==="year"&&t&&e.jsx(A,{}),e.jsx("span",{className:L==="year"?"first-cell-text":"",children:o.year||"-"})]}),d.criticRating&&e.jsxs("td",{className:`critic-rating-cell ${k} has-border-right ${L==="criticRating"?"first-visible-cell":""}`,children:[L==="criticRating"&&t&&e.jsx(A,{}),e.jsx("div",{className:L==="criticRating"?"first-cell-text":"",style:{display:"flex",alignItems:"center",gap:"12px",flexWrap:"wrap"},children:(()=>{const T=p(o.criticratings),P=p(o.userratings);return T===null&&P===null?e.jsx("span",{children:"-"}):e.jsxs(e.Fragment,{children:[T!==null&&e.jsx(Ae,{text:N("gameDetail.criticRating"),children:e.jsxs("div",{className:"text-white",style:{opacity:.8,fontFamily:"var(--font-body-2-font-family)",fontSize:"var(--font-body-2-font-size)",lineHeight:"var(--font-body-2-line-height)",display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"#FFD700",stroke:"#FFA500",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",style:{flexShrink:0},children:e.jsx("path",{d:"M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z"})}),T]})}),P!==null&&e.jsx(Ae,{text:N("gameDetail.userRating"),children:e.jsxs("div",{className:"text-white",style:{opacity:.8,fontFamily:"var(--font-body-2-font-family)",fontSize:"var(--font-body-2-font-size)",lineHeight:"var(--font-body-2-line-height)",display:"flex",alignItems:"center",gap:"8px"},children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"#4CAF50",stroke:"#2E7D32",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",style:{flexShrink:0},children:[e.jsx("path",{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"9",cy:"7",r:"4"}),e.jsx("path",{d:"M23 21v-2a4 4 0 0 0-3-3.87"}),e.jsx("path",{d:"M16 3.13a4 4 0 0 1 0 7.75"})]}),P]})})]})})()})]}),d.ageRating&&e.jsxs("td",{className:`age-rating-cell ${k} has-border-right ${L==="ageRating"?"first-visible-cell":""}`,children:[L==="ageRating"&&t&&e.jsx(A,{}),e.jsx("div",{className:L==="ageRating"?"first-cell-text":"",children:o.ageRatings&&o.ageRatings.length>0?e.jsx(tt,{ageRatings:o.ageRatings}):e.jsx("span",{children:"-"})})]}),e.jsx("td",{className:`games-table-edit-cell ${k}`,children:e.jsxs("div",{className:"games-table-actions",children:[e.jsx("button",{onClick:T=>{T.stopPropagation(),j.openEditModal(o)},className:"games-table-edit-button","aria-label":"Edit",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),e.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]})}),e.jsx(ze,{game:o,allCollections:c}),e.jsx(Me,{gameId:o.id,gameTitle:o.title,onAddToCollection:()=>{},onGameDelete:l?T=>{const P=o.id===T?o:null;P&&l(P)}:void 0,onGameUpdate:u?T=>{T.id===o.id&&D(T)}:void 0,className:"games-table-dropdown-menu"})]})})]},o.id)})})})}),j.selectedGame&&e.jsx(Be,{isOpen:j.isEditModalOpen,onClose:j.closeEditModal,game:j.selectedGame,onGameUpdate:D})]})}function mt({columnVisibility:s,onToggleColumn:n,sortField:t,sortAscending:u=!0,onSort:l}){const{t:r,i18n:f}=H(),[c,d]=a.useState(!1),g=a.useRef(null);a.useEffect(()=>{function j(S){g.current&&!g.current.contains(S.target)&&d(!1)}return document.addEventListener("mousedown",j),()=>{document.removeEventListener("mousedown",j)}},[]);const i=j=>t!==j?"":u?"↑":"↓",x=a.useMemo(()=>[{key:"title",label:r("table.title")},{key:"releaseDate",label:r("table.releaseDate")},{key:"year",label:r("table.year")},{key:"stars",label:r("table.stars")},{key:"criticRating",label:r("table.criticRating")},{key:"ageRating",label:r("table.ageRating")}],[r,f.language]),m=s.title?"title":s.releaseDate?"releaseDate":s.stars?"stars":s.year?"year":s.criticRating?"criticRating":s.ageRating?"ageRating":null;return e.jsx("div",{className:"games-table-header-section",children:e.jsx("table",{className:"games-table-header-table",children:e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"games-table-header-table th column-menu",children:e.jsxs("div",{className:"games-table-column-menu-wrapper",ref:g,children:[e.jsxs("button",{onClick:()=>d(!c),className:"games-table-column-menu-button",children:[e.jsx("svg",{width:"16",height:"16",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"})}),e.jsx("svg",{width:"12",height:"12",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:1.5,className:`games-table-column-menu-arrow ${c?"open":""}`,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 8.25l-7.5 7.5-7.5-7.5"})})]}),c&&e.jsx("div",{className:"games-table-column-menu-popup",children:x.map(j=>e.jsxs("button",{className:`games-table-column-menu-item ${s[j.key]?"selected":""}`,onClick:()=>n(j.key),children:[e.jsx("span",{children:j.label}),s[j.key]&&e.jsx("svg",{className:"games-table-column-menu-check",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z",fill:"#E5A00D"})})]},j.key))})]})}),s.title&&e.jsxs("th",{onClick:()=>l("title"),className:`title-cell has-border-right ${m==="title"?"first-visible-cell":""} ${t==="title"?"sorted":""}`,children:[e.jsx("span",{children:r("table.title")}),e.jsx("span",{className:"sort-indicator",children:i("title")})]}),s.releaseDate&&e.jsxs("th",{onClick:()=>l("releaseDate"),className:`date-cell has-border-right ${m==="releaseDate"?"first-visible-cell":""} ${t==="releaseDate"?"sorted":""}`,children:[e.jsx("span",{children:r("table.releaseDate")}),e.jsx("span",{className:"sort-indicator",children:i("releaseDate")})]}),s.stars&&e.jsxs("th",{onClick:()=>l("stars"),className:`stars-cell has-border-right ${m==="stars"?"first-visible-cell":""} ${t==="stars"?"sorted":""}`,children:[e.jsx("span",{children:r("table.stars")}),e.jsx("span",{className:"sort-indicator",children:i("stars")})]}),s.year&&e.jsxs("th",{onClick:()=>l("year"),className:`year-cell has-border-right ${m==="year"?"first-visible-cell":""} ${t==="year"?"sorted":""}`,children:[e.jsx("span",{children:r("table.year")}),e.jsx("span",{className:"sort-indicator",children:i("year")})]}),s.criticRating&&e.jsxs("th",{onClick:()=>l("criticRating"),className:`critic-rating-cell has-border-right ${m==="criticRating"?"first-visible-cell":""} ${t==="criticRating"?"sorted":""}`,children:[e.jsx("span",{children:r("table.criticRating")}),e.jsx("span",{className:"sort-indicator",children:i("criticRating")})]}),s.ageRating&&e.jsxs("th",{onClick:()=>l("ageRating"),className:`age-rating-cell has-border-right ${m==="ageRating"?"first-visible-cell":""} ${t==="ageRating"?"sorted":""}`,children:[e.jsx("span",{children:r("table.ageRating")}),e.jsx("span",{className:"sort-indicator",children:i("ageRating")})]}),e.jsx("th",{className:"games-table-edit-header"})]})})})})}function ht({games:s,scrollContainerRef:n,itemRefs:t,ascending:u=!0}){const[l,r]=a.useState(!1);a.useEffect(()=>{const i=()=>{const S=n.current;if(!S){r(!1);return}requestAnimationFrame(()=>{if(!S){r(!1);return}const D=S.scrollHeight>S.clientHeight;r(D)})};i();const x=setTimeout(i,100),m=setTimeout(i,300),j=setTimeout(i,500);if(window.addEventListener("resize",i),n.current){const S=new ResizeObserver(()=>{setTimeout(i,50)});S.observe(n.current);const D=new MutationObserver(()=>{setTimeout(i,50)});return D.observe(n.current,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["style","class"]}),()=>{clearTimeout(x),clearTimeout(m),clearTimeout(j),window.removeEventListener("resize",i),S.disconnect(),D.disconnect()}}return()=>{clearTimeout(x),clearTimeout(m),clearTimeout(j),window.removeEventListener("resize",i)}},[s,n]);const f=u?["#",..."ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("")]:[..."ZYXWVUTSRQPONMLKJIHGFEDCBA".split(""),"#"],c=i=>{const x=i.trim().charAt(0).toUpperCase();if(/[A-Z]/.test(x))return x;if(/[0-9]/.test(x))return"#";{const m=i.match(/[A-Z]/i);return m?m[0].toUpperCase():"#"}},d=i=>s.some(x=>c(x.title)===i),g=i=>{const x=n.current;if(!x)return;const m=s.findIndex(M=>c(M.title)===i);if(m===-1)return;const j=s[m];if(t?.current){const M=t.current.get(j.id);if(M){const p=x.getBoundingClientRect(),o=M.getBoundingClientRect(),E=x.querySelector("thead"),h=E?E.offsetHeight:0,k=h>0?h+4:20,L=x.scrollTop+o.top-p.top-k;x.scrollTo({top:L,behavior:"smooth"});return}}const S=Math.floor(x.clientWidth/200),N=Math.floor(m/S)*200;x.scrollTo({top:N,behavior:"smooth"})};return!l||s.length===0?null:e.jsx("div",{className:"home-page-alphabet-container",children:e.jsx("div",{className:"alphabet-navigator",children:f.map(i=>{const x=d(i);return e.jsx("button",{onClick:()=>g(i),disabled:!x,className:"alphabet-button",children:i},i)})})})}function ve({isOpen:s,onClose:n,onCloseCompletely:t,selectedValue:u,onSelect:l,games:r=[],config:f,additionalData:c}){const{t:d}=H(),[g,i]=a.useState(""),x=a.useRef(null),m=a.useMemo(()=>f.getAvailableValues(r,c),[r,f,c]),j=a.useMemo(()=>{if(!g)return m;const N=g.toLowerCase();return m.filter(M=>M.label.toLowerCase().includes(N)||M.value?.toString().toLowerCase().includes(N))},[m,g]);a.useEffect(()=>{if(!s)return;function N(M){x.current&&!x.current.contains(M.target)&&t()}return document.addEventListener("mousedown",N),()=>{document.removeEventListener("mousedown",N)}},[s,t]),a.useEffect(()=>{if(!s)return;function N(M){M.key==="Escape"&&t()}return document.addEventListener("keydown",N),()=>{document.removeEventListener("keydown",N)}},[s,t]),a.useEffect(()=>{s&&i("")},[s]);const S=()=>{n()},D=N=>{l(N)};return s?e.jsxs("div",{className:"filter-popup",ref:x,children:[e.jsxs("div",{className:"filter-popup-header",children:[e.jsx("button",{className:"filter-popup-back",onClick:S,children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M15 18l-6-6 6-6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),e.jsx("span",{className:"filter-popup-header-title",children:d(f.labelKey)})]}),e.jsx("div",{className:"filter-popup-search",children:e.jsx("input",{id:`filter-search-${f.type}`,name:"filterSearch",type:"text",className:"filter-popup-search-input",placeholder:d(f.searchPlaceholderKey),value:g,onChange:N=>i(N.target.value),onClick:N=>N.stopPropagation()})}),e.jsx("div",{className:`filter-popup-content ${f.isScrollable?"filter-popup-scrollable":""}`,children:j.map(N=>e.jsx("button",{className:`filter-popup-item ${u===N.value?"active":""}`,onClick:()=>D(N.value),children:N.label},N.value?.toString()||"null"))})]}):null}const pt={type:"year",labelKey:"gamesListToolbar.filter.year",searchPlaceholderKey:"gamesListToolbar.filter.searchYear",getAvailableValues:s=>{const n=new Set;return s.forEach(t=>{t.year!==null&&t.year!==void 0&&n.add(t.year)}),Array.from(n).sort((t,u)=>u-t).map(t=>({value:t,label:t.toString()}))},formatValue:s=>typeof s=="number"?s.toString():"",isScrollable:!1};function vt(s){return e.jsx(ve,{...s,config:pt})}function xt({availableGenres:s=[],...n}){const{t}=H(),u=a.useMemo(()=>({type:"genre",labelKey:"gamesListToolbar.filter.genre",searchPlaceholderKey:"gamesListToolbar.filter.searchGenre",getAvailableValues:(r,f)=>(f?.availableGenres||s).map(d=>({value:d.id,label:t(`genre.${d.title}`,d.title)})),formatValue:r=>{if(typeof r!="string")return"";const f=s.find(c=>c.id===r);return f?t(`genre.${f.title}`,f.title):""},isScrollable:!0}),[s,t]),l=a.useMemo(()=>({availableGenres:s}),[s]);return e.jsx(ve,{...n,config:u,additionalData:l})}const yt={type:"decade",labelKey:"gamesListToolbar.filter.decade",searchPlaceholderKey:"gamesListToolbar.filter.searchDecade",getAvailableValues:s=>{const n=new Set;return s.forEach(t=>{if(t.year!==null&&t.year!==void 0){const u=Math.floor(t.year/10)*10;n.add(u)}}),Array.from(n).sort((t,u)=>u-t).map(t=>({value:t,label:`${t}s`}))},formatValue:s=>typeof s=="number"?`${s}s`:"",isScrollable:!1};function bt(s){return e.jsx(ve,{...s,config:yt})}function jt({availableCollections:s=[],...n}){const t=a.useMemo(()=>({type:"collection",labelKey:"gamesListToolbar.filter.collection",searchPlaceholderKey:"gamesListToolbar.filter.searchCollection",getAvailableValues:(l,r)=>(r?.availableCollections||s).map(c=>({value:c.id,label:c.title})),formatValue:l=>{if(typeof l!="string")return"";const r=s.find(f=>f.id===l);return r?r.title:""},isScrollable:!0}),[s]),u=a.useMemo(()=>({availableCollections:s}),[s]);return e.jsx(ve,{...n,config:t,additionalData:u})}function wt({games:s=[],...n}){const{t,i18n:u}=H(),l={type:"ageRating",labelKey:"gamesListToolbar.filter.ageRating",searchPlaceholderKey:"gamesListToolbar.filter.searchAgeRating",getAvailableValues:r=>{const f=new Map;return r.forEach(c=>{c.ageRatings&&c.ageRatings.length>0&&Ke(c.ageRatings,u.language).forEach(g=>{const i=`${g.category}-${g.rating}`;f.has(i)||f.set(i,{category:g.category,rating:g.rating})})}),Array.from(f.values()).map(c=>{const d=ke(c.category,c.rating,t);return{value:`${c.category}-${c.rating}`,label:d}}).sort((c,d)=>{const[g,i]=c.value.split("-").map(Number),[x,m]=d.value.split("-").map(Number);return g!==x?g-x:i-m})},formatValue:r=>{if(typeof r=="string"&&r.includes("-")){const[f,c]=r.split("-").map(Number);return ke(f,c,t)}return""},isScrollable:!0};return e.jsx(ve,{...n,config:l,games:s})}function pe({type:s,isOpen:n,onClose:t,onCloseCompletely:u,selectedValue:l,onSelect:r,games:f=[],availableGenres:c=[],availableCollections:d=[]}){const g={isOpen:n,onClose:t,onCloseCompletely:u,selectedValue:l,onSelect:r,games:f};switch(s){case"year":return e.jsx(vt,{...g});case"genre":return e.jsx(xt,{...g,availableGenres:c});case"decade":return e.jsx(bt,{...g});case"collection":return e.jsx(jt,{...g,availableCollections:d});case"ageRating":return e.jsx(wt,{...g});default:return null}}function kt({isOpen:s,onClose:n,currentFilter:t,selectedYear:u,selectedGenre:l,selectedDecade:r,selectedCollection:f,selectedAgeRating:c,onFilterChange:d,onYearFilterChange:g,onGenreFilterChange:i,onDecadeFilterChange:x,onCollectionFilterChange:m,onAgeRatingFilterChange:j,games:S=[],availableGenres:D=[],availableCollections:N=[]}){const{t:M}=H(),[p,o]=a.useState(null),E=a.useRef(null),h=a.useRef(null),k=a.useRef(!1),L=a.useRef(!0);a.useEffect(()=>{s&&(L.current?(o(null),L.current=!1,t==="year"?h.current="year":t==="genre"?h.current="genre":t==="decade"?h.current="decade":h.current=null,k.current=!1):k.current?(o(null),t==="year"?h.current="year":t==="genre"?h.current="genre":t==="decade"?h.current="decade":t==="collection"?h.current="collection":t==="ageRating"&&(h.current="ageRating")):t==="year"?(o("year"),h.current="year"):t==="genre"?(o("genre"),h.current="genre"):t==="decade"?(o("decade"),h.current="decade"):t==="collection"?(o("collection"),h.current="collection"):t==="ageRating"?(o("ageRating"),h.current="ageRating"):h.current?o(h.current):o(null))},[s,t]),a.useEffect(()=>{if(!s&&!p)return;function C(I){const z=I.target;let te=!1;s&&E.current&&(te=!E.current.contains(z)),te&&!p&&n()}return document.addEventListener("mousedown",C),()=>{document.removeEventListener("mousedown",C)}},[s,p,n]),a.useEffect(()=>{if(!s&&!p)return;function C(I){I.key==="Escape"&&(p?(o(null),k.current=!0):n())}return document.addEventListener("keydown",C),()=>{document.removeEventListener("keydown",C)}},[s,p,n]);const A=C=>{C==="year"?(o("year"),h.current="year",k.current=!1):C==="genre"?(o("genre"),h.current="genre",k.current=!1):C==="decade"?(o("decade"),h.current="decade",k.current=!1):C==="collection"?(o("collection"),h.current="collection",k.current=!1):C==="ageRating"?(o("ageRating"),h.current="ageRating",k.current=!1):(d?.(C),g&&g(null),i&&i(null),x&&x(null),m&&m(null),j&&j(null),o(null),h.current=null,n())},T=C=>{const I=typeof C=="number"?C:null;I===null?(d?.("all"),g?.(null),o(null),h.current=null,n()):(d?.("year"),g?.(I),h.current="year",n())},P=C=>{const I=typeof C=="string"?C:null;I===null?(d?.("all"),i?.(null),o(null),h.current=null,n()):(d?.("genre"),i?.(I),g&&g(null),x&&x(null),m&&m(null),j&&j(null),h.current="genre",n())},Y=C=>{const I=typeof C=="number"?C:null;I===null?(d?.("all"),x?.(null),o(null),h.current=null,n()):(d?.("decade"),x?.(I),g&&g(null),i&&i(null),m&&m(null),j&&j(null),h.current="decade",n())},O=C=>{const I=typeof C=="string"?C:null;I===null?(d?.("all"),m?.(null),o(null),h.current=null,n()):(d?.("collection"),m?.(I),g&&g(null),i&&i(null),x&&x(null),j&&j(null),h.current="collection",n())},V=C=>{const I=typeof C=="string"?C:null;I===null?(d?.("all"),j?.(null),o(null),h.current=null,n()):(d?.("ageRating"),j?.(I),g&&g(null),i&&i(null),x&&x(null),m&&m(null),h.current="ageRating",n())},Z=()=>{o(null),h.current=null,k.current=!0},W=()=>{o(null),n()};return s&&p==="year"?e.jsx(pe,{type:"year",isOpen:!0,onClose:Z,onCloseCompletely:W,selectedValue:u,onSelect:T,games:S}):s&&p==="genre"?e.jsx(pe,{type:"genre",isOpen:!0,onClose:Z,onCloseCompletely:W,selectedValue:l,onSelect:P,games:S,availableGenres:D}):s&&p==="decade"?e.jsx(pe,{type:"decade",isOpen:!0,onClose:Z,onCloseCompletely:W,selectedValue:r,onSelect:Y,games:S}):s&&p==="collection"?e.jsx(pe,{type:"collection",isOpen:!0,onClose:Z,onCloseCompletely:W,selectedValue:f,onSelect:O,games:S,availableCollections:N}):s&&p==="ageRating"?e.jsx(pe,{type:"ageRating",isOpen:!0,onClose:Z,onCloseCompletely:W,selectedValue:c,onSelect:V,games:S}):!s||p?null:e.jsxs("div",{className:"filter-popup",ref:E,children:[e.jsxs("button",{className:`filter-popup-item ${t==="all"?"selected":""}`,onClick:()=>A("all"),children:[e.jsx("span",{children:M("gamesListToolbar.filter.all")}),t==="all"&&e.jsx("svg",{className:"filter-popup-check",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z",fill:"#E5A00D"})})]}),e.jsx("div",{className:"filter-popup-divider"}),e.jsxs("button",{className:`filter-popup-item ${t==="genre"?"selected":""}`,onClick:()=>A("genre"),children:[e.jsx("span",{children:M("gamesListToolbar.filter.genre")}),t==="genre"&&e.jsx("svg",{className:"filter-popup-check",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z",fill:"#E5A00D"})})]}),e.jsxs("button",{className:`filter-popup-item ${t==="year"?"selected":""}`,onClick:()=>A("year"),children:[e.jsx("span",{children:M("gamesListToolbar.filter.year")}),t==="year"&&e.jsx("svg",{className:"filter-popup-check",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z",fill:"#E5A00D"})})]}),e.jsxs("button",{className:`filter-popup-item ${t==="decade"?"selected":""}`,onClick:()=>A("decade"),children:[e.jsx("span",{children:M("gamesListToolbar.filter.decade")}),t==="decade"&&e.jsx("svg",{className:"filter-popup-check",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z",fill:"#E5A00D"})})]}),e.jsxs("button",{className:`filter-popup-item ${t==="ageRating"?"selected":""}`,onClick:()=>A("ageRating"),children:[e.jsx("span",{children:M("gamesListToolbar.filter.ageRating")}),t==="ageRating"&&e.jsx("svg",{className:"filter-popup-check",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z",fill:"#E5A00D"})})]}),e.jsxs("button",{className:`filter-popup-item ${t==="collection"?"selected":""}`,onClick:()=>A("collection"),children:[e.jsx("span",{children:M("gamesListToolbar.filter.collection")}),t==="collection"&&e.jsx("svg",{className:"filter-popup-check",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z",fill:"#E5A00D"})})]})]})}function Nt({isOpen:s,onClose:n,currentSort:t,sortAscending:u,onSortChange:l,onSortDirectionChange:r}){const{t:f}=H(),c=a.useRef(null);a.useEffect(()=>{if(!s)return;function i(x){c.current&&!c.current.contains(x.target)&&n()}return document.addEventListener("mousedown",i),()=>{document.removeEventListener("mousedown",i)}},[s,n]),a.useEffect(()=>{if(!s)return;function i(x){x.key==="Escape"&&n()}return document.addEventListener("keydown",i),()=>{document.removeEventListener("keydown",i)}},[s,n]);const d=[{value:"title",label:f("gamesListToolbar.sort.title")},{value:"year",label:f("gamesListToolbar.sort.year")},{value:"releaseDate",label:f("gamesListToolbar.sort.releaseDate")},{value:"criticRating",label:f("gamesListToolbar.sort.criticRating")},{value:"userRating",label:f("gamesListToolbar.sort.userRating")},{value:"stars",label:f("gamesListToolbar.sort.stars")},{value:"ageRating",label:f("gamesListToolbar.sort.ageRating")}],g=i=>{i===t&&r?r(!u):(l?.(i),r&&r(!0)),n()};return s?e.jsx("div",{className:"sort-popup",ref:c,children:d.map(i=>e.jsxs("button",{className:`sort-popup-item ${t===i.value?"selected":""}`,onClick:()=>g(i.value),children:[e.jsx("span",{children:i.label}),t===i.value&&e.jsx("svg",{className:`sort-popup-sort-direction ${u?"ascending":"descending"}`,width:"10",height:"10",viewBox:"0 0 12 12",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:u?"M6 2L10 8H2L6 2Z":"M6 10L2 4H10L6 10Z",fill:"currentColor"})})]},i.value))}):null}function St({gamesCount:s,games:n=[],onFilterChange:t,onYearFilterChange:u,onGenreFilterChange:l,onDecadeFilterChange:r,onCollectionFilterChange:f,onAgeRatingFilterChange:c,onSortChange:d,onSortDirectionChange:g,currentFilter:i="all",selectedYear:x=null,selectedGenre:m=null,selectedDecade:j=null,selectedCollection:S=null,selectedAgeRating:D=null,currentSort:N="title",sortAscending:M=!0,viewMode:p="grid",availableGenres:o=[],availableCollections:E=[]}){const{t:h}=H(),[k,L]=a.useState(!1),[A,T]=a.useState(!1),P=a.useRef(null),Y=a.useRef(null),V=(()=>{if(i==="year"&&x!==null)return x.toString();if(i==="decade"&&j!==null)return`${j}s`;if(i==="collection"&&S!==null){const I=E?.find(z=>z.id===S);return I?I.title:S}if(i==="genre"&&m!==null){const I=o.find(z=>z.id===m);return I?h(`genre.${I.title}`,I.title):m}if(i==="ageRating"&&D!==null){const[I,z]=D.split("-").map(Number);return ke(I,z,h)||D}return[{value:"all",label:h("gamesListToolbar.filter.all")},{value:"genre",label:h("gamesListToolbar.filter.genre")},{value:"year",label:h("gamesListToolbar.filter.year")},{value:"decade",label:h("gamesListToolbar.filter.decade")},{value:"collection",label:h("gamesListToolbar.filter.collection")},{value:"ageRating",label:h("gamesListToolbar.filter.ageRating")}].find(I=>I.value===i)?.label||""})(),W=[{value:"title",label:h("gamesListToolbar.sort.title")},{value:"year",label:h("gamesListToolbar.sort.year")},{value:"releaseDate",label:h("gamesListToolbar.sort.releaseDate")},{value:"criticRating",label:h("gamesListToolbar.sort.criticRating")},{value:"userRating",label:h("gamesListToolbar.sort.userRating")},{value:"stars",label:h("gamesListToolbar.sort.stars")},{value:"ageRating",label:h("gamesListToolbar.sort.ageRating")}].find(C=>C.value===N)?.label||"";return e.jsx("div",{className:"games-list-toolbar",children:e.jsxs("div",{className:"games-list-toolbar-left",children:[e.jsxs("div",{className:"games-list-toolbar-item",ref:P,children:[e.jsxs("button",{className:"games-list-toolbar-button",onClick:()=>{L(!k),T(!1)},children:[i&&i!=="all"&&e.jsx("span",{className:"games-list-toolbar-clear-button",onClick:C=>{C.stopPropagation(),t?.("all"),u&&u(null),l&&l(null),r&&r(null),f&&f(null),c&&c(null),L(!1)},role:"button",tabIndex:0,onKeyDown:C=>{(C.key==="Enter"||C.key===" ")&&(C.preventDefault(),C.stopPropagation(),t?.("all"),u&&u(null),l&&l(null),r&&r(null),f&&f(null),c&&c(null),L(!1))},children:e.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M18 6L6 18M6 6l12 12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),e.jsx("span",{className:"games-list-toolbar-value",children:V}),e.jsx("svg",{className:`games-list-toolbar-arrow ${k?"open":""}`,width:"12",height:"12",viewBox:"0 0 12 12",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M6 9L1 4h10L6 9z",fill:"currentColor"})})]}),e.jsx(kt,{isOpen:k,onClose:()=>L(!1),currentFilter:i,selectedYear:x,selectedGenre:m,selectedDecade:j,selectedCollection:S,selectedAgeRating:D,onFilterChange:t,onYearFilterChange:u,onGenreFilterChange:l,onDecadeFilterChange:r,onCollectionFilterChange:f,onAgeRatingFilterChange:c,games:n,availableGenres:o,availableCollections:E})]}),p!=="table"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"games-list-toolbar-item",ref:Y,children:[e.jsxs("button",{className:"games-list-toolbar-button",onClick:()=>{T(!A),L(!1)},children:[e.jsxs("span",{className:"games-list-toolbar-value",children:[h("gamesListToolbar.sort.prefix")," ",W]}),e.jsx("svg",{className:`games-list-toolbar-arrow ${A?"open":""}`,width:"12",height:"12",viewBox:"0 0 12 12",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M6 9L1 4h10L6 9z",fill:"currentColor"})})]}),e.jsx(Nt,{isOpen:A,onClose:()=>T(!1),currentSort:N,sortAscending:M,onSortChange:d,onSortDirectionChange:g})]}),e.jsx("span",{className:"games-list-toolbar-count",children:s})]}),p==="table"&&e.jsx("span",{className:"games-list-toolbar-count",children:s})]})})}function Oe(s){return s?s.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^\w\s]/g,"").trim():""}function Rt(s,n){const t=Oe(s||""),u=Oe(n||"");return t.localeCompare(u)}function At({onGameClick:s,onGamesLoaded:n,onPlay:t,allCollections:u=[]}){const{setLoading:l,isLoading:r}=Ne(),{categoryId:f}=Ze(),[c,d]=a.useState([]),[g,i]=a.useState(!1),x=(()=>{const v=localStorage.getItem("coverSize");return v?parseInt(v,10):150})(),[m,j]=a.useState(()=>localStorage.getItem("viewMode_category")||"grid"),[S,D]=a.useState("genre"),[N,M]=a.useState(null),[p,o]=a.useState(null),[E,h]=a.useState(null),[k,L]=a.useState(null),[A,T]=a.useState(null),[P,Y]=a.useState([]),[O,V]=a.useState([]),[Z,W]=a.useState([]),[C,I]=a.useState(new Map),[z,te]=a.useState("title"),[_,re]=a.useState(!0),q=a.useRef(null),ne=a.useRef(null),J=a.useRef(new Map),[se,de]=a.useState(()=>{const v=localStorage.getItem("tableColumnVisibility");if(v)try{return JSON.parse(v)}catch{return{title:!0,releaseDate:!0,year:!1,stars:!1,criticRating:!1,ageRating:!1}}return{title:!0,releaseDate:!0,criticRating:!1,ageRating:!1}});a.useEffect(()=>{localStorage.setItem("tableColumnVisibility",JSON.stringify(se))},[se]);const ie=v=>{z===v?re(!_):(te(v),re(!0))},xe=v=>{de(y=>({...y,[v]:!y[v]}))};We(m==="table"?ne:q,m),a.useEffect(()=>{Te(),Ee(),Le()},[]),a.useEffect(()=>{const v=y=>{const w=y.detail?.gameId;w&&d(B=>B.filter(b=>String(b.id)!==String(w)))};return window.addEventListener("gameDeleted",v),()=>{window.removeEventListener("gameDeleted",v)}},[]),ot({setGames:d,enabledEvents:["gameUpdated","gameDeleted"]}),a.useLayoutEffect(()=>{!r&&c.length>0?requestAnimationFrame(()=>{requestAnimationFrame(()=>{i(!0)})}):r&&i(!1)},[r,c.length]),a.useEffect(()=>{localStorage.setItem("viewMode_category",m)},[m]);const Re=v=>{j(v)};a.useEffect(()=>{if(f&&P.length>0){const v=P.find(y=>y.title===f);v&&(T(v.title),D("genre"))}},[f,P]);async function Ee(){try{const v=X(U,"/categories"),y=await fetch(v,{headers:{Accept:"application/json","X-Auth-Token":ee()}});if(!y.ok)throw new Error(`HTTP ${y.status}`);const B=((await y.json()).categories||[]).map(b=>({id:b,title:b}));Y(B)}catch(v){const y=String(v.message||v);console.error("Error fetching categories:",y)}}async function Le(){try{const v=X(U,"/collections"),y=await fetch(v,{headers:{Accept:"application/json","X-Auth-Token":ee()}});if(!y.ok)throw new Error(`HTTP ${y.status}`);const B=((await y.json()).collections||[]).map(G=>({id:G.id,title:G.title}));W(B);const b=new Map;for(const G of B)try{const K=X(U,`/collections/${G.id}/games`),Q=await fetch(K,{headers:{Accept:"application/json","X-Auth-Token":ee()}});if(Q.ok){const me=((await Q.json()).games||[]).map(ye=>ye.id);b.set(G.id,me)}}catch(K){console.error(`Error fetching games for collection ${G.id}:`,K.message)}I(b)}catch(v){const y=String(v.message||v);console.error("Error fetching collections:",y)}}async function Te(){l(!0);try{const v=X(U,"/libraries/library/games",{sort:"title"}),y=await fetch(v,{headers:{Accept:"application/json","X-Auth-Token":ee()}});if(!y.ok)throw new Error(`HTTP ${y.status}`);const B=((await y.json()).games||[]).map(b=>({id:String(b.id),title:b.title,summary:b.summary,cover:b.cover,day:b.day,month:b.month,year:b.year,stars:b.stars,genre:b.genre,criticratings:b.criticratings,userratings:b.userratings,command:b.command||null,themes:b.themes||null,platforms:b.platforms||null,gameModes:b.gameModes||null,playerPerspectives:b.playerPerspectives||null,websites:b.websites||null,ageRatings:b.ageRatings||null,developers:b.developers||null,publishers:b.publishers||null,franchise:b.franchise||null,collection:b.collection||null,screenshots:b.screenshots||null,videos:b.videos||null,gameEngines:b.gameEngines||null,keywords:b.keywords||null,alternativeNames:b.alternativeNames||null,similarGames:b.similarGames||null}));d(B),n(B)}catch(v){const y=String(v.message||v);console.error("Error fetching library games:",y)}finally{l(!1)}}a.useEffect(()=>{if(c.length===0||P.length===0)return;const v=new Set;c.forEach($=>{$.genre&&(Array.isArray($.genre)?$.genre.forEach(w=>{typeof w=="string"?v.add(w):v.add(String(w))}):typeof $.genre=="string"&&v.add($.genre))});const y=P.filter($=>v.has($.title));V(y),A!==null&&S==="genre"&&(y.some(w=>w.title===A)||(T(null),D("all")))},[c,P,A,S]);const oe=a.useMemo(()=>{let v=[...c];return S!=="all"&&(v=v.filter(y=>{switch(S){case"genre":return A!==null?Array.isArray(y.genre)?y.genre.some($=>(typeof $=="string"?$:String($))===A):typeof y.genre=="string"?y.genre===A:!1:!0;case"year":return N!==null?y.year===N:y.year!==null&&y.year!==void 0;case"decade":return p!==null&&y.year!==null&&y.year!==void 0?Math.floor(y.year/10)*10===p:!1;case"collection":if(E!==null){const $=C.get(E);return $?$.includes(y.id):!1}return!1;case"ageRating":if(k!==null){const[$,w]=k.split("-").map(Number);return y.ageRatings&&y.ageRatings.length>0?y.ageRatings.some(B=>B.category===$&&B.rating===w):!1}return!1;default:return!0}})),v.sort((y,$)=>{let w=0;switch(z){case"title":w=Rt(y.title||"",$.title||"");break;case"year":const B=y.year??0;w=($.year??0)-B;break;case"stars":const G=y.stars??0;w=($.stars??0)-G;break;case"releaseDate":const Q=y.year??0,F=$.year??0;if(Q!==F)w=F-Q;else{const je=y.month??0,De=$.month??0;if(je!==De)w=De-je;else{const ce=y.day??0;w=($.day??0)-ce}}break;case"criticRating":const me=y.criticratings??0;w=($.criticratings??0)-me;break;case"userRating":const ae=y.userratings??0;w=($.userratings??0)-ae;break;case"ageRating":const ue=y.ageRatings&&y.ageRatings.length>0?y.ageRatings:[],$e=$.ageRatings&&$.ageRatings.length>0?$.ageRatings:[];if(ue.length===0&&$e.length===0)w=0;else if(ue.length===0)w=1;else if($e.length===0)w=-1;else{const je=ue.reduce((ce,ge)=>{const he=ge.category*1e3+ge.rating;return he>ce?he:ce},0);w=$e.reduce((ce,ge)=>{const he=ge.category*1e3+ge.rating;return he>ce?he:ce},0)-je}break;default:return 0}return z==="title"?_?w:-w:_?-w:w}),v},[c,S,N,p,A,E,k,z,_,O,C]),fe=v=>{d(y=>y.map($=>String($.id)===String(v.id)?v:$)),window.dispatchEvent(new CustomEvent("gameUpdated",{detail:{game:v}}))},R=v=>{d(y=>y.filter($=>$.id!==v.id))};return e.jsxs(e.Fragment,{children:[e.jsx(it,{libraries:[],activeLibrary:null,onSelectLibrary:()=>{},loading:!1,error:null,viewMode:m,onViewModeChange:Re}),e.jsx("div",{className:"bg-[#1a1a1a] home-page-main-container",children:e.jsx("main",{className:"flex-1 home-page-content",children:e.jsxs("div",{className:"home-page-layout",children:[e.jsxs("div",{className:`home-page-content-wrapper ${!r&&c.length>0?"has-toolbar":""}`,style:{opacity:g?1:0,transition:"opacity 0.2s ease-in-out"},children:[!r&&c.length>0&&e.jsx(St,{gamesCount:oe.length,games:c,onFilterChange:D,onYearFilterChange:M,onGenreFilterChange:T,onDecadeFilterChange:o,onSortChange:te,onSortDirectionChange:re,currentFilter:S,selectedYear:N,selectedGenre:A,selectedDecade:p,selectedCollection:E,onCollectionFilterChange:h,selectedAgeRating:k,onAgeRatingFilterChange:L,currentSort:z,sortAscending:_,viewMode:m,availableGenres:O,availableCollections:Z}),m==="table"&&!r&&c.length>0&&e.jsx(mt,{columnVisibility:se,onToggleColumn:xe,sortField:z,sortAscending:_,onSort:ie}),e.jsx("div",{ref:q,className:`home-page-scroll-container ${m==="table"?"table-view":""}`,children:!r&&e.jsxs(e.Fragment,{children:[m==="grid"&&e.jsx(dt,{games:oe,onGameClick:s,onPlay:t,onGameUpdate:fe,onGameDelete:R,buildCoverUrl:(v,y,$)=>Ie(v,y,$??!0),coverSize:x,itemRefs:J,viewMode:m,allCollections:u}),m==="detail"&&e.jsx(gt,{games:oe,onGameClick:s,onPlay:t,onGameUpdate:fe,onGameDelete:R,buildCoverUrl:(v,y,$)=>Ie(v,y,$??!0),itemRefs:J,allCollections:u}),m==="table"&&e.jsx(ft,{games:oe,onGameClick:s,onPlay:t,onGameUpdate:fe,onGameDelete:R,itemRefs:J,scrollContainerRef:ne,allCollections:u,columnVisibility:se})]})})]}),z==="title"&&g&&e.jsx(ht,{games:oe,scrollContainerRef:m==="table"?ne:q,itemRefs:J,ascending:_})]})})})]})}export{ht as A,Dt as B,At as C,Be as E,dt as G,it as L,He as S,st as a,Qe as b,Rt as c,tt as d,St as e,Ke as f,mt as g,gt as h,ft as i,ot as u};
