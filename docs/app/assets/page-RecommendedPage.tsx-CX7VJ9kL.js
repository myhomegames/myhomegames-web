import{j as l,r as a,c as X}from"./react-vendor-jNdKP8wU.js";import{G as H,h as q,e as D,f as Q,b as Y,a as _}from"./page-CollectionDetail.tsx-DYxPNzRb.js";import{u as K}from"./i18n-vendor-mPXi0JFR.js";import{A as O}from"./page-AddGamePage.tsx-CGFUTWrs.js";function U({canScrollLeft:e,canScrollRight:n,onScrollToFirst:s,onScrollToLast:f}){return l.jsxs("div",{className:"scrollable-section-nav",children:[l.jsx("button",{className:`scrollable-section-nav-button ${e?"":"scrollable-section-nav-button-hidden"}`,onClick:s,"aria-label":"Scroll to beginning",children:l.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:l.jsx("path",{d:"M15 18l-6-6 6-6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),l.jsx("button",{className:`scrollable-section-nav-button ${n?"":"scrollable-section-nav-button-hidden"}`,onClick:f,"aria-label":"Scroll to end",children:l.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:l.jsx("path",{d:"M9 6l6 6-6 6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})]})}const P=new Map,k=[];let N=!1;const V=500,J={it:"it",fr:"fr",es:"es",de:"de",pt:"pt",ja:"ja",zh:"zh",en:"en"};function Z(e,n,s={}){const{t:f,i18n:r}=K(),[u,c]=a.useState(e),b=a.useRef(!1);return a.useEffect(()=>{if(s.disabled){c(e);return}const p=f(n,{defaultValue:"$$$$MISSING$$$$"});if(p!=="$$$$MISSING$$$$"&&p!==n&&p!==e){c(p);return}if(r.language==="en"){c(z(e));return}const x=`${e}-${r.language}`;if(P.has(x)){c(P.get(x));return}if(b.current)return;b.current=!0,(async()=>new Promise((d,w)=>{k.push({text:e,targetLang:r.language,cacheKey:x,resolve:d,reject:w}),te()}))().then(d=>{c(d),b.current=!1}).catch(d=>{console.error(`Error translating "${e}":`,d),c(e),b.current=!1})},[e,n,f,r.language,s.disabled]),u}function z(e){if(!e||typeof e!="string")return e;let n=e.replace(/-/g," ");return n=n.toLowerCase().split(" ").map(s=>s.length===0?s:s.charAt(0).toUpperCase()+s.slice(1)).join(" "),n}async function ee(e,n){try{const s=`https://translate.googleapis.com/translate_a/single?client=gtx&sl=en&tl=${n}&dt=t&q=${encodeURIComponent(e)}`,f=await fetch(s,{method:"GET",headers:{Accept:"application/json","User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"}});if(!f.ok)return null;const r=await f.json();if(Array.isArray(r)&&r[0]&&Array.isArray(r[0])){const u=r[0].map(c=>c&&c[0]).filter(Boolean);if(u.length>0)return u.join("")}return null}catch{return null}}async function te(){if(!(N||k.length===0)){for(N=!0;k.length>0;){const e=k.shift();if(!e)break;try{k.length>0&&await new Promise(r=>setTimeout(r,V));const n=J[e.targetLang]||e.targetLang;if(!n||n==="en"){e.resolve(e.text);return}let s=3,f=null;for(;s>0;)try{const r=await ee(e.text,n);if(r){const u=z(r);P.set(e.cacheKey,u),e.resolve(u);break}else{e.resolve(e.text);break}}catch(r){if(f=r,s--,s>0){const u=Math.pow(2,3-s)*1e3;await new Promise(c=>setTimeout(c,u))}}s===0&&f&&e.resolve(e.text)}catch(n){console.error("[useAutoTranslate] Error processing translation queue:",n),e.resolve(e.text)}}N=!1}}function ne(e){try{const n=sessionStorage.getItem(e);return n?parseInt(n,10):0}catch{return 0}}function G(e,n){try{sessionStorage.setItem(e,n.toString())}catch{}}function se({sectionId:e,games:n,onGameClick:s,onPlay:f,onGameUpdate:r,coverSize:u,allCollections:c=[],titleOverride:b,disableAutoTranslate:p=!1,showTitle:x=!0}){const v=X(),d=a.useRef(null),w=`${v.pathname}:${e}`,[T,C]=a.useState(!1),[A,o]=a.useState(!1),[m,S]=a.useState(!0),y=`recommended.${e}`,$=Z(e,y,{disabled:p}),R=b||(p?e:$),g=()=>{const t=d.current;if(!t)return;const L=t.scrollLeft,E=t.scrollWidth-t.clientWidth;C(L>0),o(L<E-1)},h=()=>{d.current?.scrollTo({left:0,behavior:"smooth"})},W=()=>{const t=d.current;if(t){const L=t.scrollWidth-t.clientWidth;t.scrollTo({left:L,behavior:"smooth"})}};return a.useEffect(()=>{const t=d.current;if(!t)return;S(!0);const L=ne(w);if(L<=0){S(!1);return}const E=(j=0)=>{if(!t){S(!1);return}if(t.scrollWidth<=t.clientWidth){j<20?requestAnimationFrame(()=>E(j+1)):S(!1);return}t.scrollLeft=L,g(),S(!1)},i=setTimeout(()=>{E()},100);return()=>{clearTimeout(i),S(!1)}},[v.pathname,e,w,n.length]),a.useEffect(()=>{const t=d.current;if(!t)return;const L=()=>{m||G(w,t.scrollLeft),g()},E=i=>{const j=t.getBoundingClientRect();if(!(i.clientX>=j.left&&i.clientX<=j.right&&i.clientY>=j.top&&i.clientY<=j.bottom)||!(t.scrollWidth>t.clientWidth))return;if(Math.abs(i.deltaX)>Math.abs(i.deltaY)||Math.abs(i.deltaX)>0){i.preventDefault(),i.stopPropagation();const M=t.scrollLeft,F=t.scrollWidth-t.clientWidth,I=M>0&&i.deltaX<0,B=M<F&&i.deltaX>0;(I||B)&&(t.scrollLeft+=i.deltaX)}};return t.addEventListener("scroll",L,{passive:!0}),t.addEventListener("wheel",E,{passive:!1,capture:!0}),()=>{t.removeEventListener("scroll",L),t.removeEventListener("wheel",E);const i=t.scrollLeft;i>0&&!m&&G(w,i)}},[e,w,m]),a.useEffect(()=>{g();const t=setTimeout(g,200);return()=>clearTimeout(t)},[n.length]),n.length===0?null:l.jsxs("div",{className:"scrollable-section",children:[x&&l.jsxs("div",{className:"scrollable-section-header",children:[l.jsx("h2",{className:"scrollable-section-title",children:R}),l.jsx(U,{canScrollLeft:T,canScrollRight:A,onScrollToFirst:h,onScrollToLast:W})]}),!x&&l.jsx(U,{canScrollLeft:T,canScrollRight:A,onScrollToFirst:h,onScrollToLast:W}),l.jsx("div",{ref:d,className:`scrollable-section-scroll ${m?"restoring":""}`,children:l.jsx(H,{games:n,onGameClick:s,onPlay:f,onGameUpdate:r,buildCoverUrl:q,coverSize:u,allCollections:c,enableVirtualization:!1})})]})}function de({onGameClick:e,onGamesLoaded:n,onPlay:s,coverSize:f,allCollections:r=[]}){const{setLoading:u}=D(),[c,b]=a.useState([]),[p,x]=a.useState(!1),[v,d]=a.useState(!1),w=a.useRef(null),T=a.useRef(!1);Q(w);const C=o=>{b(m=>m.map(S=>({...S,games:S.games.map(y=>String(y.id)===String(o.id)?o:y)}))),window.dispatchEvent(new CustomEvent("gameUpdated",{detail:{game:o}}))};a.useEffect(()=>{const o=m=>{const y=m.detail?.game;y&&b($=>$.map(R=>({...R,games:R.games.map(g=>String(g.id)===String(y.id)?y:g)})))};return window.addEventListener("gameUpdated",o),()=>{window.removeEventListener("gameUpdated",o)}},[]),a.useEffect(()=>{A()},[]),a.useEffect(()=>{const o=()=>{A()};return window.addEventListener("metadataReloaded",o),()=>{window.removeEventListener("metadataReloaded",o)}},[]),a.useLayoutEffect(()=>{v?v&&x(!1):requestAnimationFrame(()=>{requestAnimationFrame(()=>{x(!0)})})},[v,c.length]),a.useEffect(()=>{u(v||!p)},[v,p,u]);async function A(){if(!T.current){T.current=!0,d(!0),u(!0);try{const o=Y(O,"/recommended"),m=await fetch(o,{headers:_({Accept:"application/json"})});if(!m.ok)throw new Error(`HTTP ${m.status}`);const $=((await m.json()).sections||[]).map(g=>({id:g.id,games:(g.games||[]).map(h=>({id:h.id,title:h.title,summary:h.summary,cover:h.cover,background:h.background,day:h.day,month:h.month,year:h.year,stars:h.stars,genre:h.genre,executables:h.executables||null}))}));b($);const R=$.flatMap(g=>g.games);n(R)}catch(o){const m=String(o.message||o);console.error("Error fetching recommended sections:",m)}finally{d(!1),T.current=!1}}}return l.jsx("main",{className:"flex-1 home-page-content",children:l.jsx("div",{className:"home-page-layout",children:l.jsx("div",{className:"home-page-content-wrapper",style:{opacity:p?1:0,transition:"opacity 0.2s ease-in-out"},children:l.jsx("div",{ref:w,className:"home-page-scroll-container",style:{paddingTop:"16px",paddingBottom:"32px"},children:!v&&c.map(o=>l.jsx(se,{sectionId:o.id,games:o.games,onGameClick:e,onPlay:s,onGameUpdate:C,coverSize:f,allCollections:r},o.id))})})})})}export{de as R,se as S};
