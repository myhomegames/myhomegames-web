import{j as n,c as M,r as i}from"./react-vendor-COHXxlBx.js";import{d as U,u as X,c as G,b as $}from"./page-CategoriesPage.tsx-5ovgj7yS.js";import{G as B}from"./page-CategoryPage.tsx-CK7WlBuw.js";import{u as F}from"./i18n-vendor-ClaDN9Oc.js";import{A as H,g as z}from"./page-AddGamePage.tsx-kNlLaymQ.js";function q({canScrollLeft:s,canScrollRight:r,onScrollToFirst:j,onScrollToLast:E}){return n.jsxs("div",{className:"recommended-section-nav",children:[n.jsx("button",{className:`recommended-section-nav-button ${s?"":"recommended-section-nav-button-hidden"}`,onClick:s?j:void 0,"aria-label":"Go to first",disabled:!s,children:n.jsx("svg",{width:"20",height:"20",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5L8.25 12l7.5-7.5"})})}),n.jsx("button",{className:`recommended-section-nav-button ${r?"":"recommended-section-nav-button-hidden"}`,onClick:r?E:void 0,"aria-label":"Go to last",disabled:!r,children:n.jsx("svg",{width:"20",height:"20",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 4.5l7.5 7.5-7.5 7.5"})})})]})}function D(s){try{const r=sessionStorage.getItem(s);return r?parseInt(r,10):0}catch{return 0}}function C(s,r){try{sessionStorage.setItem(s,r.toString())}catch{}}function I({sectionId:s,games:r,onGameClick:j,onPlay:E,onGameUpdate:T,coverSize:w,allCollections:S=[]}){const{t:y}=F(),L=M(),h=i.useRef(null),g=`${L.pathname}:${s}`,[b,k]=i.useState(!1),[R,t]=i.useState(!1),[a,l]=i.useState(!0),m=`recommended.${s}`,x=y(m,{defaultValue:s}),u=()=>{const e=h.current;if(!e)return;const d=e.scrollLeft,p=e.scrollWidth-e.clientWidth;k(d>0),t(d<p-1)},f=()=>{h.current?.scrollTo({left:0,behavior:"smooth"})},c=()=>{const e=h.current;if(e){const d=e.scrollWidth-e.clientWidth;e.scrollTo({left:d,behavior:"smooth"})}};return i.useEffect(()=>{const e=h.current;if(!e)return;l(!0);const d=D(g);if(d<=0){l(!1);return}const p=(v=0)=>{if(!e){l(!1);return}if(e.scrollWidth<=e.clientWidth){v<20?requestAnimationFrame(()=>p(v+1)):l(!1);return}e.scrollLeft=d,u(),l(!1)},o=setTimeout(()=>{p()},100);return()=>{clearTimeout(o),l(!1)}},[L.pathname,s,g,r.length]),i.useEffect(()=>{const e=h.current;if(!e)return;const d=()=>{a||C(g,e.scrollLeft),u()},p=o=>{const v=e.getBoundingClientRect();if(!(o.clientX>=v.left&&o.clientX<=v.right&&o.clientY>=v.top&&o.clientY<=v.bottom)||!(e.scrollWidth>e.clientWidth))return;if(Math.abs(o.deltaX)>Math.abs(o.deltaY)||Math.abs(o.deltaX)>0){o.preventDefault(),o.stopPropagation();const W=e.scrollLeft,N=e.scrollWidth-e.clientWidth,A=W>0&&o.deltaX<0,P=W<N&&o.deltaX>0;(A||P)&&(e.scrollLeft+=o.deltaX)}};return e.addEventListener("scroll",d,{passive:!0}),e.addEventListener("wheel",p,{passive:!1,capture:!0}),()=>{e.removeEventListener("scroll",d),e.removeEventListener("wheel",p);const o=e.scrollLeft;o>0&&!a&&C(g,o)}},[s,g,a]),i.useEffect(()=>{u();const e=setTimeout(u,200);return()=>clearTimeout(e)},[r.length]),r.length===0?null:n.jsxs("div",{className:"recommended-section",children:[n.jsxs("div",{className:"recommended-section-header",children:[n.jsx("h2",{className:"recommended-section-title",children:x}),n.jsx(q,{canScrollLeft:b,canScrollRight:R,onScrollToFirst:f,onScrollToLast:c})]}),n.jsx("div",{ref:h,className:`recommended-section-scroll ${a?"restoring":""}`,children:n.jsx(B,{games:r,onGameClick:j,onPlay:E,onGameUpdate:T,buildCoverUrl:U,coverSize:w,allCollections:S})})]})}function ee({onGameClick:s,onGamesLoaded:r,onPlay:j,coverSize:E,allCollections:T=[]}){const{setLoading:w,isLoading:S}=X(),[y,L]=i.useState([]),[h,g]=i.useState(!1),b=i.useRef(null);G(b);const k=t=>{L(a=>a.map(l=>({...l,games:l.games.map(m=>String(m.id)===String(t.id)?t:m)}))),window.dispatchEvent(new CustomEvent("gameUpdated",{detail:{game:t}}))};i.useEffect(()=>{const t=a=>{const m=a.detail?.game;m&&L(x=>x.map(u=>({...u,games:u.games.map(f=>String(f.id)===String(m.id)?m:f)})))};return window.addEventListener("gameUpdated",t),()=>{window.removeEventListener("gameUpdated",t)}},[]),i.useEffect(()=>{R()},[]),i.useEffect(()=>{const t=()=>{R()};return window.addEventListener("metadataReloaded",t),()=>{window.removeEventListener("metadataReloaded",t)}},[]),i.useLayoutEffect(()=>{!S&&y.length>0?requestAnimationFrame(()=>{requestAnimationFrame(()=>{g(!0)})}):S&&g(!1)},[S,y.length]);async function R(){w(!0);try{const t=$(H,"/recommended"),a=await fetch(t,{headers:{Accept:"application/json","X-Auth-Token":z()}});if(!a.ok)throw new Error(`HTTP ${a.status}`);const x=((await a.json()).sections||[]).map(f=>({id:f.id,games:(f.games||[]).map(c=>({id:c.id,title:c.title,summary:c.summary,cover:c.cover,background:c.background,day:c.day,month:c.month,year:c.year,stars:c.stars,genre:c.genre,command:c.command||null}))}));L(x);const u=x.flatMap(f=>f.games);r(u)}catch(t){const a=String(t.message||t);console.error("Error fetching recommended sections:",a)}finally{w(!1)}}return n.jsx("main",{className:"flex-1 home-page-content",children:n.jsx("div",{className:"home-page-layout",children:n.jsx("div",{className:"home-page-content-wrapper",style:{opacity:h?1:0,transition:"opacity 0.2s ease-in-out"},children:n.jsx("div",{ref:b,className:"home-page-scroll-container",style:{paddingTop:"16px",paddingBottom:"32px"},children:!S&&y.map(t=>n.jsx(I,{sectionId:t.id,games:t.games,onGameClick:s,onPlay:j,onGameUpdate:k,coverSize:E,allCollections:T},t.id))})})})})}export{ee as R};
