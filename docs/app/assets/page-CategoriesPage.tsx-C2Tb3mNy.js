import{r as m,j as n,b as V,c as be,u as Te}from"./react-vendor-jNdKP8wU.js";import{g as D,a as Re,A as L}from"./page-AddGamePage.tsx-SkGFkz5J.js";import{u as F}from"./i18n-vendor-mPXi0JFR.js";function M(e,o,l={}){const c=new URL(o,e);return Object.entries(l).forEach(([d,r])=>c.searchParams.set(d,String(r))),c.toString()}function Je(e={}){const o=D(),l={...e};if(o){l["X-Auth-Token"]=o;const c=Re();c&&(l["X-Twitch-Client-Id"]=c)}return l}function Se(e,o,l){if(!o)return"";if(o.startsWith("http://")||o.startsWith("https://"))return o;if(o.includes("?t=")||o.includes("&t=")){const r=o.split("?")[0],w=o.includes("?")?o.substring(o.indexOf("?")):"",u=new URL(r,e);return w&&new URLSearchParams(w).forEach((f,a)=>{u.searchParams.set(a,f)}),u.toString()}const d=new URL(o,e);return l&&d.searchParams.set("t",Date.now().toString()),d.toString()}function Ve(e,o,l){if(!o)return"";if(o.startsWith("http://")||o.startsWith("https://"))return o;if(o.includes("?t=")||o.includes("&t=")){const r=o.split("?")[0],w=o.includes("?")?o.substring(o.indexOf("?")):"",u=new URL(r,e);return w&&new URLSearchParams(w).forEach((f,a)=>{u.searchParams.set(a,f)}),u.toString()}const d=new URL(o,e);return l&&d.searchParams.set("t",Date.now().toString()),d.toString()}function Ke(){const[e,o]=m.useState(!1),[l,c]=m.useState(null);return{isEditModalOpen:e,selectedGame:l,openEditModal:w=>{c(w),o(!0)},closeEditModal:()=>{o(!1),c(null)}}}const pe=m.createContext(void 0);function Qe({children:e}){const[o,l]=m.useState(!1),c=m.useCallback(r=>{l(r)},[]),d=m.useMemo(()=>({isLoading:o,setLoading:c}),[o,c]);return n.jsx(pe.Provider,{value:d,children:e})}function U(){const e=m.useContext(pe);if(e===void 0)throw new Error("useLoading must be used within a LoadingProvider");return e}function Ne({gameId:e,collectionId:o,onGameDelete:l,onCollectionDelete:c,onModalClose:d}){const{t:r}=F(),{setLoading:w}=U(),[u,t]=m.useState(!1),[f,a]=m.useState(null),[v,i]=m.useState(!1);return{isDeleting:u,deleteError:f,showConfirmModal:v,handleDeleteClick:()=>{i(!0)},handleConfirmDelete:async()=>{const h=D();if(h){t(!0),a(null),w(!0);try{let s;if(e)s=M(L,`/games/${e}`);else if(o)s=M(L,`/collections/${o}`);else return;(await fetch(s,{method:"DELETE",headers:{"X-Auth-Token":h}})).ok?(e&&l?l(e):o&&c&&c(o),e?window.dispatchEvent(new CustomEvent("gameDeleted",{detail:{gameId:e}})):o&&window.dispatchEvent(new CustomEvent("collectionDeleted",{detail:{collectionId:o}})),i(!1),d&&d()):a(r("common.deleteError"))}catch(s){console.error("Error deleting item:",s),a(r("common.deleteError"))}finally{t(!1),w(!1)}}},handleCancelDelete:()=>{i(!1),a(null),d&&d()}}}function Le({gameId:e,collectionId:o,onGameUpdate:l,onCollectionUpdate:c,onReload:d,onModalClose:r}){const{t:w}=F(),{setLoading:u}=U(),[t,f]=m.useState(!1),[a,v]=m.useState(null),[i,k]=m.useState(!1),g=async()=>{const C=D();if(C){f(!0),v(null),u(!0);try{let y;e?y=M(L,`/games/${e}/reload`):o?y=M(L,`/collections/${o}/reload`):y=M(L,"/reload-games");const x=await fetch(y,{method:"POST",headers:{"X-Auth-Token":C}});if(x.ok){const p=await x.json();if(e)if(l&&p.game){const S={id:p.game.id,title:p.game.title,summary:p.game.summary||"",cover:p.game.cover,background:p.game.background,day:p.game.day||null,month:p.game.month||null,year:p.game.year||null,stars:p.game.stars||null,genre:p.game.genre||null,command:p.game.command||null,criticratings:p.game.criticratings||null,userratings:p.game.userratings||null,themes:p.game.themes||null,platforms:p.game.platforms||null,gameModes:p.game.gameModes||null,playerPerspectives:p.game.playerPerspectives||null,websites:p.game.websites||null,ageRatings:p.game.ageRatings||null,developers:p.game.developers||null,publishers:p.game.publishers||null,franchise:p.game.franchise||null,collection:p.game.collection||null,screenshots:p.game.screenshots||null,videos:p.game.videos||null,gameEngines:p.game.gameEngines||null,keywords:p.game.keywords||null,alternativeNames:p.game.alternativeNames||null,similarGames:p.game.similarGames||null};l(S),f(!1),u(!1);return}else{f(!1),u(!1);return}else if(o)if(c&&p.collection){const S={id:p.collection.id,title:p.collection.title,summary:p.collection.summary||"",cover:p.collection.cover,background:p.collection.background};c(S),f(!1),u(!1);return}else{f(!1),u(!1);return}else if(d)await d(),f(!1),u(!1);else{const S=window.location.pathname;window.location.href=S}}else console.error("Failed to reload metadata"),v(w("common.reloadError","Failed to reload metadata")),f(!1),u(!1)}catch(y){console.error("Error reloading metadata:",y),v(w("common.reloadError","Failed to reload metadata")),f(!1),u(!1)}}};return{isReloading:t,reloadError:a,showReloadConfirmModal:i,handleReloadClick:()=>{k(!0)},handleConfirmReload:async()=>{d?d():await g(),k(!1)},handleCancelReload:()=>{k(!1),v(null),r&&r()}}}function Me({gameId:e,onGameUpdate:o}){const{setLoading:l}=U(),[c,d]=m.useState(!1);return{isUnlinking:c,handleUnlinkExecutable:async()=>{d(!0),l(!0);try{const w=M(L,`/games/${e}`),u=await fetch(w,{method:"PUT",headers:{"Content-Type":"application/json","X-Auth-Token":D()},body:JSON.stringify({command:null})});if(u.ok){const t=await u.json(),f={id:t.game.id,title:t.game.title,summary:t.game.summary||"",cover:t.game.cover,background:t.game.background,day:t.game.day??null,month:t.game.month??null,year:t.game.year??null,stars:t.game.stars??null,genre:t.game.genre??null,criticratings:t.game.criticratings??null,userratings:t.game.userratings??null,themes:t.game.themes??null,platforms:t.game.platforms??null,gameModes:t.game.gameModes??null,playerPerspectives:t.game.playerPerspectives??null,websites:t.game.websites??null,ageRatings:t.game.ageRatings??null,developers:t.game.developers??null,publishers:t.game.publishers??null,franchise:t.game.franchise??null,collection:t.game.collection??null,screenshots:t.game.screenshots??null,videos:t.game.videos??null,gameEngines:t.game.gameEngines??null,keywords:t.game.keywords??null,alternativeNames:t.game.alternativeNames??null,similarGames:t.game.similarGames??null};"command"in f&&delete f.command,o(f)}else console.error("Failed to unlink executable")}catch(w){console.error("Error unlinking executable:",w)}finally{d(!1),l(!1)}}}}function Ye({game:e,onGameUpdate:o}){const{t:l}=F(),{setLoading:c}=U(),[d,r]=m.useState(!1),[w,u]=m.useState(!1),t=m.useRef(null);return{isUploading:d,isUnlinking:w,fileInputRef:t,handleFileSelect:async i=>{const k=i.name.toLowerCase();if(!k.endsWith(".sh")&&!k.endsWith(".bat")){alert(l("gameDetail.invalidFileType","Only .sh and .bat files are allowed"));return}r(!0),c(!0);try{const g=new FormData;g.append("file",i);const j=M(L,`/games/${e.id}/upload-executable`),h=await fetch(j,{method:"POST",headers:{"X-Auth-Token":D()||""},body:g});if(!h.ok){const C=await h.json().catch(()=>({error:"Failed to upload file"}));throw new Error(C.error||"Failed to upload file")}const s=await h.json();if(s.game){const C={...e,id:s.game.id,title:s.game.title,summary:s.game.summary||"",cover:s.game.cover,background:s.game.background,day:s.game.day??e.day??null,month:s.game.month??e.month??null,year:s.game.year??e.year??null,stars:s.game.stars??e.stars??null,genre:s.game.genre??e.genre??null,criticratings:s.game.criticratings??e.criticratings??null,userratings:s.game.userratings??e.userratings??null,command:s.game.command??e.command??null,themes:s.game.themes??e.themes??null,platforms:s.game.platforms??e.platforms??null,gameModes:s.game.gameModes??e.gameModes??null,playerPerspectives:s.game.playerPerspectives??e.playerPerspectives??null,websites:s.game.websites??e.websites??null,ageRatings:s.game.ageRatings??e.ageRatings??null,developers:s.game.developers??e.developers??null,publishers:s.game.publishers??e.publishers??null,franchise:s.game.franchise??e.franchise??null,collection:s.game.collection??e.collection??null,screenshots:s.game.screenshots??e.screenshots??null,videos:s.game.videos??e.videos??null,gameEngines:s.game.gameEngines??e.gameEngines??null,keywords:s.game.keywords??e.keywords??null,alternativeNames:s.game.alternativeNames??e.alternativeNames??null,similarGames:s.game.similarGames??e.similarGames??null};o(C)}}catch(g){console.error("Error uploading file:",g),alert(g.message||l("common.error","Error"))}finally{r(!1),c(!1)}},handleBrowseClick:()=>{t.current?.click()},handleUnlinkExecutable:async()=>{u(!0),c(!0);try{const i=M(L,`/games/${e.id}`),k=await fetch(i,{method:"PUT",headers:{"Content-Type":"application/json","X-Auth-Token":D()},body:JSON.stringify({command:null})});if(k.ok){const g=await k.json(),j={...e,id:g.game.id,title:g.game.title,summary:g.game.summary||"",cover:g.game.cover,background:g.game.background,day:g.game.day??e.day??null,month:g.game.month??e.month??null,year:g.game.year??e.year??null,stars:g.game.stars??e.stars??null,genre:g.game.genre??e.genre??null,criticratings:g.game.criticratings??e.criticratings??null,userratings:g.game.userratings??e.userratings??null,themes:g.game.themes??e.themes??null,platforms:g.game.platforms??e.platforms??null,gameModes:g.game.gameModes??e.gameModes??null,playerPerspectives:g.game.playerPerspectives??e.playerPerspectives??null,websites:g.game.websites??e.websites??null,ageRatings:g.game.ageRatings??e.ageRatings??null,developers:g.game.developers??e.developers??null,publishers:g.game.publishers??e.publishers??null,franchise:g.game.franchise??e.franchise??null,collection:g.game.collection??e.collection??null,screenshots:g.game.screenshots??e.screenshots??null,videos:g.game.videos??e.videos??null,gameEngines:g.game.gameEngines??e.gameEngines??null,keywords:g.game.keywords??e.keywords??null,alternativeNames:g.game.alternativeNames??e.alternativeNames??null,similarGames:g.game.similarGames??e.similarGames??null};"command"in j&&delete j.command,o(j)}else console.error("Failed to unlink executable")}catch(i){console.error("Error unlinking executable:",i)}finally{u(!1),c(!1)}}}}function _e({onGameAdded:e,onError:o}={}){const{setLoading:l}=U(),[c,d]=m.useState(!1),[r,w]=m.useState(null);return{isAdding:c,addError:r,addGame:async t=>{const f=D();if(!f){const a="Authentication required";return w(a),o&&o(a),null}d(!0),w(null),l(!0);try{const a=M(L,"/games/add-from-igdb"),v=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-Auth-Token":f},body:JSON.stringify({igdbId:t.id,name:t.name,summary:t.summary,cover:t.cover,background:t.background,releaseDate:t.releaseDateFull?.timestamp||t.releaseDate,genres:t.genres,criticRating:t.criticRating,userRating:t.userRating,themes:t.themes,platforms:t.platforms,gameModes:t.gameModes,playerPerspectives:t.playerPerspectives,websites:t.websites,ageRatings:t.ageRatings,developers:t.developers,publishers:t.publishers,franchise:t.franchise,collection:t.collection,screenshots:t.screenshots,videos:t.videos,gameEngines:t.gameEngines,keywords:t.keywords,alternativeNames:t.alternativeNames,similarGames:t.similarGames})});if(!v.ok){const h=(await v.json().catch(()=>({}))).error||`HTTP ${v.status}`;return w(h),o&&o(h),null}const i=await v.json(),k=i.gameId||i.game?.id,g={id:String(k),title:i.game?.title||t.name,summary:i.game?.summary||t.summary||"",cover:i.game?.cover||t.cover||"",background:i.game?.background||t.background||void 0,day:i.game?.day||t.releaseDateFull?.day||null,month:i.game?.month||t.releaseDateFull?.month||null,year:i.game?.year||t.releaseDateFull?.year||t.releaseDate||null,stars:i.game?.stars||null,genre:i.game?.genre||t.genres||null,criticratings:i.game?.criticratings||(t.criticRating?t.criticRating/10:null),userratings:i.game?.userratings||(t.userRating?t.userRating/10:null),command:i.game?.command||null,themes:i.game?.themes||t.themes||null,platforms:i.game?.platforms||t.platforms||null,gameModes:i.game?.gameModes||t.gameModes||null,playerPerspectives:i.game?.playerPerspectives||t.playerPerspectives||null,websites:i.game?.websites||t.websites||null,ageRatings:i.game?.ageRatings||t.ageRatings||null,developers:i.game?.developers||t.developers||null,publishers:i.game?.publishers||t.publishers||null,franchise:i.game?.franchise||t.franchise||null,collection:i.game?.collection||t.collection||null,screenshots:i.game?.screenshots||t.screenshots||null,videos:i.game?.videos||t.videos||null,gameEngines:i.game?.gameEngines||t.gameEngines||null,keywords:i.game?.keywords||t.keywords||null,alternativeNames:i.game?.alternativeNames||t.alternativeNames||null,similarGames:i.game?.similarGames||t.similarGames||null};return window.dispatchEvent(new CustomEvent("gameAdded",{detail:{game:g}})),e&&e(g),g}catch(a){const v=a.message||"Failed to add game";return console.error("Error adding game:",a),w(v),o&&o(v),null}finally{d(!1),l(!1)}}}}function ge({onSuccess:e,onError:o}={}){const{t:l}=F(),{setLoading:c}=U(),[d,r]=m.useState(!1);return{isAdding:d,addGameToCollection:async(u,t)=>{const f=D();if(!f){o?.(l("common.unauthorized","Unauthorized"));return}r(!0),c(!0);try{const a=M(L,`/collections/${t}/games`),v=await fetch(a,{headers:{Accept:"application/json","X-Auth-Token":f}});if(!v.ok)throw new Error(`Failed to fetch collection games: ${v.status}`);const k=((await v.json()).games||[]).map(C=>String(C.id));if(k.includes(String(u))){o?.(l("collections.gameAlreadyInCollection","Game is already in this collection"));return}const g=[...k,String(u)],j=M(L,`/collections/${t}/games/order`),h=await fetch(j,{method:"PUT",headers:{"Content-Type":"application/json","X-Auth-Token":f},body:JSON.stringify({gameIds:g})});if(!h.ok){const C=await h.json().catch(()=>({}));throw new Error(C.error||`Failed to add game to collection: ${h.status}`)}const s=JSON.parse(localStorage.getItem("recentCollections")||"[]");if(!s.includes(t)){s.unshift(t);const C=s.slice(0,10);localStorage.setItem("recentCollections",JSON.stringify(C))}e?.()}catch(a){const v=String(a.message||a);console.error("Error adding game to collection:",v),o?.(v)}finally{r(!1),c(!1)}}}}function Pe({onSuccess:e,onError:o}={}){const{t:l}=F(),{setLoading:c}=U(),[d,r]=m.useState(!1);return{isRemoving:d,removeGameFromCollection:async(u,t)=>{const f=D();if(!f){o?.(l("common.unauthorized","Unauthorized"));return}r(!0),c(!0);try{const a=M(L,`/collections/${t}/games`),v=await fetch(a,{headers:{Accept:"application/json","X-Auth-Token":f}});if(!v.ok)throw new Error(`Failed to fetch collection games: ${v.status}`);const g=((await v.json()).games||[]).map(s=>String(s.id)).filter(s=>s!==String(u)),j=M(L,`/collections/${t}/games/order`),h=await fetch(j,{method:"PUT",headers:{"Content-Type":"application/json","X-Auth-Token":f},body:JSON.stringify({gameIds:g})});if(!h.ok){const s=await h.json().catch(()=>({}));throw new Error(s.error||`Failed to remove game from collection: ${h.status}`)}e?.()}catch(a){const v=String(a.message||a);console.error("Error removing game from collection:",v),o?.(v)}finally{r(!1),c(!1)}}}}function De({onSuccess:e,onError:o}={}){const{t:l}=F(),{setLoading:c}=U(),[d,r]=m.useState(!1);return{isCreating:d,createCollection:async(u,t)=>{const f=D();if(!f)return o?.(l("common.unauthorized","Unauthorized")),null;if(!u||u.trim()==="")return o?.(l("collections.titleRequired","Collection title is required")),null;r(!0),c(!0);try{const a=M(L,"/collections"),v=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json","X-Auth-Token":f},body:JSON.stringify({title:u.trim(),summary:t?.trim()||""})});if(!v.ok){const g=await v.json().catch(()=>({}));throw new Error(g.error||`Failed to create collection: ${v.status}`)}const i=await v.json(),k={id:i.collection.id,title:i.collection.title,summary:i.collection.summary,cover:i.collection.cover,gameCount:0};return window.dispatchEvent(new CustomEvent("collectionAdded",{detail:{collection:k}})),e?.(k),k}catch(a){const v=String(a.message||a);return console.error("Error creating collection:",v),o?.(v),null}finally{r(!1),c(!1)}}}}function we({text:e,delay:o=1e3,children:l}){const[c,d]=m.useState(!1),[r,w]=m.useState({}),u=m.useRef(null),t=m.useRef(null);m.useEffect(()=>()=>{t.current&&clearTimeout(t.current)},[]),m.useEffect(()=>{if(!c)return;const v=()=>{t.current&&(clearTimeout(t.current),t.current=null),d(!1)};return document.addEventListener("click",v,!0),()=>{document.removeEventListener("click",v,!0)}},[c]);const f=()=>{t.current&&clearTimeout(t.current),t.current=window.setTimeout(()=>{if(u.current){const v=u.current.getBoundingClientRect();w({position:"fixed",top:`${v.bottom+8}px`,left:`${v.left}px`,zIndex:99999}),d(!0)}},o)},a=()=>{t.current&&(clearTimeout(t.current),t.current=null),d(!1)};return n.jsxs(n.Fragment,{children:[n.jsx("div",{ref:u,className:"tooltip-wrapper",onMouseEnter:f,onMouseLeave:a,children:l}),c&&V.createPortal(n.jsx("span",{className:"tooltip tooltip-portal",style:r,children:e}),document.body)]})}function Ae({onEdit:e,onDelete:o,onReload:l,onAddToCollection:c,onRemoveFromCollection:d,gameId:r,gameTitle:w,gameCommand:u,onGameDelete:t,onGameUpdate:f,collectionId:a,collectionTitle:v,onCollectionDelete:i,onCollectionUpdate:k,className:g="",horizontal:j=!1,onModalOpen:h,onModalClose:s,toolTipDelay:C=0}){const{t:y}=F(),[x,p]=m.useState(!1),S=m.useRef(null),A=m.useRef(null),T=Ne({gameId:r,collectionId:a,onGameDelete:t,onCollectionDelete:i,onModalClose:s}),b=Le({gameId:r,collectionId:a,onGameUpdate:f,onCollectionUpdate:k,onReload:l,onModalClose:s}),P=r&&f?Me({gameId:r,onGameUpdate:f}):{isUnlinking:!1,handleUnlinkExecutable:async()=>{}},O=Pe({onSuccess:()=>{d&&d()},onError:E=>{console.error("Error removing game from collection:",E)}}),$=g.includes("games-list-dropdown-menu");m.useEffect(()=>{!x&&r?(window.dispatchEvent(new CustomEvent("closeAddToCollectionDropdown",{detail:{gameId:r}})),window.dispatchEvent(new CustomEvent("dropdownMenuClosed",{detail:{gameId:r}}))):!x&&a&&window.dispatchEvent(new CustomEvent("dropdownMenuClosed",{detail:{collectionId:a}}))},[x,r,a]),m.useEffect(()=>{if(!x)return;function E(se){const X=se.target;S.current&&S.current.contains(X)||A.current&&A.current.contains(X)||X.closest(".dropdown-menu-popup")||X.closest(".add-to-collection-dropdown-menu")||p(!1)}const R=setTimeout(()=>{document.addEventListener("mousedown",E,!0)},100);return()=>{clearTimeout(R),document.removeEventListener("mousedown",E,!0)}},[x]),m.useEffect(()=>(T.showConfirmModal||b.showReloadConfirmModal?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[T.showConfirmModal,b.showReloadConfirmModal]),m.useEffect(()=>{if(!T.showConfirmModal&&!b.showReloadConfirmModal)return;function E(R){R.key==="Escape"&&(T.showConfirmModal&&T.handleCancelDelete(),b.showReloadConfirmModal&&b.handleCancelReload())}return document.addEventListener("keydown",E),()=>{document.removeEventListener("keydown",E)}},[T.showConfirmModal,b.showReloadConfirmModal,T,b]);const W=E=>{E.stopPropagation();const R=!x;p(R),r?R?window.dispatchEvent(new CustomEvent("dropdownMenuOpened",{detail:{gameId:r}})):window.dispatchEvent(new CustomEvent("dropdownMenuClosed",{detail:{gameId:r}})):a&&(R?window.dispatchEvent(new CustomEvent("dropdownMenuOpened",{detail:{collectionId:a}})):window.dispatchEvent(new CustomEvent("dropdownMenuClosed",{detail:{collectionId:a}})))},B=E=>{E.stopPropagation(),p(!1),h&&h(),e&&e()},K=()=>{window.dispatchEvent(new CustomEvent("openAddToCollectionDropdown",{detail:{gameId:r}}))},ee=E=>{const R=E.relatedTarget;R&&!R.closest(".add-to-collection-dropdown-menu")&&window.dispatchEvent(new CustomEvent("closeAddToCollectionDropdown",{detail:{gameId:r}}))},te=()=>{window.dispatchEvent(new CustomEvent("closeAddToCollectionDropdown",{detail:{gameId:r}}))},Q=E=>{const R=E.relatedTarget;R&&!R.closest(".dropdown-menu-popup")&&!R.closest(".add-to-collection-dropdown-menu")&&window.dispatchEvent(new CustomEvent("closeAddToCollectionDropdown",{detail:{gameId:r}}))},ne=E=>{E.stopPropagation(),p(!1),r&&w||a&&v?(h&&h(),T.handleDeleteClick()):o&&o()},H=E=>{if(E.stopPropagation(),E.preventDefault(),p(!1),r||a){l?l():b.handleConfirmReload();return}setTimeout(()=>{h&&h(),b.handleReloadClick()},0)},oe=async E=>{E.stopPropagation(),p(!1),await P.handleUnlinkExecutable()},z=n.jsx("button",{onClick:W,className:"dropdown-menu-button","aria-label":"Menu",children:j?n.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[n.jsx("circle",{cx:"5",cy:"12",r:"1"}),n.jsx("circle",{cx:"12",cy:"12",r:"1"}),n.jsx("circle",{cx:"19",cy:"12",r:"1"})]}):n.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[n.jsx("circle",{cx:"12",cy:"5",r:"1"}),n.jsx("circle",{cx:"12",cy:"12",r:"1"}),n.jsx("circle",{cx:"12",cy:"19",r:"1"})]})});return n.jsxs("div",{className:`dropdown-menu-wrapper ${g}`,ref:S,children:[C>0?n.jsx(we,{text:y("common.more","More"),delay:C,children:z}):z,x&&(()=>{const E=n.jsxs("div",{ref:A,className:"dropdown-menu-popup",onMouseLeave:Q,style:$&&S.current?(()=>{const R=S.current.getBoundingClientRect();return{position:"fixed",bottom:`${window.innerHeight-R.top+4}px`,right:`${window.innerWidth-R.right}px`,top:"auto"}})():void 0,children:[c&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"dropdown-menu-item dropdown-menu-item-with-submenu",onMouseEnter:K,onMouseLeave:ee,children:[n.jsx("span",{children:y("collections.addTo","Add to")}),n.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:n.jsx("polyline",{points:"9 18 15 12 9 6"})})]}),!(d&&r&&a)&&(e||l||r&&f||!r&&!a&&!e&&!o||r&&u&&f||o||D()&&(r||a))&&n.jsx("div",{className:"dropdown-menu-divider",onMouseEnter:te})]}),d&&r&&a&&n.jsx("button",{onClick:async R=>{R.stopPropagation(),p(!1),await O.removeGameFromCollection(r,a)},className:"dropdown-menu-item dropdown-menu-item-danger",disabled:O.isRemoving,children:n.jsx("span",{children:O.isRemoving?y("common.removing","Removing..."):y("collections.removeFromCollection","Remove from collection")})}),d&&r&&a&&(e||l||r&&f||!r&&!a&&!e&&!o||r&&u&&f||o||D()&&(r||a))&&n.jsx("div",{className:"dropdown-menu-divider"}),e&&n.jsx("button",{onClick:B,className:"dropdown-menu-item",children:n.jsx("span",{children:y("common.edit","Edit")})}),(l||r&&f||!r&&!a&&!e&&!o)&&n.jsx("button",{onClick:H,className:"dropdown-menu-item",disabled:b.isReloading,children:n.jsx("span",{children:r?y("common.reloadSingleMetadata","Reload metadata"):y("common.reloadMetadata","Reload all metadata")})}),r&&u&&f&&n.jsx("button",{onClick:oe,className:"dropdown-menu-item",disabled:P.isUnlinking,children:n.jsx("span",{children:y("gameDetail.unlinkExecutable","Unlink Executable")})}),(o||D()&&(r||a))&&n.jsx("button",{onClick:ne,className:"dropdown-menu-item dropdown-menu-item-danger",children:n.jsx("span",{children:y("common.delete","Delete")})})]});return $?V.createPortal(E,document.body):E})(),b.showReloadConfirmModal&&V.createPortal(n.jsx("div",{className:"dropdown-menu-confirm-overlay",onClick:b.handleCancelReload,children:n.jsxs("div",{className:"dropdown-menu-confirm-container",onClick:E=>E.stopPropagation(),children:[n.jsxs("div",{className:"dropdown-menu-confirm-header",children:[n.jsxs("h2",{children:[n.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",style:{marginRight:"8px",verticalAlign:"middle"},children:[n.jsx("path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"}),n.jsx("path",{d:"M21 3v5h-5"}),n.jsx("path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"}),n.jsx("path",{d:"M3 21v-5h5"})]}),y("common.reloadMetadata","Reload all metadata")]}),n.jsx("button",{className:"dropdown-menu-confirm-close",onClick:b.handleCancelReload,"aria-label":"Close",children:"×"})]}),n.jsxs("div",{className:"dropdown-menu-confirm-content",children:[n.jsx("p",{children:y("common.confirmReload","Are you sure you want to reload all metadata? This will refresh all games, collections, and categories.")}),b.reloadError&&n.jsx("div",{className:"dropdown-menu-confirm-error",children:b.reloadError})]}),n.jsxs("div",{className:"dropdown-menu-confirm-footer",children:[n.jsx("button",{className:"dropdown-menu-confirm-cancel",onClick:b.handleCancelReload,disabled:b.isReloading,children:y("common.cancel","Cancel")}),n.jsx("button",{className:"dropdown-menu-confirm-reload",onClick:b.handleConfirmReload,disabled:b.isReloading,children:b.isReloading?y("common.reloading","Reloading..."):y("common.reloadMetadata","Reload all metadata")})]})]})}),document.body),T.showConfirmModal&&V.createPortal(n.jsx("div",{className:"dropdown-menu-confirm-overlay",onClick:T.handleCancelDelete,children:n.jsxs("div",{className:"dropdown-menu-confirm-container",onClick:E=>E.stopPropagation(),children:[n.jsxs("div",{className:"dropdown-menu-confirm-header",children:[n.jsxs("h2",{children:[n.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",style:{marginRight:"8px",verticalAlign:"middle"},children:[n.jsx("path",{d:"M3 6h18"}),n.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"}),n.jsx("path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})]}),y("common.deleteTitle","Delete")]}),n.jsx("button",{className:"dropdown-menu-confirm-close",onClick:T.handleCancelDelete,"aria-label":"Close",children:"×"})]}),n.jsxs("div",{className:"dropdown-menu-confirm-content",children:[n.jsx("p",{children:y("common.confirmDelete",{title:w||v||""})}),T.deleteError&&n.jsx("div",{className:"dropdown-menu-confirm-error",children:T.deleteError})]}),n.jsxs("div",{className:"dropdown-menu-confirm-footer",children:[n.jsx("button",{className:"dropdown-menu-confirm-cancel",onClick:T.handleCancelDelete,disabled:T.isDeleting,children:y("common.cancel","Cancel")}),n.jsx("button",{className:"dropdown-menu-confirm-delete",onClick:T.handleConfirmDelete,disabled:T.isDeleting,children:T.isDeleting?y("common.deleting","Deleting..."):y("common.delete","Delete")})]})]})}),document.body)]})}function $e({isOpen:e,onClose:o,game:l,allCollections:c,onCollectionAdded:d}){const{t:r}=F(),[w,u]=m.useState(""),[t,f]=m.useState(l.title),[a,v]=m.useState(c),i=m.useRef(null),k=ge({onSuccess:()=>{d?.(),o()}}),g=De({onSuccess:async s=>{s&&await k.addGameToCollection(l.id,s.id)}});m.useEffect(()=>(e?(f(l.title),u(""),document.body.style.overflow="hidden",setTimeout(()=>{i.current&&(i.current.focus(),i.current.select())},0)):document.body.style.overflow="",()=>{document.body.style.overflow=""}),[e,l.title]),m.useEffect(()=>{if(!w.trim())v(c);else{const s=w.toLowerCase();v(c.filter(C=>C.title.toLowerCase().includes(s)))}},[w,c]);const j=async s=>{await k.addGameToCollection(l.id,s)},h=async()=>{t.trim()&&await g.createCollection(t.trim())};return e?V.createPortal(n.jsx("div",{className:"add-to-collection-modal-overlay",onClick:o,children:n.jsxs("div",{className:"add-to-collection-modal",onClick:s=>s.stopPropagation(),children:[n.jsxs("div",{className:"add-to-collection-modal-header",children:[n.jsx("h2",{children:r("collections.addToCollection","Add to Collection")}),n.jsx("button",{className:"add-to-collection-modal-close",onClick:o,children:"×"})]}),n.jsx("div",{className:"add-to-collection-modal-search",children:n.jsx("input",{type:"text",placeholder:r("collections.searchCollections","Search collections..."),value:w,onChange:s=>u(s.target.value),autoFocus:!0})}),n.jsx("div",{className:"add-to-collection-modal-collections",children:a.length>0?a.map(s=>n.jsxs("div",{className:"add-to-collection-modal-collection-item",onClick:()=>j(s.id),children:[n.jsx("div",{className:"add-to-collection-modal-collection-title",children:s.title}),s.gameCount!==void 0&&n.jsxs("div",{className:"add-to-collection-modal-collection-count",children:[s.gameCount," ",r("collections.games","games")]})]},s.id)):n.jsx("div",{className:"add-to-collection-modal-empty",children:r("collections.noCollectionsFound","No collections found")})}),n.jsxs("div",{className:"add-to-collection-modal-create",children:[n.jsx("input",{ref:i,type:"text",placeholder:r("collections.newCollectionTitle","New collection title"),value:t,onChange:s=>f(s.target.value),onFocus:s=>{s.target.value&&s.target.select()},onKeyDown:s=>{s.key==="Enter"&&h()}}),n.jsx("button",{onClick:h,disabled:!t.trim()||g.isCreating,className:"add-to-collection-modal-create-button",children:g.isCreating?r("common.creating","Creating..."):r("common.create","Create")})]})]})}),document.body):null}function Fe({game:e,allCollections:o,onCollectionAdded:l}){const{t:c}=F(),[d,r]=m.useState(!1),[w,u]=m.useState(!1),[t,f]=m.useState([]),[a,v]=m.useState(!1),i=m.useRef(null),k=ge({onSuccess:()=>{l?.(),r(!1)}});m.useEffect(()=>{const h=C=>{C.detail?.gameId===e.id&&!w&&r(!0)},s=C=>{const y=C;(!y.detail?.gameId||y.detail.gameId===e.id)&&!w&&r(!1)};return window.addEventListener("openAddToCollectionDropdown",h),window.addEventListener("closeAddToCollectionDropdown",s),()=>{window.removeEventListener("openAddToCollectionDropdown",h),window.removeEventListener("closeAddToCollectionDropdown",s)}},[e.id,w]),m.useEffect(()=>{const s=JSON.parse(localStorage.getItem("recentCollections")||"[]").map(C=>o.find(y=>y.id===C)).filter(C=>C!==void 0).slice(0,5);f(s)},[o]),m.useEffect(()=>{if(!d||!i.current){v(!1);return}v(!1);const h=()=>{const x=document.querySelector(".dropdown-menu-item-with-submenu");if(!x)return;const p=i.current?.querySelector(".add-to-collection-dropdown-menu");if(!p)return;const S=x.getBoundingClientRect(),A=0,T=window.innerWidth,b=window.innerHeight,P=8,O=p.offsetWidth||200,$=p.offsetHeight||100;let W=S.right+A;W+O+P>T&&(W=S.left-O-A),W<P&&(W=P);let B=S.top;B+$+P>b&&(B=S.bottom-$,B+$+P>b&&(B=b-$-P)),B<P&&(B=P),p.style.top=`${B}px`,p.style.left=`${W}px`,v(!0)};requestAnimationFrame(()=>{requestAnimationFrame(h)});const s=()=>{h()},C=()=>{h()};window.addEventListener("resize",s),window.addEventListener("scroll",C,!0);function y(x){const p=x.target;i.current&&!i.current.contains(p)&&!p.closest(".dropdown-menu-item-with-submenu")&&!p.closest(".dropdown-menu-popup")&&r(!1)}return i.current&&i.current.addEventListener("mouseleave",y),()=>{window.removeEventListener("resize",s),window.removeEventListener("scroll",C,!0),i.current&&i.current.removeEventListener("mouseleave",y)}},[d]);const g=async(h,s)=>{h.stopPropagation(),h.preventDefault(),r(!1),await k.addGameToCollection(e.id,s)},j=h=>{h.stopPropagation(),h.preventDefault(),r(!1),setTimeout(()=>{u(!0)},50)};return n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"add-to-collection-dropdown",ref:i,children:d&&n.jsxs("div",{className:"add-to-collection-dropdown-menu",style:{opacity:a?1:0,pointerEvents:a?"auto":"none"},onMouseEnter:()=>r(!0),onMouseLeave:h=>{const s=h.relatedTarget;(!s||!s.closest(".add-to-collection-dropdown-menu")&&!s.closest(".dropdown-menu-item-with-submenu")&&!s.closest(".dropdown-menu-popup"))&&setTimeout(()=>{const C=document.querySelector(".dropdown-menu-item-with-submenu"),y=i.current?.querySelector(".add-to-collection-dropdown-menu");if(C&&y){const x=C.getBoundingClientRect(),p=y.getBoundingClientRect(),S=h.clientX,A=h.clientY,T=S>=x.left&&S<=x.right&&A>=x.top&&A<=x.bottom,b=S>=p.left&&S<=p.right&&A>=p.top&&A<=p.bottom;!T&&!b&&r(!1)}else r(!1)},200)},onClick:h=>{h.stopPropagation()},children:[n.jsx("div",{className:"add-to-collection-dropdown-item",onClick:j,children:c("collections.addToCollection","Add to Collection...")}),t.length>0&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"add-to-collection-dropdown-divider"}),n.jsx("div",{className:"add-to-collection-dropdown-section-title",children:c("collections.recent","RECENT")}),t.map(h=>n.jsx("div",{className:"add-to-collection-dropdown-item",onClick:s=>g(s,h.id),children:h.title},h.id))]})]})}),n.jsx($e,{isOpen:w,onClose:()=>u(!1),game:e,allCollections:o,onCollectionAdded:l})]})}function Oe({title:e,coverUrl:o,width:l,height:c,onPlay:d,onClick:r,onEdit:w,onDelete:u,gameId:t,gameTitle:f,game:a,onGameDelete:v,onGameUpdate:i,collectionId:k,collectionTitle:g,onCollectionDelete:j,onCollectionUpdate:h,onRemoveFromCollection:s,showTitle:C=!1,subtitle:y,detail:x=!0,play:p=!0,showBorder:S=!0,aspectRatio:A="3/4",overlayContent:T,titlePosition:b="bottom",editButtonPosition:P="bottom-left",onUpload:O,uploading:$=!1,allCollections:W=[],showRemoveButton:B=!1,removeMediaType:K,removeResourceId:ee,removeResourceType:te,onRemoveSuccess:Q,removeDisabled:ne=!1}){const{t:H}=F(),[oe,z]=m.useState(!1),[E,R]=m.useState(!1),[se,X]=m.useState(!1),re=m.useRef(null),le=!o||oe;m.useEffect(()=>{z(!1)},[o]),m.useEffect(()=>{if(!t&&!k)return;const N=Z=>{const q=Z;(t&&q.detail?.gameId===t||k&&q.detail?.collectionId===k)&&R(!0)},_=Z=>{const q=Z;(t&&q.detail?.gameId===t||k&&q.detail?.collectionId===k)&&R(!1)};return window.addEventListener("dropdownMenuOpened",N),window.addEventListener("dropdownMenuClosed",_),()=>{window.removeEventListener("dropdownMenuOpened",N),window.removeEventListener("dropdownMenuClosed",_)}},[t,k]),m.useEffect(()=>{const N=()=>{if(!re.current)return;const q=re.current.querySelectorAll(".games-list-play-button, .games-list-upload-button, .games-list-edit-button");if(q.length===0){X(!1);return}const je=document.querySelectorAll(".dropdown-menu-popup, .add-to-collection-dropdown-menu");let ue=!1;q.forEach(Ee=>{const G=Ee.getBoundingClientRect();je.forEach(me=>{const ae=window.getComputedStyle(me);if(ae.display==="none"||ae.opacity==="0"||ae.visibility==="hidden")return;const I=me.getBoundingClientRect();!(I.right<G.left||I.left>G.right||I.bottom<G.top||I.top>G.bottom)&&(ue=!0)})}),X(ue)};N();const _=setInterval(N,100);return window.addEventListener("scroll",N,!0),window.addEventListener("resize",N),()=>{clearInterval(_),window.removeEventListener("scroll",N,!0),window.removeEventListener("resize",N)}},[E]);let Y=Math.max(10,Math.min(16,Math.floor(l/8)));A==="16/9"&&b==="overlay"&&(Y=Math.max(14,Math.min(24,Math.floor(l/5))));const ie=Math.max(4,Math.floor(l/20)),ce=Math.max(2,Math.floor(c/(Y*1.5))),ve=N=>{p&&!x&&d?(N.stopPropagation(),d()):x&&r&&(N.stopPropagation(),r())},ye=N=>{N.stopPropagation(),d&&d()},xe=N=>{N.stopPropagation(),w&&w()},de=N=>{N.stopPropagation(),O&&!$&&O()},Ce=p&&d&&!O,J=O!==void 0,ke=x||p||J;return n.jsxs(n.Fragment,{children:[n.jsxs("div",{ref:re,className:`games-list-cover relative bg-[#2a2a2a] rounded overflow-hidden transition-all ${S?"cover-hover-effect":""} ${p?"games-list-cover-play":""} ${x?"games-list-cover-detail":""} ${J?"games-list-cover-upload":""} ${E?"cover-dropdown-open":""} ${se?"cover-popup-overlay":""}`,style:{width:`${l}px`,aspectRatio:A,cursor:ke&&!J||J?"pointer":"default"},onClick:J?de:ve,children:[le?n.jsx("div",{className:"cover-placeholder",style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#2a2a2a",border:"1px solid rgba(255, 255, 255, 0.2)",boxSizing:"border-box"},children:n.jsx("div",{className:"cover-placeholder-text",style:{padding:`${ie}px`,fontSize:`${Y}px`,textAlign:"center",color:"rgba(255, 255, 255, 0.85)",fontWeight:600,lineHeight:1.3,wordBreak:"break-word",overflow:"hidden",display:"-webkit-box",WebkitLineClamp:ce,WebkitBoxOrient:"vertical",width:"100%",maxHeight:"100%"},children:e})}):n.jsx("img",{src:o,alt:e,className:"object-cover w-full h-full",loading:o.startsWith("data:")?void 0:"lazy",onError:()=>{z(!0)},onLoad:()=>{z(!1)}},o||"cover-image"),Ce&&n.jsx("button",{onClick:ye,className:`games-list-play-button ${x?"games-list-play-button-detail":"games-list-play-button-play-only"}`,"aria-label":H("common.play"),children:n.jsx("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:n.jsx("path",{d:"M8 5v14l11-7z",fill:"currentColor"})})}),J&&n.jsx("button",{onClick:de,className:`games-list-upload-button ${x?"games-list-upload-button-detail":"games-list-upload-button-upload-only"}`,"aria-label":H("gameDetail.uploadCover","Upload Cover"),disabled:$,children:$?n.jsx("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"spinning",style:{animation:"spin 1s linear infinite"},children:n.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"2",fill:"none",strokeDasharray:"31.416",strokeDashoffset:"31.416",strokeLinecap:"round"})}):n.jsx("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:n.jsx("path",{d:"M12 5v14M5 12h14",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),w&&n.jsx("button",{onClick:xe,className:`games-list-edit-button ${P==="bottom-right"?"games-list-edit-button-bottom-right":""}`,"aria-label":H("common.edit","Edit"),children:n.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[n.jsx("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),n.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]})}),w&&t&&a&&n.jsx("div",{className:"games-list-dropdown-wrapper games-list-dropdown-wrapper-bottom-right",children:n.jsx(Fe,{game:a,allCollections:W})}),w&&n.jsx("div",{className:"games-list-dropdown-wrapper games-list-dropdown-wrapper-bottom-right",children:n.jsx(Ae,{onDelete:u,gameId:t,gameTitle:f,onAddToCollection:t&&a?()=>{}:void 0,onRemoveFromCollection:s,onGameDelete:v,onGameUpdate:i,collectionId:k,collectionTitle:g,onCollectionDelete:j,onCollectionUpdate:h,className:"games-list-dropdown-menu"})}),B&&K&&ee&&te&&n.jsx("button",{className:"cover-remove-media-button",onClick:N=>{N.stopPropagation(),Q&&Q()},disabled:ne||$,title:K==="cover"?H("gameDetail.removeCover","Remove cover"):H("gameDetail.removeBackground","Remove background")}),T&&n.jsx("div",{className:"cover-overlay-content",children:T}),b==="overlay"&&C&&!le&&n.jsx("div",{className:"cover-overlay-content",style:{display:"flex",alignItems:"center",justifyContent:"center",padding:`${ie}px`},children:n.jsx("div",{style:{textAlign:"center",color:"rgba(255, 255, 255, 0.95)",fontWeight:600,fontSize:`${Y}px`,lineHeight:1.3,wordBreak:"break-word",overflow:"hidden",display:"-webkit-box",WebkitLineClamp:ce,WebkitBoxOrient:"vertical",textShadow:"2px 2px 4px rgba(0, 0, 0, 0.8)"},children:e})})]}),(C||y!=null)&&b==="bottom"&&n.jsxs("div",{className:"games-list-title-wrapper",children:[C&&n.jsx(we,{text:e,position:"bottom",children:n.jsx("div",{className:`truncate games-list-title ${x?"games-list-title-clickable":""}`,onClick:x&&r?N=>{N.stopPropagation(),r()}:void 0,children:e})}),y!=null&&n.jsx("div",{className:"games-list-year",children:y})]})]})}function he(e){try{const o=sessionStorage.getItem(e);return o?parseInt(o,10):0}catch{return 0}}function fe(e,o){try{sessionStorage.setItem(e,o.toString())}catch{}}function We(e,o){const l=be(),c=m.useRef(!1),d=o?`${l.pathname}:${o}`:l.pathname;m.useLayoutEffect(()=>{if(!e.current){const f=setTimeout(()=>{const a=e.current;if(a){const v=he(d);v>0&&(a.scrollTop=v)}},200);return()=>clearTimeout(f)}c.current=!0;const w=he(d);if(w<=0){c.current=!1;return}const u=(f=0)=>{const a=e.current;if(!a){f<30?setTimeout(()=>u(f+1),50):c.current=!1;return}const i=o==="table"?a.querySelector("tbody tr"):!0;if(!(a.scrollHeight>a.clientHeight)||!i){f<100?f<20?requestAnimationFrame(()=>u(f+1)):setTimeout(()=>u(f+1),50):c.current=!1;return}a.scrollTop=w,f<10?setTimeout(()=>{const g=a.scrollTop;Math.abs(g-w)>10?(a.scrollTop=w,u(f+1)):c.current=!1},100):c.current=!1},t=setTimeout(()=>{u()},150);return()=>{clearTimeout(t),c.current=!1}},[l.pathname,d,e,o]),m.useEffect(()=>{const r=e.current;if(!r)return;const w=()=>{if(c.current)return;const u=r.scrollTop;u>0&&fe(d,u)};return r.addEventListener("scroll",w,{passive:!0}),()=>{r.removeEventListener("scroll",w);const u=r.scrollTop;u>0&&!c.current&&fe(d,u)}},[l.pathname,d,e,o])}function Be({category:e,coverSize:o,itemRefs:l}){const{t:c}=F(),d=Te(),r=o*(9/16),w=()=>{d(`/category/${e.id}`)};return n.jsx("div",{ref:u=>{u&&l?.current&&l.current.set(e.id,u)},className:"group cursor-pointer categories-list-item",style:{width:`${o}px`,minWidth:`${o}px`},onClick:w,children:n.jsx(Oe,{title:c(`genre.${e.title}`,e.title),coverUrl:Se(L,e.cover),width:o,height:r,onClick:w,showTitle:!0,titlePosition:"overlay",detail:!0,play:!1,showBorder:!0,aspectRatio:"16/9"})},e.id)}function Ue({categories:e,coverSize:o=150,itemRefs:l}){const{t:c}=F();return e.length===0?n.jsx("div",{className:"text-gray-400 text-center",children:c("table.noGames")}):n.jsx("div",{className:"categories-list-container",style:{gridTemplateColumns:`repeat(auto-fill, ${o}px)`},children:e.map(d=>n.jsx(Be,{category:d,coverSize:o,itemRefs:l},d.id))})}function Ze({coverSize:e}){const{setLoading:o,isLoading:l}=U(),[c,d]=m.useState([]),[r,w]=m.useState([]),[u,t]=m.useState([]),[f,a]=m.useState(!1),v=m.useRef(null),i=m.useRef(new Map);We(v),m.useEffect(()=>{k(),g()},[]),m.useEffect(()=>{const j=()=>{k(),g()};return window.addEventListener("metadataReloaded",j),()=>{window.removeEventListener("metadataReloaded",j)}},[]),m.useEffect(()=>{if(u.length===0||c.length===0){w([]);return}const j=new Set;u.forEach(s=>{s.genre&&(Array.isArray(s.genre)?s.genre.forEach(C=>j.add(C)):typeof s.genre=="string"&&j.add(s.genre))});const h=c.filter(s=>j.has(s.title));w(h)},[u,c]),m.useLayoutEffect(()=>{!l&&(r.length>0||c.length>0&&u.length>0)?requestAnimationFrame(()=>{requestAnimationFrame(()=>{a(!0)})}):l&&a(!1)},[l,r.length,c.length,u.length]);async function k(){try{const j=M(L,"/categories"),h=await fetch(j,{headers:{Accept:"application/json","X-Auth-Token":D()}});if(!h.ok)throw new Error(`HTTP ${h.status}`);const y=((await h.json()).categories||[]).map(x=>({id:x,title:x,cover:`/category-covers/${encodeURIComponent(x)}`}));d(y)}catch(j){const h=String(j.message||j);console.error("Error fetching categories:",h)}}async function g(){o(!0);try{const j=M(L,"/libraries/library/games",{sort:"title"}),h=await fetch(j,{headers:{Accept:"application/json","X-Auth-Token":D()}});if(!h.ok)throw new Error(`HTTP ${h.status}`);const y=((await h.json()).games||[]).map(x=>({id:x.id,title:x.title,summary:x.summary,cover:x.cover,day:x.day,month:x.month,year:x.year,stars:x.stars,genre:x.genre}));t(y)}catch(j){const h=String(j.message||j);console.error("Error fetching library games:",h)}finally{o(!1)}}return n.jsx("main",{className:"flex-1 home-page-content",children:n.jsx("div",{className:"home-page-layout",children:n.jsx("div",{className:"home-page-content-wrapper",style:{opacity:f?1:0,transition:"opacity 0.2s ease-in-out"},children:n.jsx("div",{ref:v,className:"home-page-scroll-container",children:!l&&n.jsx(Ue,{categories:r,coverSize:e*2,itemRefs:i})})})})})}export{Fe as A,Oe as C,Ae as D,Qe as L,we as T,Ke as a,M as b,We as c,Se as d,Ve as e,Je as f,Ze as g,_e as h,Ye as i,U as u};
