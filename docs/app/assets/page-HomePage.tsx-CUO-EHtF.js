import{r as m,j as s}from"./react-vendor-jNdKP8wU.js";import{e as z,a as O,L as T}from"./page-CollectionDetail.tsx-DYxPNzRb.js";import{L as Y}from"./page-LibraryPage.tsx-DmbzbHGd.js";import{R as B}from"./page-RecommendedPage.tsx-CX7VJ9kL.js";import{C as G}from"./page-CollectionsPage.tsx-CqznnysS.js";import{T as y}from"./page-TagListRoutePage.tsx-DXsnzAAl.js";import{g as F,A as x}from"./page-AddGamePage.tsx-CGFUTWrs.js";/* empty css                          */const A=["recommended","library","collections","categories"],N=["platforms","themes","gameEngines","gameModes","playerPerspectives"],H=[...A,...N],J={recommended:"games",library:"games",collections:"collections",categories:"games",platforms:"games",themes:"games",gameEngines:"games",gameModes:"games",playerPerspectives:"games"};function $(g){const n=new Set(A);return Array.isArray(g)&&g.forEach(t=>{typeof t=="string"&&t.trim()&&n.add(t)}),H.filter(t=>n.has(t))}function D(g){return g.map(n=>({key:n,type:J[n]||"games"}))}function se({onGameClick:g,onGamesLoaded:n,onPlay:t,onReloadMetadata:I,allCollections:S=[]}){const{isLoading:E}=z(),[c,R]=m.useState([]),[r,L]=m.useState(null),[w,u]=m.useState(null),[a,M]=m.useState(()=>{const e=localStorage.getItem("coverSize");return e?parseInt(e,10):150}),[v,f]=m.useState("grid"),C=(e,i)=>{localStorage.setItem(`viewMode_${e}`,i)},h=e=>localStorage.getItem(`viewMode_${e}`)||"grid",P=e=>{f(e),r&&r.key==="library"&&C(r.key,e)},V=e=>{M(e),localStorage.setItem("coverSize",e.toString())};m.useEffect(()=>{K()},[]),m.useEffect(()=>{if(c.length===0)return;const e=localStorage.getItem("lastSelectedLibrary"),o=(r?c.some(l=>l.key===r.key):!1)?r:e&&c.find(l=>l.key===e)||c[0];if((!r||r.key!==o?.key)&&L(o),o?.key&&localStorage.setItem("lastSelectedLibrary",o.key),o?.key==="library"){const l=h(o.key);f(l)}else f("grid")},[c,r]);async function K(){u(null);try{let e=null;const i=F();if(x&&i)try{const d=new URL("/settings",x),b=await fetch(d.toString(),{headers:O({Accept:"application/json"})});if(b.ok){const p=await b.json();Array.isArray(p.visibleLibraries)&&(e=p.visibleLibraries,localStorage.setItem("visibleLibraries",JSON.stringify(p.visibleLibraries)))}}catch(d){console.warn("Failed to load visible libraries from settings:",d)}if(!e){const d=localStorage.getItem("visibleLibraries");if(d)try{const b=JSON.parse(d);Array.isArray(b)&&(e=b)}catch{e=null}}const o=$(e||[]),l=D(o);R(l)}catch(e){const i=String(e.message||e);u(i)}}function _(e){if(localStorage.setItem("lastSelectedLibrary",e.key),L(e),e.key==="library"){const i=h(e.key);f(i)}else f("grid")}function k(e){g(e)}function j(e){n(e)}return s.jsxs(s.Fragment,{children:[s.jsx(T,{libraries:c,activeLibrary:r,onSelectLibrary:_,loading:E,error:w,coverSize:a,onCoverSizeChange:V,viewMode:v,onViewModeChange:P,onReloadMetadata:I}),s.jsx("div",{className:"bg-[#1a1a1a] home-page-main-container",children:r?s.jsxs(s.Fragment,{children:[r.key==="library"&&s.jsx(Y,{onGameClick:k,onGamesLoaded:j,onPlay:t,coverSize:a,viewMode:v,allCollections:S}),r.key==="recommended"&&s.jsx(B,{onGameClick:k,onGamesLoaded:j,onPlay:t,coverSize:a,allCollections:S}),r.key==="collections"&&s.jsx(G,{onPlay:t,coverSize:a}),r.key==="categories"&&s.jsx(y,{coverSize:a,tagKey:"categories"}),r.key==="platforms"&&s.jsx(y,{coverSize:a,tagKey:"platforms"}),r.key==="themes"&&s.jsx(y,{coverSize:a,tagKey:"themes"}),r.key==="gameEngines"&&s.jsx(y,{coverSize:a,tagKey:"gameEngines"}),r.key==="gameModes"&&s.jsx(y,{coverSize:a,tagKey:"gameModes"}),r.key==="playerPerspectives"&&s.jsx(y,{coverSize:a,tagKey:"playerPerspectives"})]}):s.jsx("div",{className:"flex items-center justify-center h-full"})})]})}export{A as C,se as H,N as O,$ as n};
