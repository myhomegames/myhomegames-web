import{r as x,j as e,u as F,c as L}from"./react-vendor-jNdKP8wU.js";import{a as O,C as T,d as $,D as B,b as _,c as q}from"./page-CategoriesPage.tsx-UEkNxXUO.js";import{E as W,u as z}from"./page-CategoryPage.tsx-CkrIduET.js";import{f as H,A,g as K}from"./page-AddGamePage.tsx-lJZ2PP1m.js";import{E as V}from"./page-CollectionDetail.tsx-aYxxjzsd.js";import{a as X}from"./page-CollectionsPage.tsx-DS74qzQw.js";import{u as P}from"./i18n-vendor-mPXi0JFR.js";/* empty css                                   */const Z=100,M=60;function Q({item:t,onGameClick:b,variant:g="page",coverSize:r,onPlay:d,onCollectionClick:E,hasBorder:R=!1,onEditClick:v,onGameDelete:u,onGameUpdate:f,onCollectionDelete:y,onCollectionUpdate:j,onModalOpen:l,onModalClose:w}){const{t:h,i18n:k}=P(),N=F(),c="year"in t,S=r||(g==="popup"?M:Z),n=S*1.5,a=g==="popup",{hasPlayableGame:i}=X(c?void 0:t.id,!c),o=()=>{c?b(t):E?E(t):N(`/collections/${t.id}`)},I=async s=>{if(s.stopPropagation(),!!d)if(c)d(t);else try{const m=_(A,`/collections/${t.id}/games`),U=await fetch(m,{headers:{Accept:"application/json","X-Auth-Token":K()}});if(U.ok){const p=((await U.json()).games||[]).find(D=>!!D.command);if(p){const D={id:p.id,title:p.title,summary:p.summary||"",cover:p.cover,day:p.day||null,month:p.month||null,year:p.year||null,stars:p.stars||null,genre:p.genre||null,command:p.command||null};d(D)}}}catch(m){console.error("Error fetching collection games for play:",m)}},G=s=>{a&&(s.key==="Enter"||s.key===" ")&&(s.preventDefault(),o())},C=c?H(t,h,k):h("search.collection");return e.jsxs("div",{className:`group cursor-pointer ${a?`mhg-dropdown-item search-dropdown-item ${R?"has-border":""}`:"mb-6 search-results-list-item"}`,onClick:o,onKeyDown:G,role:a?"button":void 0,tabIndex:a?0:void 0,style:a?{display:"flex",alignItems:"center",gap:"16px"}:void 0,children:[e.jsx(T,{title:t.title,coverUrl:$(A,t.cover,!0),width:S,height:n,onClick:o,showTitle:!0,subtitle:C,titlePosition:"bottom",detail:!0,play:!1,showBorder:!1},`${t.id}-${t.cover}`),(d||v)&&e.jsxs("div",{className:"search-result-right-actions",children:[d&&(c?t.command:i===!0)&&e.jsx("button",{className:"search-result-play-button",onClick:I,"aria-label":c?"Play game":"Play collection",children:e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M8 5v14l11-7z",fill:"currentColor"})})}),v&&e.jsx("div",{className:"search-result-actions",children:e.jsx(B,{onEdit:()=>v(t),gameId:c?t.id:void 0,gameTitle:c?t.title:void 0,onGameDelete:c&&u?s=>{t.id===s&&u(t)}:void 0,onGameUpdate:c&&f?s=>{s.id===t.id&&f(s)}:void 0,collectionId:c?void 0:t.id,collectionTitle:c?void 0:t.title,onCollectionDelete:!c&&y?s=>{t.id===s&&y(t)}:void 0,onCollectionUpdate:!c&&j?s=>{const m={id:s.id,title:s.title,summary:s.summary,cover:s.cover,gameCount:"gameCount"in t?t.gameCount:void 0};m.id===t.id&&j(m)}:void 0,className:"search-result-dropdown-menu",onModalOpen:l,onModalClose:w})})]})]},t.id)}function J({games:t,collections:b,onGameClick:g,variant:r="page",coverSize:d,onPlay:E,onCollectionClick:R,onGameUpdate:v,onGameDelete:u,onCollectionUpdate:f,onCollectionDelete:y,onModalOpen:j,onModalClose:l}){const{t:w}=P(),h=O(),[k,N]=x.useState(!1),[c,S]=x.useState(null);if(t.length+b.length===0)return e.jsx("div",{className:"text-gray-400 text-center",children:w("table.noGames")});const a=r==="popup",i=a?"":"search-results-list-container",o=[...b,...t],I=s=>{if(j&&j(),"year"in s)h.openEditModal(s);else{const m={id:s.id,title:s.title,summary:s.summary,cover:s.cover,background:s.background};S(m),N(!0)}},G=s=>{window.dispatchEvent(new CustomEvent("gameUpdated",{detail:{game:s}})),v&&v(s),h.closeEditModal(),l&&l()},C=s=>{const m={id:s.id,title:s.title,summary:s.summary,cover:s.cover,background:s.background};window.dispatchEvent(new CustomEvent("collectionUpdated",{detail:{collection:m}})),f&&f(m),N(!1),S(null),l&&l()};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:i,children:o.map((s,m)=>e.jsx(Q,{item:s,onGameClick:g,variant:r,coverSize:d,onPlay:E,onCollectionClick:R,hasBorder:a&&m<o.length-1,onEditClick:I,onGameDelete:u,onGameUpdate:v,onCollectionDelete:y,onCollectionUpdate:f,onModalOpen:j,onModalClose:l},s.id))}),h.selectedGame&&e.jsx(W,{isOpen:h.isEditModalOpen,onClose:()=>{h.closeEditModal(),l&&l()},game:h.selectedGame,onGameUpdate:G}),c&&e.jsx(V,{isOpen:k,onClose:()=>{N(!1),S(null),l&&l()},collection:c,onCollectionUpdate:C})]})}function oe({onGameClick:t,onPlay:b}){const{t:g}=P(),r=L(),d=F(),E=x.useRef(null),[R,v]=x.useState(!1),[u,f]=x.useState([]),[y,j]=x.useState([]);q(E);const{searchQuery:l,games:w,collections:h}=r.state||{};x.useLayoutEffect(()=>{w&&f(w),h&&j(h)},[w,h]),z({setGames:f,enabledEvents:["gameUpdated","gameDeleted"]}),x.useLayoutEffect(()=>{if(r.state&&typeof r.state=="object"&&u.length>0){const n=r.state,a=n.games||[];(a.length!==u.length||a.some((i,o)=>String(i.id)!==String(u[o]?.id)||i.title!==u[o]?.title))&&d(r.pathname,{state:{...n,games:u},replace:!0})}},[u,r.pathname,d]);const k=n=>{if(f(a=>a.map(i=>String(i.id)===String(n.id)?n:i)),r.state&&typeof r.state=="object"){const a=r.state,i=(a.games||[]).map(o=>String(o.id)===String(n.id)?n:o);d(r.pathname,{state:{...a,games:i},replace:!0})}},N=n=>{if(f(a=>a.filter(i=>String(i.id)!==String(n.id))),r.state&&typeof r.state=="object"){const a=r.state,i=(a.games||[]).filter(o=>String(o.id)!==String(n.id));d(r.pathname,{state:{...a,games:i},replace:!0})}},c=n=>{if(j(a=>a.map(i=>i.id===n.id?n:i)),r.state&&typeof r.state=="object"){const a=r.state,i=(a.collections||[]).map(o=>o.id===n.id?n:o);d(r.pathname,{state:{...a,collections:i},replace:!0})}};if(x.useLayoutEffect(()=>{const n=sessionStorage.getItem("gameDetailFrom");!l&&n&&n!=="/search-results"&&(sessionStorage.removeItem("gameDetailFrom"),d(n,{replace:!0}))},[l,d]),x.useLayoutEffect(()=>{u.length>0||y.length>0?requestAnimationFrame(()=>{requestAnimationFrame(()=>{v(!0)})}):v(!1)},[u,y]),!l||l.trim().length<2)return e.jsx("div",{className:"bg-[#1a1a1a] text-white flex items-center justify-center search-results-page-empty",children:e.jsx("div",{className:"text-center",children:e.jsx("div",{className:"text-gray-400",children:l?g("search.minimumCharacters","Please enter at least 2 characters to search"):g("searchResults.noResults")})})});const S=u.length+y.length;return S===0?e.jsxs("div",{className:"bg-[#1a1a1a] text-white search-results-page",children:[e.jsx("div",{className:"search-results-header",children:e.jsx("div",{className:"search-results-header-content",children:e.jsx("div",{className:"search-results-title",children:g("searchResults.title",{query:l})})})}),e.jsx("div",{className:"search-results-content",children:e.jsx("div",{className:"search-results-content-inner",children:e.jsxs("div",{className:"search-results-empty",children:[e.jsx("div",{className:"search-results-empty-icon",children:e.jsxs("svg",{width:"80",height:"80",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("circle",{cx:"11",cy:"11",r:"8",stroke:"#E5A00D",strokeWidth:"2.5",fill:"none"}),e.jsx("path",{d:"m20 20-4.5-4.5",stroke:"#000000",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round"})]})}),e.jsx("div",{className:"search-results-empty-message",children:g("searchResults.noResultsFound")}),e.jsx("div",{className:"search-results-empty-hint",children:g("searchResults.tryModifyingSearch")})]})})})]}):e.jsxs("div",{className:"bg-[#1a1a1a] text-white search-results-page",style:{opacity:R?1:0,transition:"opacity 0.2s ease-in-out"},children:[e.jsx("div",{className:"search-results-header",children:e.jsxs("div",{className:"search-results-header-content",children:[e.jsx("div",{className:"search-results-title",children:g("searchResults.title",{query:l})}),e.jsx("div",{className:"search-results-count",children:g("searchResults.foundGames",{count:S})})]})}),e.jsx("div",{ref:E,className:"search-results-content",children:e.jsx("div",{className:"search-results-content-inner",children:e.jsx(J,{games:u,collections:y,onGameClick:t,onPlay:b,onGameUpdate:k,onGameDelete:N,onCollectionUpdate:c})})})]})}export{J as S,oe as a};
