import{r as v,j as e,u as F,c as L}from"./react-vendor-jNdKP8wU.js";import{f as O,C as T,h as $,g as B,D as _,b as q,e as W}from"./page-CategoriesPage.tsx-PfePlHQa.js";import{h as z,u as H}from"./page-CategoryPage.tsx-Ct3nuy93.js";import{f as K,A as P,g as V}from"./page-AddGamePage.tsx-SkGFkz5J.js";import{E as X}from"./page-CollectionDetail.tsx-DfNjLps5.js";import{u as Z}from"./page-CollectionsPage.tsx-BnhxjTPW.js";import{u as A}from"./i18n-vendor-mPXi0JFR.js";/* empty css                                   */const M=100,Q=60;function J({item:s,onGameClick:N,variant:g="page",coverSize:r,onPlay:o,onCollectionClick:E,hasBorder:R=!1,onEditClick:x,onGameDelete:u,onGameUpdate:f,onCollectionDelete:j,onCollectionUpdate:y,onModalOpen:i,onModalClose:S}){const{t:h,i18n:k}=A(),w=F(),c="year"in s,b=r||(g==="popup"?Q:M),l=b*1.5,a=g==="popup",{hasPlayableGame:n}=Z(c?void 0:s.id,!c),d=()=>{c?N(s):E?E(s):w(`/collections/${s.id}`)},G=async t=>{if(t.stopPropagation(),!!o)if(c)o(s);else try{const m=q(P,`/collections/${s.id}/games`),U=await fetch(m,{headers:{Accept:"application/json","X-Auth-Token":V()}});if(U.ok){const p=((await U.json()).games||[]).find(I=>I.executables&&I.executables.length>0);if(p){const I={id:p.id,title:p.title,summary:p.summary||"",cover:p.cover,day:p.day||null,month:p.month||null,year:p.year||null,stars:p.stars||null,genre:p.genre||null,executables:p.executables||null};o(I)}}}catch(m){console.error("Error fetching collection games for play:",m)}},D=t=>{a&&(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),d())},C=c?K(s,h,k):h("search.collection");return e.jsxs("div",{className:`group cursor-pointer ${a?`mhg-dropdown-item search-dropdown-item ${R?"has-border":""}`:"mb-6 search-results-list-item"}`,onClick:d,onKeyDown:D,role:a?"button":void 0,tabIndex:a?0:void 0,style:a?{display:"flex",alignItems:"center",gap:"16px"}:void 0,children:[e.jsx(T,{title:s.title,coverUrl:$(P,s.cover,!0),width:b,height:l,onClick:d,showTitle:!0,subtitle:C,titlePosition:"bottom",detail:!0,play:!1,showBorder:!1},`${s.id}-${s.cover}`),(o||x)&&e.jsxs("div",{className:"search-result-right-actions",children:[o&&(c?s.executables&&s.executables.length>0:n===!0)&&e.jsx("button",{className:"search-result-play-button",onClick:G,"aria-label":c?"Play game":"Play collection",children:e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M8 5v14l11-7z",fill:"currentColor"})})}),x&&e.jsxs("div",{className:"search-result-actions",children:[c&&s.executables&&s.executables.length>1&&o&&e.jsx(B,{gameId:s.id,gameExecutables:s.executables,onPlayExecutable:t=>{o&&o(s,t)}}),e.jsx(_,{onEdit:()=>x(s),gameId:c?s.id:void 0,gameTitle:c?s.title:void 0,gameExecutables:c?s.executables:void 0,onGameDelete:c&&u?t=>{s.id===t&&u(s)}:void 0,onGameUpdate:c&&f?t=>{t.id===s.id&&f(t)}:void 0,collectionId:c?void 0:s.id,collectionTitle:c?void 0:s.title,onCollectionDelete:!c&&j?t=>{s.id===t&&j(s)}:void 0,onCollectionUpdate:!c&&y?t=>{const m={id:t.id,title:t.title,summary:t.summary,cover:t.cover,gameCount:"gameCount"in s?s.gameCount:void 0};m.id===s.id&&y(m)}:void 0,className:"search-result-dropdown-menu",onModalOpen:i,onModalClose:S})]})]})]},s.id)}function Y({games:s,collections:N,onGameClick:g,variant:r="page",coverSize:o,onPlay:E,onCollectionClick:R,onGameUpdate:x,onGameDelete:u,onCollectionUpdate:f,onCollectionDelete:j,onModalOpen:y,onModalClose:i}){const{t:S}=A(),h=O(),[k,w]=v.useState(!1),[c,b]=v.useState(null);if(s.length+N.length===0)return e.jsx("div",{className:"text-gray-400 text-center",children:S("table.noGames")});const a=r==="popup",n=a?"":"search-results-list-container",d=[...N,...s],G=t=>{if(y&&y(),"year"in t)h.openEditModal(t);else{const m={id:t.id,title:t.title,summary:t.summary,cover:t.cover,background:t.background};b(m),w(!0)}},D=t=>{window.dispatchEvent(new CustomEvent("gameUpdated",{detail:{game:t}})),x&&x(t),h.closeEditModal(),i&&i()},C=t=>{const m={id:t.id,title:t.title,summary:t.summary,cover:t.cover,background:t.background};window.dispatchEvent(new CustomEvent("collectionUpdated",{detail:{collection:m}})),f&&f(m),w(!1),b(null),i&&i()};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:n,children:d.map((t,m)=>e.jsx(J,{item:t,onGameClick:g,variant:r,coverSize:o,onPlay:E,onCollectionClick:R,hasBorder:a&&m<d.length-1,onEditClick:G,onGameDelete:u,onGameUpdate:x,onCollectionDelete:j,onCollectionUpdate:f,onModalOpen:y,onModalClose:i},t.id))}),h.selectedGame&&e.jsx(z,{isOpen:h.isEditModalOpen,onClose:()=>{h.closeEditModal(),i&&i()},game:h.selectedGame,onGameUpdate:D}),c&&e.jsx(X,{isOpen:k,onClose:()=>{w(!1),b(null),i&&i()},collection:c,onCollectionUpdate:C})]})}function de({onGameClick:s,onPlay:N}){const{t:g}=A(),r=L(),o=F(),E=v.useRef(null),[R,x]=v.useState(!1),[u,f]=v.useState([]),[j,y]=v.useState([]);W(E);const{searchQuery:i,games:S,collections:h}=r.state||{};v.useLayoutEffect(()=>{S&&f(S),h&&y(h)},[S,h]),H({setGames:f,enabledEvents:["gameUpdated","gameDeleted"]}),v.useLayoutEffect(()=>{if(r.state&&typeof r.state=="object"&&u.length>0){const l=r.state,a=l.games||[];(a.length!==u.length||a.some((n,d)=>String(n.id)!==String(u[d]?.id)||n.title!==u[d]?.title))&&o(r.pathname,{state:{...l,games:u},replace:!0})}},[u,r.pathname,o]);const k=l=>{if(f(a=>a.map(n=>String(n.id)===String(l.id)?l:n)),r.state&&typeof r.state=="object"){const a=r.state,n=(a.games||[]).map(d=>String(d.id)===String(l.id)?l:d);o(r.pathname,{state:{...a,games:n},replace:!0})}},w=l=>{if(f(a=>a.filter(n=>String(n.id)!==String(l.id))),r.state&&typeof r.state=="object"){const a=r.state,n=(a.games||[]).filter(d=>String(d.id)!==String(l.id));o(r.pathname,{state:{...a,games:n},replace:!0})}},c=l=>{if(y(a=>a.map(n=>n.id===l.id?l:n)),r.state&&typeof r.state=="object"){const a=r.state,n=(a.collections||[]).map(d=>d.id===l.id?l:d);o(r.pathname,{state:{...a,collections:n},replace:!0})}};if(v.useLayoutEffect(()=>{const l=sessionStorage.getItem("gameDetailFrom");!i&&l&&l!=="/search-results"&&(sessionStorage.removeItem("gameDetailFrom"),o(l,{replace:!0}))},[i,o]),v.useLayoutEffect(()=>{u.length>0||j.length>0?requestAnimationFrame(()=>{requestAnimationFrame(()=>{x(!0)})}):x(!1)},[u,j]),!i||i.trim().length<2)return e.jsx("div",{className:"bg-[#1a1a1a] text-white flex items-center justify-center search-results-page-empty",children:e.jsx("div",{className:"text-center",children:e.jsx("div",{className:"text-gray-400",children:i?g("search.minimumCharacters","Please enter at least 2 characters to search"):g("searchResults.noResults")})})});const b=u.length+j.length;return b===0?e.jsxs("div",{className:"bg-[#1a1a1a] text-white search-results-page",children:[e.jsx("div",{className:"search-results-header",children:e.jsx("div",{className:"search-results-header-content",children:e.jsx("div",{className:"search-results-title",children:g("searchResults.title",{query:i})})})}),e.jsx("div",{className:"search-results-content",children:e.jsx("div",{className:"search-results-content-inner",children:e.jsxs("div",{className:"search-results-empty",children:[e.jsx("div",{className:"search-results-empty-icon",children:e.jsxs("svg",{width:"80",height:"80",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("circle",{cx:"11",cy:"11",r:"8",stroke:"#E5A00D",strokeWidth:"2.5",fill:"none"}),e.jsx("path",{d:"m20 20-4.5-4.5",stroke:"#000000",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round"})]})}),e.jsx("div",{className:"search-results-empty-message",children:g("searchResults.noResultsFound")}),e.jsx("div",{className:"search-results-empty-hint",children:g("searchResults.tryModifyingSearch")})]})})})]}):e.jsxs("div",{className:"bg-[#1a1a1a] text-white search-results-page",style:{opacity:R?1:0,transition:"opacity 0.2s ease-in-out"},children:[e.jsx("div",{className:"search-results-header",children:e.jsxs("div",{className:"search-results-header-content",children:[e.jsx("div",{className:"search-results-title",children:g("searchResults.title",{query:i})}),e.jsx("div",{className:"search-results-count",children:g("searchResults.foundGames",{count:b})})]})}),e.jsx("div",{ref:E,className:"search-results-content",children:e.jsx("div",{className:"search-results-content-inner",children:e.jsx(Y,{games:u,collections:j,onGameClick:s,onPlay:N,onGameUpdate:k,onGameDelete:w,onCollectionUpdate:c})})})]})}export{Y as S,de as a};
