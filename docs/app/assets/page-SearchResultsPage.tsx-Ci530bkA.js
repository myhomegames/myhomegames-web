import{r as f,j as t,u as T,c as _}from"./react-vendor-jNdKP8wU.js";import{m as q,p as W,v as z,l as H,d as K,s as V,D as X,h as Z,b as M}from"./page-CollectionsPage.tsx-DjVo-48O.js";import{E as Q,u as J}from"./page-LibraryItemDetailPage.tsx-C5nrov_b.js";import{d as Y,A as B,g as ee}from"./page-AddGamePage.tsx-CGFUTWrs.js";import{u as O}from"./i18n-vendor-mPXi0JFR.js";/* empty css                                   */const se=100,te=60;function ae({item:s,resultType:h,onGameClick:v,variant:a="page",coverSize:x,onPlay:m,onCollectionClick:D,onDeveloperClick:k,onPublisherClick:d,hasBorder:S=!1,onEditClick:E,onGameDelete:R,onGameUpdate:o,onCollectionDelete:G,onCollectionUpdate:w,onModalOpen:U,onModalClose:b}){const{t:N,i18n:p}=O(),I=T(),r=h==="game",g=h==="collection",C=x||(a==="popup"?te:se),A=C*1.5,j=a==="popup",{hasPlayableGame:i}=z(g?s.id:void 0,g),l=()=>{h==="game"?v(s):h==="collection"?D?D(s):I(`/collections/${s.id}`):h==="developer"?k?k(s):I(`/developers/${s.id}`):h==="publisher"&&(d?d(s):I(`/publishers/${s.id}`))},n=async e=>{if(e.stopPropagation(),!!m){if(r)m(s);else if(g)try{const c=Z(B,`/collections/${s.id}/games`),L=await fetch(c,{headers:{Accept:"application/json","X-Auth-Token":ee()}});if(L.ok){const y=((await L.json()).games||[]).find(P=>P.executables&&P.executables.length>0);if(y){const P={id:y.id,title:y.title,summary:y.summary||"",cover:y.cover,day:y.day||null,month:y.month||null,year:y.year||null,stars:y.stars||null,genre:y.genre||null,executables:y.executables||null};m(P)}}}catch(c){console.error("Error fetching collection games for play:",c)}}},u=e=>{j&&(e.key==="Enter"||e.key===" ")&&(e.preventDefault(),l())},$=r?Y(s,N,p):N(h==="developer"?"search.developer":h==="publisher"?"search.publisher":"search.collection");return t.jsxs("div",{className:`group cursor-pointer ${j?`mhg-dropdown-item search-dropdown-item ${S?"has-border":""}`:"mb-6 search-results-list-item"}`,onClick:l,onKeyDown:u,role:j?"button":void 0,tabIndex:j?0:void 0,style:j?{display:"flex",alignItems:"center",gap:"16px"}:void 0,children:[t.jsx(H,{title:s.title,coverUrl:K(B,s.cover,!0),width:C,height:A,onClick:l,showTitle:s.showTitle!==!1,subtitle:$,titlePosition:"bottom",detail:!0,play:!1,showBorder:!1},`${s.id}-${s.cover}`),(m||E)&&t.jsxs("div",{className:"search-result-right-actions",onClick:e=>e.stopPropagation(),children:[m&&(r?s.executables&&s.executables.length>0:i===!0)&&t.jsx("button",{className:"search-result-play-button",onClick:n,"aria-label":r?"Play game":"Play collection",children:t.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:t.jsx("path",{d:"M8 5v14l11-7z",fill:"currentColor"})})}),E&&t.jsxs("div",{className:"search-result-actions",onClick:e=>e.stopPropagation(),children:[r&&s.executables&&s.executables.length>1&&m&&t.jsx(V,{gameId:s.id,gameExecutables:s.executables,onPlayExecutable:e=>{m&&m(s,e)}}),t.jsx(X,{onEdit:()=>E(s),gameId:r?s.id:void 0,gameTitle:r?s.title:void 0,gameExecutables:r?s.executables:void 0,onGameDelete:r&&R?e=>{s.id===e&&R(s)}:void 0,onGameUpdate:r&&o?e=>{e.id===s.id&&o(e)}:void 0,collectionId:r?void 0:s.id,collectionTitle:r?void 0:s.title,onCollectionDelete:!r&&G?e=>{s.id===e&&G(s)}:void 0,onCollectionUpdate:!r&&w?e=>{const c={id:e.id,title:e.title,summary:e.summary,cover:e.cover,gameCount:"gameCount"in s?s.gameCount:void 0};c.id===s.id&&w(c)}:void 0,className:"search-result-dropdown-menu",onModalOpen:U,onModalClose:b})]})]})]},s.id)}function le({games:s,collections:h,onGameClick:v,variant:a="page",coverSize:x,onPlay:m,onCollectionClick:D,onGameUpdate:k,onGameDelete:d,onCollectionUpdate:S,onCollectionDelete:E,onModalOpen:R,onModalClose:o,developers:G=[],publishers:w=[],onDeveloperClick:U,onPublisherClick:b}){const{t:N}=O(),p=q(),[I,r]=f.useState(!1),[g,C]=f.useState(null);if(s.length+h.length+G.length+w.length===0)return t.jsx("div",{className:"text-gray-400 text-center",children:N("table.noGames")});const j=a==="popup",i=j?"":"search-results-list-container",l=[...h.map(e=>({item:e,resultType:"collection"})),...s.map(e=>({item:e,resultType:"game"})),...G.map(e=>({item:e,resultType:"developer"})),...w.map(e=>({item:e,resultType:"publisher"}))],n=(e,c)=>{if(R&&R(),c==="game")p.openEditModal(e);else if(c==="collection"||c==="developer"||c==="publisher"){const L={id:e.id,title:e.title,summary:e.summary,cover:e.cover,background:e.background};C({item:L,resourceType:c==="collection"?"collections":c==="developer"?"developers":"publishers"}),r(!0)}},u=e=>{window.dispatchEvent(new CustomEvent("gameUpdated",{detail:{game:e}})),k&&k(e),p.closeEditModal(),o&&o()},$=e=>{const c={id:e.id,title:e.title,summary:e.summary,cover:e.cover,background:e.background};g?.resourceType==="collections"?(window.dispatchEvent(new CustomEvent("collectionUpdated",{detail:{collection:c}})),S&&S(c)):g?.resourceType==="developers"?window.dispatchEvent(new CustomEvent("developerUpdated",{detail:{developer:c}})):g?.resourceType==="publishers"&&window.dispatchEvent(new CustomEvent("publisherUpdated",{detail:{publisher:c}})),r(!1),C(null),o&&o()};return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:i,children:l.map(({item:e,resultType:c},L)=>t.jsx(ae,{item:e,resultType:c,onGameClick:v,variant:a,coverSize:x,onPlay:m,onCollectionClick:D,onDeveloperClick:U,onPublisherClick:b,hasBorder:j&&L<l.length-1,onEditClick:F=>n(F,c),onGameDelete:d,onGameUpdate:k,onCollectionDelete:E,onCollectionUpdate:S,onModalOpen:R,onModalClose:o},`${c}-${e.id}`))}),p.selectedGame&&t.jsx(Q,{isOpen:p.isEditModalOpen,onClose:()=>{p.closeEditModal(),o&&o()},game:p.selectedGame,onGameUpdate:u}),g&&t.jsx(W,{isOpen:I,onClose:()=>{r(!1),C(null),o&&o()},resourceType:g.resourceType,item:g.item,onItemUpdate:$})]})}function he({onGameClick:s,onPlay:h}){const{t:v}=O(),a=_(),x=T(),m=f.useRef(null),[D,k]=f.useState(!1),[d,S]=f.useState([]),[E,R]=f.useState([]),[o,G]=f.useState([]),[w,U]=f.useState([]);M(m);const{searchQuery:b,games:N,collections:p,developers:I,publishers:r}=a.state||{};f.useLayoutEffect(()=>{N&&S(N),p&&R(p),I&&G(I),r&&U(r)},[N,p,I,r]),J({setGames:S,enabledEvents:["gameUpdated","gameDeleted"]}),f.useLayoutEffect(()=>{if(a.state&&typeof a.state=="object"&&d.length>0){const i=a.state,l=i.games||[];(l.length!==d.length||l.some((n,u)=>String(n.id)!==String(d[u]?.id)||n.title!==d[u]?.title))&&x(a.pathname,{state:{...i,games:d},replace:!0})}},[d,a.pathname,x]);const g=i=>{if(S(l=>l.map(n=>String(n.id)===String(i.id)?i:n)),a.state&&typeof a.state=="object"){const l=a.state,n=(l.games||[]).map(u=>String(u.id)===String(i.id)?i:u);x(a.pathname,{state:{...l,games:n},replace:!0})}},C=i=>{if(S(l=>l.filter(n=>String(n.id)!==String(i.id))),a.state&&typeof a.state=="object"){const l=a.state,n=(l.games||[]).filter(u=>String(u.id)!==String(i.id));x(a.pathname,{state:{...l,games:n},replace:!0})}},A=i=>{if(R(l=>l.map(n=>n.id===i.id?i:n)),a.state&&typeof a.state=="object"){const l=a.state,n=(l.collections||[]).map(u=>u.id===i.id?i:u);x(a.pathname,{state:{...l,collections:n},replace:!0})}};if(f.useLayoutEffect(()=>{const i=sessionStorage.getItem("gameDetailFrom");!b&&i&&i!=="/search-results"&&(sessionStorage.removeItem("gameDetailFrom"),x(i,{replace:!0}))},[b,x]),f.useLayoutEffect(()=>{d.length>0||E.length>0||o.length>0||w.length>0?requestAnimationFrame(()=>{requestAnimationFrame(()=>{k(!0)})}):k(!1)},[d,E,o,w]),!b||b.trim().length<2)return t.jsx("div",{className:"bg-[#1a1a1a] text-white flex items-center justify-center search-results-page-empty",children:t.jsx("div",{className:"text-center",children:t.jsx("div",{className:"text-gray-400",children:b?v("search.minimumCharacters","Please enter at least 2 characters to search"):v("searchResults.noResults")})})});const j=d.length+E.length+o.length+w.length;return j===0?t.jsxs("div",{className:"bg-[#1a1a1a] text-white search-results-page",children:[t.jsx("div",{className:"search-results-header",children:t.jsx("div",{className:"search-results-header-content",children:t.jsx("div",{className:"search-results-title",children:v("searchResults.title",{query:b})})})}),t.jsx("div",{className:"search-results-content",children:t.jsx("div",{className:"search-results-content-inner",children:t.jsxs("div",{className:"search-results-empty",children:[t.jsx("div",{className:"search-results-empty-icon",children:t.jsxs("svg",{width:"80",height:"80",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[t.jsx("circle",{cx:"11",cy:"11",r:"8",stroke:"#E5A00D",strokeWidth:"2.5",fill:"none"}),t.jsx("path",{d:"m20 20-4.5-4.5",stroke:"#000000",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round"})]})}),t.jsx("div",{className:"search-results-empty-message",children:v("searchResults.noResultsFound")}),t.jsx("div",{className:"search-results-empty-hint",children:v("searchResults.tryModifyingSearch")})]})})})]}):t.jsxs("div",{className:"bg-[#1a1a1a] text-white search-results-page",style:{opacity:D?1:0,transition:"opacity 0.2s ease-in-out"},children:[t.jsx("div",{className:"search-results-header",children:t.jsxs("div",{className:"search-results-header-content",children:[t.jsx("div",{className:"search-results-title",children:v("searchResults.title",{query:b})}),t.jsx("div",{className:"search-results-count",children:v("searchResults.foundGames",{count:j})})]})}),t.jsx("div",{ref:m,className:"search-results-content",children:t.jsx("div",{className:"search-results-content-inner",children:t.jsx(le,{games:d,collections:E,developers:o,publishers:w,onGameClick:s,onPlay:h,onGameUpdate:g,onGameDelete:C,onCollectionUpdate:A})})})]})}export{le as S,he as a};
