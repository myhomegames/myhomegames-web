import{r as m,j as n,b as V,c as be,u as Re}from"./react-vendor-COHXxlBx.js";import{g as A,A as L}from"./page-AddGamePage.tsx-kNlLaymQ.js";import{u as F}from"./i18n-vendor-ClaDN9Oc.js";function M(t,o,i={}){const c=new URL(o,t);return Object.entries(i).forEach(([d,r])=>c.searchParams.set(d,String(r))),c.toString()}function Se(t,o,i){if(!o)return"";if(o.startsWith("http://")||o.startsWith("https://"))return o;if(o.includes("?t=")||o.includes("&t=")){const r=o.split("?")[0],w=o.includes("?")?o.substring(o.indexOf("?")):"",u=new URL(r,t);return w&&new URLSearchParams(w).forEach((f,a)=>{u.searchParams.set(a,f)}),u.toString()}const d=new URL(o,t);return i&&d.searchParams.set("t",Date.now().toString()),d.toString()}function Xe(t,o,i){if(!o)return"";if(o.startsWith("http://")||o.startsWith("https://"))return o;if(o.includes("?t=")||o.includes("&t=")){const r=o.split("?")[0],w=o.includes("?")?o.substring(o.indexOf("?")):"",u=new URL(r,t);return w&&new URLSearchParams(w).forEach((f,a)=>{u.searchParams.set(a,f)}),u.toString()}const d=new URL(o,t);return i&&d.searchParams.set("t",Date.now().toString()),d.toString()}function Je(){const[t,o]=m.useState(!1),[i,c]=m.useState(null);return{isEditModalOpen:t,selectedGame:i,openEditModal:w=>{c(w),o(!0)},closeEditModal:()=>{o(!1),c(null)}}}const pe=m.createContext(void 0);function Ve({children:t}){const[o,i]=m.useState(!1),c=m.useCallback(r=>{i(r)},[]),d=m.useMemo(()=>({isLoading:o,setLoading:c}),[o,c]);return n.jsx(pe.Provider,{value:d,children:t})}function U(){const t=m.useContext(pe);if(t===void 0)throw new Error("useLoading must be used within a LoadingProvider");return t}function Te({gameId:t,collectionId:o,onGameDelete:i,onCollectionDelete:c,onModalClose:d}){const{t:r}=F(),{setLoading:w}=U(),[u,e]=m.useState(!1),[f,a]=m.useState(null),[v,l]=m.useState(!1);return{isDeleting:u,deleteError:f,showConfirmModal:v,handleDeleteClick:()=>{l(!0)},handleConfirmDelete:async()=>{const h=A();if(h){e(!0),a(null),w(!0);try{let s;if(t)s=M(L,`/games/${t}`);else if(o)s=M(L,`/collections/${o}`);else return;(await fetch(s,{method:"DELETE",headers:{"X-Auth-Token":h}})).ok?(t&&i?i(t):o&&c&&c(o),t?window.dispatchEvent(new CustomEvent("gameDeleted",{detail:{gameId:t}})):o&&window.dispatchEvent(new CustomEvent("collectionDeleted",{detail:{collectionId:o}})),l(!1),d&&d()):a(r("common.deleteError"))}catch(s){console.error("Error deleting item:",s),a(r("common.deleteError"))}finally{e(!1),w(!1)}}},handleCancelDelete:()=>{l(!1),a(null),d&&d()}}}function Ne({gameId:t,collectionId:o,onGameUpdate:i,onCollectionUpdate:c,onReload:d,onModalClose:r}){const{t:w}=F(),{setLoading:u}=U(),[e,f]=m.useState(!1),[a,v]=m.useState(null),[l,k]=m.useState(!1),g=async()=>{const C=A();if(C){f(!0),v(null),u(!0);try{let y;t?y=M(L,`/games/${t}/reload`):o?y=M(L,`/collections/${o}/reload`):y=M(L,"/reload-games");const x=await fetch(y,{method:"POST",headers:{"X-Auth-Token":C}});if(x.ok){const p=await x.json();if(t)if(i&&p.game){const T={id:p.game.id,title:p.game.title,summary:p.game.summary||"",cover:p.game.cover,background:p.game.background,day:p.game.day||null,month:p.game.month||null,year:p.game.year||null,stars:p.game.stars||null,genre:p.game.genre||null,command:p.game.command||null,criticratings:p.game.criticratings||null,userratings:p.game.userratings||null,themes:p.game.themes||null,platforms:p.game.platforms||null,gameModes:p.game.gameModes||null,playerPerspectives:p.game.playerPerspectives||null,websites:p.game.websites||null,ageRatings:p.game.ageRatings||null,developers:p.game.developers||null,publishers:p.game.publishers||null,franchise:p.game.franchise||null,collection:p.game.collection||null,screenshots:p.game.screenshots||null,videos:p.game.videos||null,gameEngines:p.game.gameEngines||null,keywords:p.game.keywords||null,alternativeNames:p.game.alternativeNames||null,similarGames:p.game.similarGames||null};i(T),f(!1),u(!1);return}else{f(!1),u(!1);return}else if(o)if(c&&p.collection){const T={id:p.collection.id,title:p.collection.title,summary:p.collection.summary||"",cover:p.collection.cover,background:p.collection.background};c(T),f(!1),u(!1);return}else{f(!1),u(!1);return}else if(d)await d(),f(!1),u(!1);else{const T=window.location.pathname;window.location.href=T}}else console.error("Failed to reload metadata"),v(w("common.reloadError","Failed to reload metadata")),f(!1),u(!1)}catch(y){console.error("Error reloading metadata:",y),v(w("common.reloadError","Failed to reload metadata")),f(!1),u(!1)}}};return{isReloading:e,reloadError:a,showReloadConfirmModal:l,handleReloadClick:()=>{k(!0)},handleConfirmReload:async()=>{d?d():await g(),k(!1)},handleCancelReload:()=>{k(!1),v(null),r&&r()}}}function Le({gameId:t,onGameUpdate:o}){const{setLoading:i}=U(),[c,d]=m.useState(!1);return{isUnlinking:c,handleUnlinkExecutable:async()=>{d(!0),i(!0);try{const w=M(L,`/games/${t}`),u=await fetch(w,{method:"PUT",headers:{"Content-Type":"application/json","X-Auth-Token":A()},body:JSON.stringify({command:null})});if(u.ok){const e=await u.json(),f={id:e.game.id,title:e.game.title,summary:e.game.summary||"",cover:e.game.cover,background:e.game.background,day:e.game.day??null,month:e.game.month??null,year:e.game.year??null,stars:e.game.stars??null,genre:e.game.genre??null,criticratings:e.game.criticratings??null,userratings:e.game.userratings??null,themes:e.game.themes??null,platforms:e.game.platforms??null,gameModes:e.game.gameModes??null,playerPerspectives:e.game.playerPerspectives??null,websites:e.game.websites??null,ageRatings:e.game.ageRatings??null,developers:e.game.developers??null,publishers:e.game.publishers??null,franchise:e.game.franchise??null,collection:e.game.collection??null,screenshots:e.game.screenshots??null,videos:e.game.videos??null,gameEngines:e.game.gameEngines??null,keywords:e.game.keywords??null,alternativeNames:e.game.alternativeNames??null,similarGames:e.game.similarGames??null};"command"in f&&delete f.command,o(f)}else console.error("Failed to unlink executable")}catch(w){console.error("Error unlinking executable:",w)}finally{d(!1),i(!1)}}}}function Ke({game:t,onGameUpdate:o}){const{t:i}=F(),{setLoading:c}=U(),[d,r]=m.useState(!1),[w,u]=m.useState(!1),e=m.useRef(null);return{isUploading:d,isUnlinking:w,fileInputRef:e,handleFileSelect:async l=>{const k=l.name.toLowerCase();if(!k.endsWith(".sh")&&!k.endsWith(".bat")){alert(i("gameDetail.invalidFileType","Only .sh and .bat files are allowed"));return}r(!0),c(!0);try{const g=new FormData;g.append("file",l);const j=M(L,`/games/${t.id}/upload-executable`),h=await fetch(j,{method:"POST",headers:{"X-Auth-Token":A()||""},body:g});if(!h.ok){const C=await h.json().catch(()=>({error:"Failed to upload file"}));throw new Error(C.error||"Failed to upload file")}const s=await h.json();if(s.game){const C={...t,id:s.game.id,title:s.game.title,summary:s.game.summary||"",cover:s.game.cover,background:s.game.background,day:s.game.day??t.day??null,month:s.game.month??t.month??null,year:s.game.year??t.year??null,stars:s.game.stars??t.stars??null,genre:s.game.genre??t.genre??null,criticratings:s.game.criticratings??t.criticratings??null,userratings:s.game.userratings??t.userratings??null,command:s.game.command??t.command??null,themes:s.game.themes??t.themes??null,platforms:s.game.platforms??t.platforms??null,gameModes:s.game.gameModes??t.gameModes??null,playerPerspectives:s.game.playerPerspectives??t.playerPerspectives??null,websites:s.game.websites??t.websites??null,ageRatings:s.game.ageRatings??t.ageRatings??null,developers:s.game.developers??t.developers??null,publishers:s.game.publishers??t.publishers??null,franchise:s.game.franchise??t.franchise??null,collection:s.game.collection??t.collection??null,screenshots:s.game.screenshots??t.screenshots??null,videos:s.game.videos??t.videos??null,gameEngines:s.game.gameEngines??t.gameEngines??null,keywords:s.game.keywords??t.keywords??null,alternativeNames:s.game.alternativeNames??t.alternativeNames??null,similarGames:s.game.similarGames??t.similarGames??null};o(C)}}catch(g){console.error("Error uploading file:",g),alert(g.message||i("common.error","Error"))}finally{r(!1),c(!1)}},handleBrowseClick:()=>{e.current?.click()},handleUnlinkExecutable:async()=>{u(!0),c(!0);try{const l=M(L,`/games/${t.id}`),k=await fetch(l,{method:"PUT",headers:{"Content-Type":"application/json","X-Auth-Token":A()},body:JSON.stringify({command:null})});if(k.ok){const g=await k.json(),j={...t,id:g.game.id,title:g.game.title,summary:g.game.summary||"",cover:g.game.cover,background:g.game.background,day:g.game.day??t.day??null,month:g.game.month??t.month??null,year:g.game.year??t.year??null,stars:g.game.stars??t.stars??null,genre:g.game.genre??t.genre??null,criticratings:g.game.criticratings??t.criticratings??null,userratings:g.game.userratings??t.userratings??null,themes:g.game.themes??t.themes??null,platforms:g.game.platforms??t.platforms??null,gameModes:g.game.gameModes??t.gameModes??null,playerPerspectives:g.game.playerPerspectives??t.playerPerspectives??null,websites:g.game.websites??t.websites??null,ageRatings:g.game.ageRatings??t.ageRatings??null,developers:g.game.developers??t.developers??null,publishers:g.game.publishers??t.publishers??null,franchise:g.game.franchise??t.franchise??null,collection:g.game.collection??t.collection??null,screenshots:g.game.screenshots??t.screenshots??null,videos:g.game.videos??t.videos??null,gameEngines:g.game.gameEngines??t.gameEngines??null,keywords:g.game.keywords??t.keywords??null,alternativeNames:g.game.alternativeNames??t.alternativeNames??null,similarGames:g.game.similarGames??t.similarGames??null};"command"in j&&delete j.command,o(j)}else console.error("Failed to unlink executable")}catch(l){console.error("Error unlinking executable:",l)}finally{u(!1),c(!1)}}}}function Qe({onGameAdded:t,onError:o}={}){const{setLoading:i}=U(),[c,d]=m.useState(!1),[r,w]=m.useState(null);return{isAdding:c,addError:r,addGame:async e=>{const f=A();if(!f){const a="Authentication required";return w(a),o&&o(a),null}d(!0),w(null),i(!0);try{const a=M(L,"/games/add-from-igdb"),v=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-Auth-Token":f},body:JSON.stringify({igdbId:e.id,name:e.name,summary:e.summary,cover:e.cover,background:e.background,releaseDate:e.releaseDateFull?.timestamp||e.releaseDate,genres:e.genres,criticRating:e.criticRating,userRating:e.userRating,themes:e.themes,platforms:e.platforms,gameModes:e.gameModes,playerPerspectives:e.playerPerspectives,websites:e.websites,ageRatings:e.ageRatings,developers:e.developers,publishers:e.publishers,franchise:e.franchise,collection:e.collection,screenshots:e.screenshots,videos:e.videos,gameEngines:e.gameEngines,keywords:e.keywords,alternativeNames:e.alternativeNames,similarGames:e.similarGames})});if(!v.ok){const h=(await v.json().catch(()=>({}))).error||`HTTP ${v.status}`;return w(h),o&&o(h),null}const l=await v.json(),k=l.gameId||l.game?.id,g={id:String(k),title:l.game?.title||e.name,summary:l.game?.summary||e.summary||"",cover:l.game?.cover||e.cover||"",background:l.game?.background||e.background||void 0,day:l.game?.day||e.releaseDateFull?.day||null,month:l.game?.month||e.releaseDateFull?.month||null,year:l.game?.year||e.releaseDateFull?.year||e.releaseDate||null,stars:l.game?.stars||null,genre:l.game?.genre||e.genres||null,criticratings:l.game?.criticratings||(e.criticRating?e.criticRating/10:null),userratings:l.game?.userratings||(e.userRating?e.userRating/10:null),command:l.game?.command||null,themes:l.game?.themes||e.themes||null,platforms:l.game?.platforms||e.platforms||null,gameModes:l.game?.gameModes||e.gameModes||null,playerPerspectives:l.game?.playerPerspectives||e.playerPerspectives||null,websites:l.game?.websites||e.websites||null,ageRatings:l.game?.ageRatings||e.ageRatings||null,developers:l.game?.developers||e.developers||null,publishers:l.game?.publishers||e.publishers||null,franchise:l.game?.franchise||e.franchise||null,collection:l.game?.collection||e.collection||null,screenshots:l.game?.screenshots||e.screenshots||null,videos:l.game?.videos||e.videos||null,gameEngines:l.game?.gameEngines||e.gameEngines||null,keywords:l.game?.keywords||e.keywords||null,alternativeNames:l.game?.alternativeNames||e.alternativeNames||null,similarGames:l.game?.similarGames||e.similarGames||null};return window.dispatchEvent(new CustomEvent("gameAdded",{detail:{game:g}})),t&&t(g),g}catch(a){const v=a.message||"Failed to add game";return console.error("Error adding game:",a),w(v),o&&o(v),null}finally{d(!1),i(!1)}}}}function ge({onSuccess:t,onError:o}={}){const{t:i}=F(),{setLoading:c}=U(),[d,r]=m.useState(!1);return{isAdding:d,addGameToCollection:async(u,e)=>{const f=A();if(!f){o?.(i("common.unauthorized","Unauthorized"));return}r(!0),c(!0);try{const a=M(L,`/collections/${e}/games`),v=await fetch(a,{headers:{Accept:"application/json","X-Auth-Token":f}});if(!v.ok)throw new Error(`Failed to fetch collection games: ${v.status}`);const k=((await v.json()).games||[]).map(C=>String(C.id));if(k.includes(String(u))){o?.(i("collections.gameAlreadyInCollection","Game is already in this collection"));return}const g=[...k,String(u)],j=M(L,`/collections/${e}/games/order`),h=await fetch(j,{method:"PUT",headers:{"Content-Type":"application/json","X-Auth-Token":f},body:JSON.stringify({gameIds:g})});if(!h.ok){const C=await h.json().catch(()=>({}));throw new Error(C.error||`Failed to add game to collection: ${h.status}`)}const s=JSON.parse(localStorage.getItem("recentCollections")||"[]");if(!s.includes(e)){s.unshift(e);const C=s.slice(0,10);localStorage.setItem("recentCollections",JSON.stringify(C))}t?.()}catch(a){const v=String(a.message||a);console.error("Error adding game to collection:",v),o?.(v)}finally{r(!1),c(!1)}}}}function Me({onSuccess:t,onError:o}={}){const{t:i}=F(),{setLoading:c}=U(),[d,r]=m.useState(!1);return{isRemoving:d,removeGameFromCollection:async(u,e)=>{const f=A();if(!f){o?.(i("common.unauthorized","Unauthorized"));return}r(!0),c(!0);try{const a=M(L,`/collections/${e}/games`),v=await fetch(a,{headers:{Accept:"application/json","X-Auth-Token":f}});if(!v.ok)throw new Error(`Failed to fetch collection games: ${v.status}`);const g=((await v.json()).games||[]).map(s=>String(s.id)).filter(s=>s!==String(u)),j=M(L,`/collections/${e}/games/order`),h=await fetch(j,{method:"PUT",headers:{"Content-Type":"application/json","X-Auth-Token":f},body:JSON.stringify({gameIds:g})});if(!h.ok){const s=await h.json().catch(()=>({}));throw new Error(s.error||`Failed to remove game from collection: ${h.status}`)}t?.()}catch(a){const v=String(a.message||a);console.error("Error removing game from collection:",v),o?.(v)}finally{r(!1),c(!1)}}}}function Pe({onSuccess:t,onError:o}={}){const{t:i}=F(),{setLoading:c}=U(),[d,r]=m.useState(!1);return{isCreating:d,createCollection:async(u,e)=>{const f=A();if(!f)return o?.(i("common.unauthorized","Unauthorized")),null;if(!u||u.trim()==="")return o?.(i("collections.titleRequired","Collection title is required")),null;r(!0),c(!0);try{const a=M(L,"/collections"),v=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json","X-Auth-Token":f},body:JSON.stringify({title:u.trim(),summary:e?.trim()||""})});if(!v.ok){const g=await v.json().catch(()=>({}));throw new Error(g.error||`Failed to create collection: ${v.status}`)}const l=await v.json(),k={id:l.collection.id,title:l.collection.title,summary:l.collection.summary,cover:l.collection.cover,gameCount:0};return window.dispatchEvent(new CustomEvent("collectionAdded",{detail:{collection:k}})),t?.(k),k}catch(a){const v=String(a.message||a);return console.error("Error creating collection:",v),o?.(v),null}finally{r(!1),c(!1)}}}}function we({text:t,delay:o=1e3,children:i}){const[c,d]=m.useState(!1),[r,w]=m.useState({}),u=m.useRef(null),e=m.useRef(null);m.useEffect(()=>()=>{e.current&&clearTimeout(e.current)},[]),m.useEffect(()=>{if(!c)return;const v=()=>{e.current&&(clearTimeout(e.current),e.current=null),d(!1)};return document.addEventListener("click",v,!0),()=>{document.removeEventListener("click",v,!0)}},[c]);const f=()=>{e.current&&clearTimeout(e.current),e.current=window.setTimeout(()=>{if(u.current){const v=u.current.getBoundingClientRect();w({position:"fixed",top:`${v.bottom+8}px`,left:`${v.left}px`,zIndex:99999}),d(!0)}},o)},a=()=>{e.current&&(clearTimeout(e.current),e.current=null),d(!1)};return n.jsxs(n.Fragment,{children:[n.jsx("div",{ref:u,className:"tooltip-wrapper",onMouseEnter:f,onMouseLeave:a,children:i}),c&&V.createPortal(n.jsx("span",{className:"tooltip tooltip-portal",style:r,children:t}),document.body)]})}function De({onEdit:t,onDelete:o,onReload:i,onAddToCollection:c,onRemoveFromCollection:d,gameId:r,gameTitle:w,gameCommand:u,onGameDelete:e,onGameUpdate:f,collectionId:a,collectionTitle:v,onCollectionDelete:l,onCollectionUpdate:k,className:g="",horizontal:j=!1,onModalOpen:h,onModalClose:s,toolTipDelay:C=0}){const{t:y}=F(),[x,p]=m.useState(!1),T=m.useRef(null),D=m.useRef(null),R=Te({gameId:r,collectionId:a,onGameDelete:e,onCollectionDelete:l,onModalClose:s}),b=Ne({gameId:r,collectionId:a,onGameUpdate:f,onCollectionUpdate:k,onReload:i,onModalClose:s}),P=r&&f?Le({gameId:r,onGameUpdate:f}):{isUnlinking:!1,handleUnlinkExecutable:async()=>{}},O=Me({onSuccess:()=>{d&&d()},onError:E=>{console.error("Error removing game from collection:",E)}}),$=g.includes("games-list-dropdown-menu");m.useEffect(()=>{!x&&r?(window.dispatchEvent(new CustomEvent("closeAddToCollectionDropdown",{detail:{gameId:r}})),window.dispatchEvent(new CustomEvent("dropdownMenuClosed",{detail:{gameId:r}}))):!x&&a&&window.dispatchEvent(new CustomEvent("dropdownMenuClosed",{detail:{collectionId:a}}))},[x,r,a]),m.useEffect(()=>{if(!x)return;function E(se){const H=se.target;T.current&&T.current.contains(H)||D.current&&D.current.contains(H)||H.closest(".dropdown-menu-popup")||H.closest(".add-to-collection-dropdown-menu")||p(!1)}const S=setTimeout(()=>{document.addEventListener("mousedown",E,!0)},100);return()=>{clearTimeout(S),document.removeEventListener("mousedown",E,!0)}},[x]),m.useEffect(()=>(R.showConfirmModal||b.showReloadConfirmModal?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[R.showConfirmModal,b.showReloadConfirmModal]),m.useEffect(()=>{if(!R.showConfirmModal&&!b.showReloadConfirmModal)return;function E(S){S.key==="Escape"&&(R.showConfirmModal&&R.handleCancelDelete(),b.showReloadConfirmModal&&b.handleCancelReload())}return document.addEventListener("keydown",E),()=>{document.removeEventListener("keydown",E)}},[R.showConfirmModal,b.showReloadConfirmModal,R,b]);const W=E=>{E.stopPropagation();const S=!x;p(S),r?S?window.dispatchEvent(new CustomEvent("dropdownMenuOpened",{detail:{gameId:r}})):window.dispatchEvent(new CustomEvent("dropdownMenuClosed",{detail:{gameId:r}})):a&&(S?window.dispatchEvent(new CustomEvent("dropdownMenuOpened",{detail:{collectionId:a}})):window.dispatchEvent(new CustomEvent("dropdownMenuClosed",{detail:{collectionId:a}})))},B=E=>{E.stopPropagation(),p(!1),h&&h(),t&&t()},K=()=>{window.dispatchEvent(new CustomEvent("openAddToCollectionDropdown",{detail:{gameId:r}}))},ee=E=>{const S=E.relatedTarget;S&&!S.closest(".add-to-collection-dropdown-menu")&&window.dispatchEvent(new CustomEvent("closeAddToCollectionDropdown",{detail:{gameId:r}}))},te=()=>{window.dispatchEvent(new CustomEvent("closeAddToCollectionDropdown",{detail:{gameId:r}}))},Q=E=>{const S=E.relatedTarget;S&&!S.closest(".dropdown-menu-popup")&&!S.closest(".add-to-collection-dropdown-menu")&&window.dispatchEvent(new CustomEvent("closeAddToCollectionDropdown",{detail:{gameId:r}}))},ne=E=>{E.stopPropagation(),p(!1),r&&w||a&&v?(h&&h(),R.handleDeleteClick()):o&&o()},z=E=>{if(E.stopPropagation(),E.preventDefault(),p(!1),r||a){i?i():b.handleConfirmReload();return}setTimeout(()=>{h&&h(),b.handleReloadClick()},0)},oe=async E=>{E.stopPropagation(),p(!1),await P.handleUnlinkExecutable()},X=n.jsx("button",{onClick:W,className:"dropdown-menu-button","aria-label":"Menu",children:j?n.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[n.jsx("circle",{cx:"5",cy:"12",r:"1"}),n.jsx("circle",{cx:"12",cy:"12",r:"1"}),n.jsx("circle",{cx:"19",cy:"12",r:"1"})]}):n.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[n.jsx("circle",{cx:"12",cy:"5",r:"1"}),n.jsx("circle",{cx:"12",cy:"12",r:"1"}),n.jsx("circle",{cx:"12",cy:"19",r:"1"})]})});return n.jsxs("div",{className:`dropdown-menu-wrapper ${g}`,ref:T,children:[C>0?n.jsx(we,{text:y("common.more","More"),delay:C,children:X}):X,x&&(()=>{const E=n.jsxs("div",{ref:D,className:"dropdown-menu-popup",onMouseLeave:Q,style:$&&T.current?(()=>{const S=T.current.getBoundingClientRect();return{position:"fixed",bottom:`${window.innerHeight-S.top+4}px`,right:`${window.innerWidth-S.right}px`,top:"auto"}})():void 0,children:[c&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"dropdown-menu-item dropdown-menu-item-with-submenu",onMouseEnter:K,onMouseLeave:ee,children:[n.jsx("span",{children:y("collections.addTo","Add to")}),n.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:n.jsx("polyline",{points:"9 18 15 12 9 6"})})]}),!(d&&r&&a)&&(t||i||r&&f||!r&&!a&&!t&&!o||r&&u&&f||o||A()&&(r||a))&&n.jsx("div",{className:"dropdown-menu-divider",onMouseEnter:te})]}),d&&r&&a&&n.jsx("button",{onClick:async S=>{S.stopPropagation(),p(!1),await O.removeGameFromCollection(r,a)},className:"dropdown-menu-item dropdown-menu-item-danger",disabled:O.isRemoving,children:n.jsx("span",{children:O.isRemoving?y("common.removing","Removing..."):y("collections.removeFromCollection","Remove from collection")})}),d&&r&&a&&(t||i||r&&f||!r&&!a&&!t&&!o||r&&u&&f||o||A()&&(r||a))&&n.jsx("div",{className:"dropdown-menu-divider"}),t&&n.jsx("button",{onClick:B,className:"dropdown-menu-item",children:n.jsx("span",{children:y("common.edit","Edit")})}),(i||r&&f||!r&&!a&&!t&&!o)&&n.jsx("button",{onClick:z,className:"dropdown-menu-item",disabled:b.isReloading,children:n.jsx("span",{children:r?y("common.reloadSingleMetadata","Reload metadata"):y("common.reloadMetadata","Reload all metadata")})}),r&&u&&f&&n.jsx("button",{onClick:oe,className:"dropdown-menu-item",disabled:P.isUnlinking,children:n.jsx("span",{children:y("gameDetail.unlinkExecutable","Unlink Executable")})}),(o||A()&&(r||a))&&n.jsx("button",{onClick:ne,className:"dropdown-menu-item dropdown-menu-item-danger",children:n.jsx("span",{children:y("common.delete","Delete")})})]});return $?V.createPortal(E,document.body):E})(),b.showReloadConfirmModal&&V.createPortal(n.jsx("div",{className:"dropdown-menu-confirm-overlay",onClick:b.handleCancelReload,children:n.jsxs("div",{className:"dropdown-menu-confirm-container",onClick:E=>E.stopPropagation(),children:[n.jsxs("div",{className:"dropdown-menu-confirm-header",children:[n.jsxs("h2",{children:[n.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",style:{marginRight:"8px",verticalAlign:"middle"},children:[n.jsx("path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"}),n.jsx("path",{d:"M21 3v5h-5"}),n.jsx("path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"}),n.jsx("path",{d:"M3 21v-5h5"})]}),y("common.reloadMetadata","Reload all metadata")]}),n.jsx("button",{className:"dropdown-menu-confirm-close",onClick:b.handleCancelReload,"aria-label":"Close",children:"×"})]}),n.jsxs("div",{className:"dropdown-menu-confirm-content",children:[n.jsx("p",{children:y("common.confirmReload","Are you sure you want to reload all metadata? This will refresh all games, collections, and categories.")}),b.reloadError&&n.jsx("div",{className:"dropdown-menu-confirm-error",children:b.reloadError})]}),n.jsxs("div",{className:"dropdown-menu-confirm-footer",children:[n.jsx("button",{className:"dropdown-menu-confirm-cancel",onClick:b.handleCancelReload,disabled:b.isReloading,children:y("common.cancel","Cancel")}),n.jsx("button",{className:"dropdown-menu-confirm-reload",onClick:b.handleConfirmReload,disabled:b.isReloading,children:b.isReloading?y("common.reloading","Reloading..."):y("common.reloadMetadata","Reload all metadata")})]})]})}),document.body),R.showConfirmModal&&V.createPortal(n.jsx("div",{className:"dropdown-menu-confirm-overlay",onClick:R.handleCancelDelete,children:n.jsxs("div",{className:"dropdown-menu-confirm-container",onClick:E=>E.stopPropagation(),children:[n.jsxs("div",{className:"dropdown-menu-confirm-header",children:[n.jsxs("h2",{children:[n.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",style:{marginRight:"8px",verticalAlign:"middle"},children:[n.jsx("path",{d:"M3 6h18"}),n.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"}),n.jsx("path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})]}),y("common.deleteTitle","Delete")]}),n.jsx("button",{className:"dropdown-menu-confirm-close",onClick:R.handleCancelDelete,"aria-label":"Close",children:"×"})]}),n.jsxs("div",{className:"dropdown-menu-confirm-content",children:[n.jsx("p",{children:y("common.confirmDelete",{title:w||v||""})}),R.deleteError&&n.jsx("div",{className:"dropdown-menu-confirm-error",children:R.deleteError})]}),n.jsxs("div",{className:"dropdown-menu-confirm-footer",children:[n.jsx("button",{className:"dropdown-menu-confirm-cancel",onClick:R.handleCancelDelete,disabled:R.isDeleting,children:y("common.cancel","Cancel")}),n.jsx("button",{className:"dropdown-menu-confirm-delete",onClick:R.handleConfirmDelete,disabled:R.isDeleting,children:R.isDeleting?y("common.deleting","Deleting..."):y("common.delete","Delete")})]})]})}),document.body)]})}function Ae({isOpen:t,onClose:o,game:i,allCollections:c,onCollectionAdded:d}){const{t:r}=F(),[w,u]=m.useState(""),[e,f]=m.useState(i.title),[a,v]=m.useState(c),l=m.useRef(null),k=ge({onSuccess:()=>{d?.(),o()}}),g=Pe({onSuccess:async s=>{s&&await k.addGameToCollection(i.id,s.id)}});m.useEffect(()=>(t?(f(i.title),u(""),document.body.style.overflow="hidden",setTimeout(()=>{l.current&&(l.current.focus(),l.current.select())},0)):document.body.style.overflow="",()=>{document.body.style.overflow=""}),[t,i.title]),m.useEffect(()=>{if(!w.trim())v(c);else{const s=w.toLowerCase();v(c.filter(C=>C.title.toLowerCase().includes(s)))}},[w,c]);const j=async s=>{await k.addGameToCollection(i.id,s)},h=async()=>{e.trim()&&await g.createCollection(e.trim())};return t?V.createPortal(n.jsx("div",{className:"add-to-collection-modal-overlay",onClick:o,children:n.jsxs("div",{className:"add-to-collection-modal",onClick:s=>s.stopPropagation(),children:[n.jsxs("div",{className:"add-to-collection-modal-header",children:[n.jsx("h2",{children:r("collections.addToCollection","Add to Collection")}),n.jsx("button",{className:"add-to-collection-modal-close",onClick:o,children:"×"})]}),n.jsx("div",{className:"add-to-collection-modal-search",children:n.jsx("input",{type:"text",placeholder:r("collections.searchCollections","Search collections..."),value:w,onChange:s=>u(s.target.value),autoFocus:!0})}),n.jsx("div",{className:"add-to-collection-modal-collections",children:a.length>0?a.map(s=>n.jsxs("div",{className:"add-to-collection-modal-collection-item",onClick:()=>j(s.id),children:[n.jsx("div",{className:"add-to-collection-modal-collection-title",children:s.title}),s.gameCount!==void 0&&n.jsxs("div",{className:"add-to-collection-modal-collection-count",children:[s.gameCount," ",r("collections.games","games")]})]},s.id)):n.jsx("div",{className:"add-to-collection-modal-empty",children:r("collections.noCollectionsFound","No collections found")})}),n.jsxs("div",{className:"add-to-collection-modal-create",children:[n.jsx("input",{ref:l,type:"text",placeholder:r("collections.newCollectionTitle","New collection title"),value:e,onChange:s=>f(s.target.value),onFocus:s=>{s.target.value&&s.target.select()},onKeyDown:s=>{s.key==="Enter"&&h()}}),n.jsx("button",{onClick:h,disabled:!e.trim()||g.isCreating,className:"add-to-collection-modal-create-button",children:g.isCreating?r("common.creating","Creating..."):r("common.create","Create")})]})]})}),document.body):null}function $e({game:t,allCollections:o,onCollectionAdded:i}){const{t:c}=F(),[d,r]=m.useState(!1),[w,u]=m.useState(!1),[e,f]=m.useState([]),[a,v]=m.useState(!1),l=m.useRef(null),k=ge({onSuccess:()=>{i?.(),r(!1)}});m.useEffect(()=>{const h=C=>{C.detail?.gameId===t.id&&!w&&r(!0)},s=C=>{const y=C;(!y.detail?.gameId||y.detail.gameId===t.id)&&!w&&r(!1)};return window.addEventListener("openAddToCollectionDropdown",h),window.addEventListener("closeAddToCollectionDropdown",s),()=>{window.removeEventListener("openAddToCollectionDropdown",h),window.removeEventListener("closeAddToCollectionDropdown",s)}},[t.id,w]),m.useEffect(()=>{const s=JSON.parse(localStorage.getItem("recentCollections")||"[]").map(C=>o.find(y=>y.id===C)).filter(C=>C!==void 0).slice(0,5);f(s)},[o]),m.useEffect(()=>{if(!d||!l.current){v(!1);return}v(!1);const h=()=>{const x=document.querySelector(".dropdown-menu-item-with-submenu");if(!x)return;const p=l.current?.querySelector(".add-to-collection-dropdown-menu");if(!p)return;const T=x.getBoundingClientRect(),D=0,R=window.innerWidth,b=window.innerHeight,P=8,O=p.offsetWidth||200,$=p.offsetHeight||100;let W=T.right+D;W+O+P>R&&(W=T.left-O-D),W<P&&(W=P);let B=T.top;B+$+P>b&&(B=T.bottom-$,B+$+P>b&&(B=b-$-P)),B<P&&(B=P),p.style.top=`${B}px`,p.style.left=`${W}px`,v(!0)};requestAnimationFrame(()=>{requestAnimationFrame(h)});const s=()=>{h()},C=()=>{h()};window.addEventListener("resize",s),window.addEventListener("scroll",C,!0);function y(x){const p=x.target;l.current&&!l.current.contains(p)&&!p.closest(".dropdown-menu-item-with-submenu")&&!p.closest(".dropdown-menu-popup")&&r(!1)}return l.current&&l.current.addEventListener("mouseleave",y),()=>{window.removeEventListener("resize",s),window.removeEventListener("scroll",C,!0),l.current&&l.current.removeEventListener("mouseleave",y)}},[d]);const g=async(h,s)=>{h.stopPropagation(),h.preventDefault(),r(!1),await k.addGameToCollection(t.id,s)},j=h=>{h.stopPropagation(),h.preventDefault(),r(!1),setTimeout(()=>{u(!0)},50)};return n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"add-to-collection-dropdown",ref:l,children:d&&n.jsxs("div",{className:"add-to-collection-dropdown-menu",style:{opacity:a?1:0,pointerEvents:a?"auto":"none"},onMouseEnter:()=>r(!0),onMouseLeave:h=>{const s=h.relatedTarget;(!s||!s.closest(".add-to-collection-dropdown-menu")&&!s.closest(".dropdown-menu-item-with-submenu")&&!s.closest(".dropdown-menu-popup"))&&setTimeout(()=>{const C=document.querySelector(".dropdown-menu-item-with-submenu"),y=l.current?.querySelector(".add-to-collection-dropdown-menu");if(C&&y){const x=C.getBoundingClientRect(),p=y.getBoundingClientRect(),T=h.clientX,D=h.clientY,R=T>=x.left&&T<=x.right&&D>=x.top&&D<=x.bottom,b=T>=p.left&&T<=p.right&&D>=p.top&&D<=p.bottom;!R&&!b&&r(!1)}else r(!1)},200)},onClick:h=>{h.stopPropagation()},children:[n.jsx("div",{className:"add-to-collection-dropdown-item",onClick:j,children:c("collections.addToCollection","Add to Collection...")}),e.length>0&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"add-to-collection-dropdown-divider"}),n.jsx("div",{className:"add-to-collection-dropdown-section-title",children:c("collections.recent","RECENT")}),e.map(h=>n.jsx("div",{className:"add-to-collection-dropdown-item",onClick:s=>g(s,h.id),children:h.title},h.id))]})]})}),n.jsx(Ae,{isOpen:w,onClose:()=>u(!1),game:t,allCollections:o,onCollectionAdded:i})]})}function Fe({title:t,coverUrl:o,width:i,height:c,onPlay:d,onClick:r,onEdit:w,onDelete:u,gameId:e,gameTitle:f,game:a,onGameDelete:v,onGameUpdate:l,collectionId:k,collectionTitle:g,onCollectionDelete:j,onCollectionUpdate:h,onRemoveFromCollection:s,showTitle:C=!1,subtitle:y,detail:x=!0,play:p=!0,showBorder:T=!0,aspectRatio:D="3/4",overlayContent:R,titlePosition:b="bottom",editButtonPosition:P="bottom-left",onUpload:O,uploading:$=!1,allCollections:W=[],showRemoveButton:B=!1,removeMediaType:K,removeResourceId:ee,removeResourceType:te,onRemoveSuccess:Q,removeDisabled:ne=!1}){const{t:z}=F(),[oe,X]=m.useState(!1),[E,S]=m.useState(!1),[se,H]=m.useState(!1),re=m.useRef(null),le=!o||oe;m.useEffect(()=>{X(!1)},[o]),m.useEffect(()=>{if(!e&&!k)return;const N=Z=>{const q=Z;(e&&q.detail?.gameId===e||k&&q.detail?.collectionId===k)&&S(!0)},_=Z=>{const q=Z;(e&&q.detail?.gameId===e||k&&q.detail?.collectionId===k)&&S(!1)};return window.addEventListener("dropdownMenuOpened",N),window.addEventListener("dropdownMenuClosed",_),()=>{window.removeEventListener("dropdownMenuOpened",N),window.removeEventListener("dropdownMenuClosed",_)}},[e,k]),m.useEffect(()=>{const N=()=>{if(!re.current)return;const q=re.current.querySelectorAll(".games-list-play-button, .games-list-upload-button, .games-list-edit-button");if(q.length===0){H(!1);return}const je=document.querySelectorAll(".dropdown-menu-popup, .add-to-collection-dropdown-menu");let ue=!1;q.forEach(Ee=>{const G=Ee.getBoundingClientRect();je.forEach(me=>{const ae=window.getComputedStyle(me);if(ae.display==="none"||ae.opacity==="0"||ae.visibility==="hidden")return;const I=me.getBoundingClientRect();!(I.right<G.left||I.left>G.right||I.bottom<G.top||I.top>G.bottom)&&(ue=!0)})}),H(ue)};N();const _=setInterval(N,100);return window.addEventListener("scroll",N,!0),window.addEventListener("resize",N),()=>{clearInterval(_),window.removeEventListener("scroll",N,!0),window.removeEventListener("resize",N)}},[E]);let Y=Math.max(10,Math.min(16,Math.floor(i/8)));D==="16/9"&&b==="overlay"&&(Y=Math.max(14,Math.min(24,Math.floor(i/5))));const ie=Math.max(4,Math.floor(i/20)),ce=Math.max(2,Math.floor(c/(Y*1.5))),ve=N=>{p&&!x&&d?(N.stopPropagation(),d()):x&&r&&(N.stopPropagation(),r())},ye=N=>{N.stopPropagation(),d&&d()},xe=N=>{N.stopPropagation(),w&&w()},de=N=>{N.stopPropagation(),O&&!$&&O()},Ce=p&&d&&!O,J=O!==void 0,ke=x||p||J;return n.jsxs(n.Fragment,{children:[n.jsxs("div",{ref:re,className:`games-list-cover relative bg-[#2a2a2a] rounded overflow-hidden transition-all ${T?"cover-hover-effect":""} ${p?"games-list-cover-play":""} ${x?"games-list-cover-detail":""} ${J?"games-list-cover-upload":""} ${E?"cover-dropdown-open":""} ${se?"cover-popup-overlay":""}`,style:{width:`${i}px`,aspectRatio:D,cursor:ke&&!J||J?"pointer":"default"},onClick:J?de:ve,children:[le?n.jsx("div",{className:"cover-placeholder",style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#2a2a2a",border:"1px solid rgba(255, 255, 255, 0.2)",boxSizing:"border-box"},children:n.jsx("div",{className:"cover-placeholder-text",style:{padding:`${ie}px`,fontSize:`${Y}px`,textAlign:"center",color:"rgba(255, 255, 255, 0.85)",fontWeight:600,lineHeight:1.3,wordBreak:"break-word",overflow:"hidden",display:"-webkit-box",WebkitLineClamp:ce,WebkitBoxOrient:"vertical",width:"100%",maxHeight:"100%"},children:t})}):n.jsx("img",{src:o,alt:t,className:"object-cover w-full h-full",loading:o.startsWith("data:")?void 0:"lazy",onError:()=>{X(!0)},onLoad:()=>{X(!1)}},o||"cover-image"),Ce&&n.jsx("button",{onClick:ye,className:`games-list-play-button ${x?"games-list-play-button-detail":"games-list-play-button-play-only"}`,"aria-label":z("common.play"),children:n.jsx("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:n.jsx("path",{d:"M8 5v14l11-7z",fill:"currentColor"})})}),J&&n.jsx("button",{onClick:de,className:`games-list-upload-button ${x?"games-list-upload-button-detail":"games-list-upload-button-upload-only"}`,"aria-label":z("gameDetail.uploadCover","Upload Cover"),disabled:$,children:$?n.jsx("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"spinning",style:{animation:"spin 1s linear infinite"},children:n.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"2",fill:"none",strokeDasharray:"31.416",strokeDashoffset:"31.416",strokeLinecap:"round"})}):n.jsx("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:n.jsx("path",{d:"M12 5v14M5 12h14",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),w&&n.jsx("button",{onClick:xe,className:`games-list-edit-button ${P==="bottom-right"?"games-list-edit-button-bottom-right":""}`,"aria-label":z("common.edit","Edit"),children:n.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[n.jsx("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),n.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]})}),w&&e&&a&&n.jsx("div",{className:"games-list-dropdown-wrapper games-list-dropdown-wrapper-bottom-right",children:n.jsx($e,{game:a,allCollections:W})}),w&&n.jsx("div",{className:"games-list-dropdown-wrapper games-list-dropdown-wrapper-bottom-right",children:n.jsx(De,{onDelete:u,gameId:e,gameTitle:f,onAddToCollection:e&&a?()=>{}:void 0,onRemoveFromCollection:s,onGameDelete:v,onGameUpdate:l,collectionId:k,collectionTitle:g,onCollectionDelete:j,onCollectionUpdate:h,className:"games-list-dropdown-menu"})}),B&&K&&ee&&te&&n.jsx("button",{className:"cover-remove-media-button",onClick:N=>{N.stopPropagation(),Q&&Q()},disabled:ne||$,title:K==="cover"?z("gameDetail.removeCover","Remove cover"):z("gameDetail.removeBackground","Remove background")}),R&&n.jsx("div",{className:"cover-overlay-content",children:R}),b==="overlay"&&C&&!le&&n.jsx("div",{className:"cover-overlay-content",style:{display:"flex",alignItems:"center",justifyContent:"center",padding:`${ie}px`},children:n.jsx("div",{style:{textAlign:"center",color:"rgba(255, 255, 255, 0.95)",fontWeight:600,fontSize:`${Y}px`,lineHeight:1.3,wordBreak:"break-word",overflow:"hidden",display:"-webkit-box",WebkitLineClamp:ce,WebkitBoxOrient:"vertical",textShadow:"2px 2px 4px rgba(0, 0, 0, 0.8)"},children:t})})]}),(C||y!=null)&&b==="bottom"&&n.jsxs("div",{className:"games-list-title-wrapper",children:[C&&n.jsx(we,{text:t,position:"bottom",children:n.jsx("div",{className:`truncate games-list-title ${x?"games-list-title-clickable":""}`,onClick:x&&r?N=>{N.stopPropagation(),r()}:void 0,children:t})}),y!=null&&n.jsx("div",{className:"games-list-year",children:y})]})]})}function he(t){try{const o=sessionStorage.getItem(t);return o?parseInt(o,10):0}catch{return 0}}function fe(t,o){try{sessionStorage.setItem(t,o.toString())}catch{}}function Oe(t,o){const i=be(),c=m.useRef(!1),d=o?`${i.pathname}:${o}`:i.pathname;m.useLayoutEffect(()=>{if(!t.current){const f=setTimeout(()=>{const a=t.current;if(a){const v=he(d);v>0&&(a.scrollTop=v)}},200);return()=>clearTimeout(f)}c.current=!0;const w=he(d);if(w<=0){c.current=!1;return}const u=(f=0)=>{const a=t.current;if(!a){f<30?setTimeout(()=>u(f+1),50):c.current=!1;return}const l=o==="table"?a.querySelector("tbody tr"):!0;if(!(a.scrollHeight>a.clientHeight)||!l){f<100?f<20?requestAnimationFrame(()=>u(f+1)):setTimeout(()=>u(f+1),50):c.current=!1;return}a.scrollTop=w,f<10?setTimeout(()=>{const g=a.scrollTop;Math.abs(g-w)>10?(a.scrollTop=w,u(f+1)):c.current=!1},100):c.current=!1},e=setTimeout(()=>{u()},150);return()=>{clearTimeout(e),c.current=!1}},[i.pathname,d,t,o]),m.useEffect(()=>{const r=t.current;if(!r)return;const w=()=>{if(c.current)return;const u=r.scrollTop;u>0&&fe(d,u)};return r.addEventListener("scroll",w,{passive:!0}),()=>{r.removeEventListener("scroll",w);const u=r.scrollTop;u>0&&!c.current&&fe(d,u)}},[i.pathname,d,t,o])}function We({category:t,coverSize:o,itemRefs:i}){const{t:c}=F(),d=Re(),r=o*(9/16),w=()=>{d(`/category/${t.id}`)};return n.jsx("div",{ref:u=>{u&&i?.current&&i.current.set(t.id,u)},className:"group cursor-pointer categories-list-item",style:{width:`${o}px`,minWidth:`${o}px`},onClick:w,children:n.jsx(Fe,{title:c(`genre.${t.title}`,t.title),coverUrl:Se(L,t.cover),width:o,height:r,onClick:w,showTitle:!0,titlePosition:"overlay",detail:!0,play:!1,showBorder:!0,aspectRatio:"16/9"})},t.id)}function Be({categories:t,coverSize:o=150,itemRefs:i}){const{t:c}=F();return t.length===0?n.jsx("div",{className:"text-gray-400 text-center",children:c("table.noGames")}):n.jsx("div",{className:"categories-list-container",style:{gridTemplateColumns:`repeat(auto-fill, ${o}px)`},children:t.map(d=>n.jsx(We,{category:d,coverSize:o,itemRefs:i},d.id))})}function Ye({coverSize:t}){const{setLoading:o,isLoading:i}=U(),[c,d]=m.useState([]),[r,w]=m.useState([]),[u,e]=m.useState([]),[f,a]=m.useState(!1),v=m.useRef(null),l=m.useRef(new Map);Oe(v),m.useEffect(()=>{k(),g()},[]),m.useEffect(()=>{const j=()=>{k(),g()};return window.addEventListener("metadataReloaded",j),()=>{window.removeEventListener("metadataReloaded",j)}},[]),m.useEffect(()=>{if(u.length===0||c.length===0){w([]);return}const j=new Set;u.forEach(s=>{s.genre&&(Array.isArray(s.genre)?s.genre.forEach(C=>j.add(C)):typeof s.genre=="string"&&j.add(s.genre))});const h=c.filter(s=>j.has(s.title));w(h)},[u,c]),m.useLayoutEffect(()=>{!i&&(r.length>0||c.length>0&&u.length>0)?requestAnimationFrame(()=>{requestAnimationFrame(()=>{a(!0)})}):i&&a(!1)},[i,r.length,c.length,u.length]);async function k(){try{const j=M(L,"/categories"),h=await fetch(j,{headers:{Accept:"application/json","X-Auth-Token":A()}});if(!h.ok)throw new Error(`HTTP ${h.status}`);const y=((await h.json()).categories||[]).map(x=>({id:x,title:x,cover:`/category-covers/${encodeURIComponent(x)}`}));d(y)}catch(j){const h=String(j.message||j);console.error("Error fetching categories:",h)}}async function g(){o(!0);try{const j=M(L,"/libraries/library/games",{sort:"title"}),h=await fetch(j,{headers:{Accept:"application/json","X-Auth-Token":A()}});if(!h.ok)throw new Error(`HTTP ${h.status}`);const y=((await h.json()).games||[]).map(x=>({id:x.id,title:x.title,summary:x.summary,cover:x.cover,day:x.day,month:x.month,year:x.year,stars:x.stars,genre:x.genre}));e(y)}catch(j){const h=String(j.message||j);console.error("Error fetching library games:",h)}finally{o(!1)}}return n.jsx("main",{className:"flex-1 home-page-content",children:n.jsx("div",{className:"home-page-layout",children:n.jsx("div",{className:"home-page-content-wrapper",style:{opacity:f?1:0,transition:"opacity 0.2s ease-in-out"},children:n.jsx("div",{ref:v,className:"home-page-scroll-container",children:!i&&n.jsx(Be,{categories:r,coverSize:t*2,itemRefs:l})})})})})}export{$e as A,Fe as C,De as D,Ve as L,we as T,Je as a,M as b,Oe as c,Se as d,Xe as e,Ye as f,Qe as g,Ke as h,U as u};
